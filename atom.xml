<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>BoobooWei</title>
  
  <subtitle>A fast, simple &amp; powerful blog framework powered by Node.js.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.toberoot.com/"/>
  <updated>2022-03-22T03:27:46.586Z</updated>
  <id>http://www.toberoot.com/</id>
  
  <author>
    <name>魏亚萍</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Markdown 数学符号</title>
    <link href="http://www.toberoot.com/news/2021/05/04/markdown%E6%95%B0%E5%AD%A6%E7%AC%A6%E5%8F%B7/"/>
    <id>http://www.toberoot.com/news/2021/05/04/markdown%E6%95%B0%E5%AD%A6%E7%AC%A6%E5%8F%B7/</id>
    <published>2021-05-04T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.586Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Markdown-数学符号"><a href="#Markdown-数学符号" class="headerlink" title="Markdown 数学符号"></a>Markdown 数学符号</h1><ul><li>行内公式直接用<script type="math/tex">`包围就行如`$ \iint_D f(x,y)d\sigma</script>,效果就是：<img src="https://math.jianshu.com/math?formula=%5Ciint_D%20f(x%2Cy" alt="\iint_D f(x,y)d\sigma">d%5Csigma)</li><li>行间公式（公式在单独一行）就用$$$$（前后两个$）包围,<br>如$$$ \iint_D f(x,y)d\sigma $$$,效果就是<img src="https://math.jianshu.com/math?formula=%5Ciint_D%20f(x%2Cy" alt="\iint_D f(x,y)d\sigma">d%5Csigma)</li></ul><p>下面附上一些希腊字母，公式中的特殊符号在markdown语法：</p><h3 id="希腊字母"><a href="#希腊字母" class="headerlink" title="希腊字母"></a>希腊字母</h3><div class="table-container"><table><thead><tr><th>字母</th><th>语法</th><th>字母</th><th>语法</th></tr></thead><tbody><tr><td><img src="https://math.jianshu.com/math?formula=A" alt="A"></td><td>A</td><td><img src="https://math.jianshu.com/math?formula=%5Calpha" alt="\alpha"></td><td>\alhpa</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=B" alt="B"></td><td>B</td><td><img src="https://math.jianshu.com/math?formula=%5Cbeta" alt="\beta"></td><td>\beta</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CGamma" alt="\Gamma"></td><td>\Gamma</td><td><img src="https://math.jianshu.com/math?formula=%5Cgamma" alt="\gamma"></td><td>\gamma</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CDelta" alt="\Delta"></td><td>\Delta</td><td><img src="https://math.jianshu.com/math?formula=%5Cdelta" alt="\delta"></td><td>\delta</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=E" alt="E"></td><td>E</td><td><img src="https://math.jianshu.com/math?formula=%5Cepsilon" alt="\epsilon"></td><td>\epsilon</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=Z" alt="Z"></td><td>Z</td><td><img src="https://math.jianshu.com/math?formula=%5Czeta" alt="\zeta"></td><td>\zeta</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=H" alt="H"></td><td>H</td><td><img src="https://math.jianshu.com/math?formula=%5Ceta" alt="\eta"></td><td>\eta</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CTheta" alt="\Theta"></td><td>\Theta</td><td><img src="https://math.jianshu.com/math?formula=%5Ctheta" alt="\theta"></td><td>\theta</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=I" alt="I"></td><td>I</td><td><img src="https://math.jianshu.com/math?formula=%5Ciota" alt="\iota"></td><td>\iota</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=K" alt="K"></td><td>K</td><td><img src="https://math.jianshu.com/math?formula=%5Ckappa" alt="\kappa"></td><td>\kappa</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CLambda" alt="\Lambda"></td><td>\Lambda</td><td><img src="https://math.jianshu.com/math?formula=%5Clambda" alt="\lambda"></td><td>\lambda</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=M" alt="M"></td><td>M</td><td><img src="https://math.jianshu.com/math?formula=%5Cmu" alt="\mu"></td><td>\mu</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=N" alt="N"></td><td>N</td><td><img src="https://math.jianshu.com/math?formula=%5Cnu" alt="\nu"></td><td>\nu</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CXi" alt="\Xi"></td><td>\Xi</td><td><img src="https://math.jianshu.com/math?formula=%5Cxi" alt="\xi"></td><td>\xi</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=O" alt="O"></td><td>O</td><td><img src="https://math.jianshu.com/math?formula=%5Comicron" alt="\omicron"></td><td>\omicron</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CPi" alt="\Pi"></td><td>\Pi</td><td><img src="https://math.jianshu.com/math?formula=%5Cpi" alt="\pi"></td><td>\pi</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=P" alt="P"></td><td>P</td><td><img src="https://math.jianshu.com/math?formula=%5Crho" alt="\rho"></td><td>\rho</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CSigma" alt="\Sigma"></td><td>\Sigma</td><td><img src="https://math.jianshu.com/math?formula=%5Csigma" alt="\sigma"></td><td>\sigma</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=T" alt="T"></td><td>T</td><td><img src="https://math.jianshu.com/math?formula=%5Ctau" alt="\tau"></td><td>\tau</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CUpsilon" alt="\Upsilon"></td><td>\Upsilon</td><td><img src="https://math.jianshu.com/math?formula=%5Cupsilon" alt="\upsilon"></td><td>\upsilon</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CPhi" alt="\Phi"></td><td>\Phi</td><td><img src="https://math.jianshu.com/math?formula=%5Cphi" alt="\phi"></td><td>\phi</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=X" alt="X"></td><td>X</td><td><img src="https://math.jianshu.com/math?formula=%5Cchi" alt="\chi"></td><td>\chi</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5CPsi" alt="\Psi"></td><td>\Psi</td><td><img src="https://math.jianshu.com/math?formula=%5Cpsi" alt="\psi"></td><td>\psi</td></tr><tr><td><img src="https://math.jianshu.com/math?formula=%5COmega" alt="\Omega"></td><td>\Omega</td><td><img src="https://math.jianshu.com/math?formula=%5Comega" alt="\omega"></td><td>\omega</td></tr></tbody></table></div><h3 id="数学符号"><a href="#数学符号" class="headerlink" title="数学符号"></a>数学符号</h3><div class="table-container"><table><thead><tr><th>运算符</th><th>说明</th><th>实例</th><th>代码</th></tr></thead><tbody><tr><td>+</td><td>加</td><td><img src="https://math.jianshu.com/math?formula=x%20%2B%20y" alt="x + y"></td><td><script type="math/tex">x + y</script></td></tr><tr><td>-</td><td>减</td><td><img src="https://math.jianshu.com/math?formula=x%20-%20y" alt="x - y"></td><td><script type="math/tex">x - y</script></td></tr><tr><td>\times</td><td>乘</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Ctimes%20y" alt="x \times y"></td><td><script type="math/tex">x \times y</script></td></tr><tr><td>\cdot</td><td>乘</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Ccdot%20y" alt="x \cdot y"></td><td><script type="math/tex">x \cdot y</script></td></tr><tr><td>\ast</td><td>乘</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cast%20y" alt="x \ast y"></td><td><script type="math/tex">x \ast y</script></td></tr><tr><td>\div</td><td>除</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cdiv%20y" alt="x \div y"></td><td><script type="math/tex">x \div y</script></td></tr><tr><td>\frac</td><td>分数</td><td><img src="https://math.jianshu.com/math?formula=%5Cfrac%20xy" alt="\frac xy"></td><td><script type="math/tex">\frac{x}{y}</script></td></tr><tr><td>^</td><td>上标</td><td><img src="https://math.jianshu.com/math?formula=x%20%5E%20y" alt="x ^ y"></td><td><script type="math/tex">x ^ y</script></td></tr><tr><td>_</td><td>下标</td><td><img src="https://math.jianshu.com/math?formula=x%20_%20y" alt="x _ y"></td><td><script type="math/tex">x _ y</script></td></tr><tr><td>\sqrt</td><td>开二次方</td><td><img src="https://math.jianshu.com/math?formula=%5Csqrt%20x" alt="\sqrt x"></td><td><script type="math/tex">\sqrt x</script></td></tr><tr><td>\sqrt</td><td>开方</td><td><img src="https://math.jianshu.com/math?formula=%5Csqrt%5Bx%5D%7By%5E4%2B3y-1%7D" alt="\sqrt[x]{y^4+3y-1}"></td><td><script type="math/tex">\sqrt[x]{y^4+3y-1}</script></td></tr><tr><td>\lceil 和 \rceil</td><td>上取整</td><td><img src="https://math.jianshu.com/math?formula=%5Clceil%5Cfrac12%5Crceil" alt="\lceil\frac12\rceil"></td><td><script type="math/tex">\lceil\frac12\rceil</script></td></tr><tr><td>\lfloor 和 \rfloor</td><td>下取整</td><td><img src="https://math.jianshu.com/math?formula=%5Clfloor%5Cfrac12%5Crfloor" alt="\lfloor\frac12\rfloor"></td><td><script type="math/tex">\lfloor\frac12\rfloor</script></td></tr><tr><td>\pm</td><td>加减</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cpm%20y" alt="x \pm y"></td><td><script type="math/tex">x \pm y</script></td></tr><tr><td>\mp</td><td>减加</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cmp%20y" alt="x \mp y"></td><td><script type="math/tex">x \mp y</script></td></tr><tr><td>=</td><td>等于</td><td><img src="https://math.jianshu.com/math?formula=x%20%3D%20y" alt="x = y"></td><td><script type="math/tex">x = y</script></td></tr><tr><td>\leq</td><td>小于等于</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cleq%20y" alt="x \leq y"></td><td><script type="math/tex">x \leq y</script></td></tr><tr><td>\geq</td><td>大于等于</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cgeq%20y" alt="x \geq y"></td><td><script type="math/tex">x \geq y</script></td></tr><tr><td>\ngeq</td><td>不大于等于</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cngeq%20y" alt="x \ngeq y"></td><td><script type="math/tex">x \ngeq y</script></td></tr><tr><td>\not\geq</td><td>不大于等于</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cnot%5Cgeq%20y" alt="x \not\geq y"></td><td><script type="math/tex">x \not\geq y</script></td></tr><tr><td>\neq</td><td>不等于</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cneq%20y" alt="x \neq y"></td><td><script type="math/tex">x \neq y</script></td></tr><tr><td>\approx</td><td>约等于</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Capprox%20y" alt="x \approx y"></td><td><script type="math/tex">x \approx y</script></td></tr><tr><td>\equiv</td><td>恒等于</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cequiv%20y" alt="x \equiv y"></td><td><script type="math/tex">x \equiv y</script></td></tr><tr><td>\bigodot</td><td>定义运算符</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cbigodot%20y%3Dx%2By%5E2" alt="x \bigodot y=x+y^2"></td><td><script type="math/tex">x \bigodot y=x+y^2</script></td></tr><tr><td>\bigotimes</td><td>定义运算符</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cbigotimes%20y%3Dx%2By%5E2" alt="x \bigotimes y=x+y^2"></td><td><script type="math/tex">x \bigotimes y=x+y^2</script></td></tr><tr><td>\in</td><td>属于</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cin%20y" alt="x \in y"></td><td><script type="math/tex">x \in y</script></td></tr><tr><td>\notin</td><td>不属于</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cnotin%20y" alt="x \notin y"></td><td><script type="math/tex">x \notin y</script></td></tr><tr><td>\subset</td><td>子集</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Csubset%20y" alt="x \subset y"></td><td><script type="math/tex">x \subset y</script></td></tr><tr><td>\not\subset</td><td>非子集</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Cnot%5Csubset%20y" alt="x \not\subset y"></td><td><script type="math/tex">x \not\subset y</script></td></tr><tr><td>\subseteq</td><td>子集</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Csubseteq%20y" alt="x \subseteq y"></td><td><script type="math/tex">x \subseteq y</script></td></tr><tr><td>\supset</td><td>超集</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Csupset%20y" alt="x \supset y"></td><td><script type="math/tex">x \supset y</script></td></tr><tr><td>\supseteq</td><td>超集</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Csupseteq%20y" alt="x \supseteq y"></td><td><script type="math/tex">x \supseteq y</script></td></tr><tr><td>\cup</td><td>并</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Ccup%20y" alt="x \cup y"></td><td><script type="math/tex">x \cup y</script></td></tr><tr><td>\cap</td><td>交</td><td><img src="https://math.jianshu.com/math?formula=x%20%5Ccap%20y" alt="x \cap y"></td><td><script type="math/tex">x \cap y</script></td></tr><tr><td>\log</td><td>对数</td><td><img src="https://math.jianshu.com/math?formula=%5Clog(x" alt="\log(x)">)</td><td><script type="math/tex">\log(x)</script></td></tr><tr><td>\overline</td><td>平均数</td><td><img src="https://math.jianshu.com/math?formula=%5Coverline%7Bx%7D" alt="\overline{x}"></td><td><script type="math/tex">\overline{x}</script></td></tr><tr><td>\overline</td><td>连线符号</td><td><img src="https://math.jianshu.com/math?formula=%5Coverline%7Ba%2Bb%2Bc%2Bd%7D" alt="\overline{a+b+c+d}"></td><td><script type="math/tex">\overline{a+b+c+d}</script></td></tr><tr><td>\underline</td><td>下划线</td><td><img src="https://math.jianshu.com/math?formula=%5Cunderline%7Ba%2Bb%2Bc%2Bd%7D" alt="\underline{a+b+c+d}"></td><td><script type="math/tex">\underline{a+b+c+d}</script></td></tr><tr><td>\overbrace</td><td>上大括号</td><td><img src="https://math.jianshu.com/math?formula=%5Coverbrace%7Ba%2B%5Cunderbrace%7Bb%2Bc%7D_%7B1.0%7D%2Bd%7D%5E%7B2.0%7D" alt="\overbrace{a+\underbrace{b+c}_{1.0}+d}^{2.0}"></td><td><script type="math/tex">\overbrace{a+\underbrace{b+c}_{1.0}+d}^{2.0}</script></td></tr><tr><td>\underbrace</td><td>下大括号</td><td><img src="https://math.jianshu.com/math?formula=%5Cunderbrace%7Ba%2Bd%7D_3" alt="\underbrace{a+d}_3"></td><td><script type="math/tex">\underbrace{a+d}_3</script></td></tr><tr><td>\partial</td><td>部分</td><td><img src="https://math.jianshu.com/math?formula=%5Cfrac%7B%5Cpartial%20x%7D%7B%5Cpartial%20y%7D" alt="\frac{\partial x}{\partial y}"></td><td><script type="math/tex">\frac{\partial x}{\partial y}</script></td></tr><tr><td>\lim</td><td>极限</td><td><img src="https://math.jianshu.com/math?formula=%5Clim_%7Bx%5Cto%5Cinfty%7D" alt="\lim_{x\to\infty}"></td><td><script type="math/tex">\lim_{x\to\infty}</script></td></tr><tr><td>\displaystyle</td><td>块公式格式</td><td><img src="https://math.jianshu.com/math?formula=%5Cdisplaystyle%20%5Clim_%7Bx%5Cto%5Cinfty%7D" alt="\displaystyle \lim_{x\to\infty}"></td><td><script type="math/tex">\displaystyle \lim_{x\to\infty}</script></td></tr><tr><td>\sum</td><td>求和</td><td><img src="https://math.jianshu.com/math?formula=%5Csum_%7Bi%3D1%7D%5En" alt="\sum_{i=1}^n"></td><td><script type="math/tex">\sum_{i=1}^n</script></td></tr><tr><td>\infty</td><td>极限</td><td><img src="https://math.jianshu.com/math?formula=%5Csum_%7Bi%3D0%7D%5E%5Cinfty%20i%5E2" alt="\sum_{i=0}^\infty i^2"></td><td><script type="math/tex">\sum_{i=0}^\infty i^2</script></td></tr><tr><td>\int</td><td>积分</td><td><img src="https://math.jianshu.com/math?formula=%5Cint_0%5E1%20x%5E2%20%7B%5Crm%20d%7Dx" alt="\int_0^1 x^2 {\rm d}x"></td><td><script type="math/tex">\int_0^1 x^2 {\rm d}x</script></td></tr><tr><td>\iint</td><td>二重积分</td><td><img src="https://math.jianshu.com/math?formula=%5Ciint_D%20f(x%2Cy" alt="\iint_D f(x,y)d\sigma">d%5Csigma)</td><td><script type="math/tex">\iint_D f(x,y)d\sigma</script></td></tr><tr><td>\oint</td><td>曲面积分</td><td><img src="https://math.jianshu.com/math?formula=%5Coint%20e%5E%7Bx%2By%7D%20ds" alt="\oint e^{x+y} ds"></td><td><script type="math/tex">\oint e^{x+y} ds</script></td></tr><tr><td>\ldots</td><td>底端对齐的省略号</td><td><img src="https://math.jianshu.com/math?formula=1%2C2%2C%5Cldots%2Cn" alt="1,2,\ldots,n"></td><td><script type="math/tex">1,2,\ldots,n</script></td></tr><tr><td>\cdots</td><td>中线对齐的省略号</td><td><img src="https://math.jianshu.com/math?formula=x_1%5E2%20%2B%20x_2%5E2%20%2B%20%5Ccdots%20%2B%20x_n%5E2" alt="x_1^2 + x_2^2 + \cdots + x_n^2"></td><td><script type="math/tex">x_1^2 + x_2^2 + \cdots + x_n^2</script></td></tr><tr><td>\uparrow</td><td>上箭头</td><td><img src="https://math.jianshu.com/math?formula=%5Cuparrow" alt="\uparrow"></td><td><script type="math/tex">\uparrow</script></td></tr><tr><td>\Uparrow</td><td>上箭头</td><td><img src="https://math.jianshu.com/math?formula=%5CUparrow" alt="\Uparrow"></td><td><script type="math/tex">\Uparrow</script></td></tr><tr><td>\vec</td><td>向量</td><td><img src="https://math.jianshu.com/math?formula=%5Cvec%7Ba%7D" alt="\vec{a}"></td><td><script type="math/tex">\vec{a}</script></td></tr><tr><td>\hat</td><td>拟合值</td><td><img src="https://math.jianshu.com/math?formula=%5Chat%20Y%20%3D%20%5Chat%20%5Cbeta_0%20%2B%20%5Chat%20%5Cbeta_1X" alt="\hat Y = \hat \beta_0 + \hat \beta_1X"></td><td><script type="math/tex">\hat Y = \hat \beta_0 + \hat \beta_1X</script></td></tr><tr><td>\bot</td><td>垂直</td><td><img src="https://math.jianshu.com/math?formula=A%20%5Cbot%20B" alt="A \bot B"></td><td><script type="math/tex">A \bot B</script></td></tr><tr><td>\circ</td><td>度</td><td><img src="https://math.jianshu.com/math?formula=45%5E%5Ccirc" alt="45^\circ"></td><td><script type="math/tex">45^\circ</script></td></tr><tr><td>\frac</td><td>括号自适应大小</td><td><img src="https://math.jianshu.com/math?formula=(%5Cfrac12" alt="(\frac12)">)——<img src="https://math.jianshu.com/math?formula=%5Cleft(%5Cfrac12%5Cright" alt="\left(\frac12\right)">)——</td><td><code>$(\frac12)$——$ \left(\frac12\right)$——</code></td></tr><tr><td></td><td>方程组</td><td><img src="https://math.jianshu.com/math?formula=%5Cleft%5C%7B%5Cbegin%7Barray%7D%5C%5Cy%3D2x%5E2%2B1%5C%5C%7By%3D4x%3B%7D%5C%5Cy-z%3Dx%3B%20%5Cend%7Barray%7D%5Cright." alt="\left\{\begin{array}\\y=2x^2+1\\{y=4x;}\\y-z=x; \end{array}\right."></td><td><script type="math/tex">\left\{\begin{array}\\y=2x^2+1\\{y=4x;}\\y-z=x; \end{array}\right.</script></td></tr></tbody></table></div><h3 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h3><div class="table-container"><table><thead><tr><th>描述</th><th>符号</th><th>代码</th></tr></thead><tbody><tr><td></td><td><img src="https://math.jianshu.com/math?formula=%5Csideset%7B%5E1_2%7D%7B%5E3_4%7D%5Cbigotimes" alt="\sideset{^1_2}{^3_4}\bigotimes"></td><td><script type="math/tex">\sideset{^1_2}{^3_4}\bigotimes</script></td></tr></tbody></table></div><blockquote><p><em>参考文章：<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fblog.csdn.net%2Fwhqet%2Farticle%2Fdetails%2F44277965">http://blog.csdn.net/whqet/article/details/44277965</a></em></p></blockquote><h2 id="函数、符号及特殊字符"><a href="#函数、符号及特殊字符" class="headerlink" title="函数、符号及特殊字符"></a>函数、符号及特殊字符</h2><h3 id="声调"><a href="#声调" class="headerlink" title="声调"></a>声调</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">\bar{x}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbar%7Bx%7D" alt="\bar{x}"></td><td><script type="math/tex">\acute{\eta}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cacute%7B%5Ceta%7D" alt="\acute{\eta}"></td></tr><tr><td><script type="math/tex">\check{\alpha}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccheck%7B%5Calpha%7D" alt="\check{\alpha}"></td><td><script type="math/tex">\grave{\eta}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cgrave%7B%5Ceta%7D" alt="\grave{\eta}"></td></tr><tr><td><script type="math/tex">\breve{a}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbreve%7Ba%7D" alt="\breve{a}"></td><td><script type="math/tex">\ddot{y}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cddot%7By%7D" alt="\ddot{y}"></td></tr><tr><td><script type="math/tex">\dot{x}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdot%7Bx%7D" alt="\dot{x}"></td><td><script type="math/tex">\hat{\alpha}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Chat%7B%5Calpha%7D" alt="\hat{\alpha}"></td></tr><tr><td><script type="math/tex">\tilde{\iota}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ctilde%7B%5Ciota%7D" alt="\tilde{\iota}"></td><td></td></tr></tbody></table></div><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">\sin\theta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csin%5C!%5Ctheta" alt="\sin\!\theta"></td><td><script type="math/tex">\cos\theta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccos%5C!%5Ctheta" alt="\cos\!\theta"></td></tr><tr><td><script type="math/tex">\tan\theta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ctan%5C!%5Ctheta" alt="\tan\!\theta"></td><td><script type="math/tex">\arcsin\frac{L}{r}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Carcsin%5Cfrac%7BL%7D%7Br%7D" alt="\arcsin\frac{L}{r}"></td></tr><tr><td><script type="math/tex">\arccos\frac{T}{r}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Carccos%5Cfrac%7BT%7D%7Br%7D" alt="\arccos\frac{T}{r}"></td><td><script type="math/tex">\arctan\frac{L}{T}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Carctan%5Cfrac%7BL%7D%7BT%7D" alt="\arctan\frac{L}{T}"></td></tr><tr><td><script type="math/tex">\sinh g</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csinh%5C!g" alt="\sinh\!g"></td><td><script type="math/tex">\cosh h</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccosh%5C!h" alt="\cosh\!h"></td></tr><tr><td><script type="math/tex">\tanh i</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ctanh%5C!i" alt="\tanh\!i"></td><td><script type="math/tex">\operatorname{sh}j</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coperatorname%7Bsh%7Dj" alt="\operatorname{sh}j"></td></tr><tr><td><script type="math/tex">\operatorname{argsh}k</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coperatorname%7Bargsh%7Dk" alt="\operatorname{argsh}k"></td><td><script type="math/tex">\operatorname{ch}h</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coperatorname%7Bch%7Dh" alt="\operatorname{ch}h"></td></tr><tr><td><script type="math/tex">\operatorname{argch}l</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coperatorname%7Bargch%7Dl" alt="\operatorname{argch}l"></td><td><script type="math/tex">\operatorname{th}i</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coperatorname%7Bth%7Di" alt="\operatorname{th}i"></td></tr><tr><td><script type="math/tex">\operatorname{argth}m</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coperatorname%7Bargth%7Dm" alt="\operatorname{argth}m"></td><td><script type="math/tex">k'(x)=\lim_{\Delta x\to 0}\frac{k(x)-k(x-\Delta x)}{\Deltax}</script></td><td><img src="https://math.jianshu.com/math?formula=k%27(x" alt="k&#39;(x)=\lim_{\Delta x\to0}\!\frac{k(x)-k(x-\Delta x)}{\Delta x}">%3D%5Clim_%7B%5CDelta%20x%5Cto0%7D%5C!%5Cfrac%7Bk(x)-k(x-%5CDelta%20x)%7D%7B%5CDelta%20x%7D)</td></tr><tr><td><script type="math/tex">\limsup S</script></td><td><img src="https://math.jianshu.com/math?formula=%5Climsup%20S" alt="\limsup S"></td><td><script type="math/tex">\liminf I</script></td><td><img src="https://math.jianshu.com/math?formula=%5Climinf%20I" alt="\liminf I"></td></tr><tr><td><script type="math/tex">\max H</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cmax%5C!H" alt="\max\!H"></td><td><script type="math/tex">\min L</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cmin%5C!L" alt="\min\!L"></td></tr><tr><td><script type="math/tex">\inf s</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cinf%20s" alt="\inf s"></td><td><script type="math/tex">\sup t</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csup%20t" alt="\sup t"></td></tr><tr><td><script type="math/tex">\exp\!t</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cexp%5C!t" alt="\exp\!t"></td><td><script type="math/tex">\ln X</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cln%5C!X" alt="\ln\!X"></td></tr><tr><td><script type="math/tex">\lg X</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clg%5C!X" alt="\lg\!X"></td><td><script type="math/tex">\log X</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clog%5C!X" alt="\log\!X"></td></tr><tr><td><script type="math/tex">\log_\alpha X</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clog_%5Calpha%5C!X" alt="\log_\alpha\!X"></td><td><script type="math/tex">\ker x</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cker%20x" alt="\ker x"></td></tr><tr><td><script type="math/tex">\deg x</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdeg%5C!x" alt="\deg\!x"></td><td><script type="math/tex">\gcd(T,U,V,W,X)</script></td><td><img src="https://math.jianshu.com/math?formula=%5C!%5Cgcd(T%2CU%2CV%2CW%2CX" alt="\!\gcd(T,U,V,W,X)">)</td></tr><tr><td><script type="math/tex">\Pr x</script></td><td><img src="https://math.jianshu.com/math?formula=%5CPr%20x" alt="\Pr x"></td><td><script type="math/tex">\det x</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdet%5C!x" alt="\det\!x"></td></tr><tr><td><script type="math/tex">\hom x</script></td><td><img src="https://math.jianshu.com/math?formula=%5Chom%20x" alt="\hom x"></td><td><script type="math/tex">\arg x</script></td><td><img src="https://math.jianshu.com/math?formula=%5Carg%20x" alt="\arg x"></td></tr><tr><td><script type="math/tex">\dim x</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdim%20x" alt="\dim x"></td><td><script type="math/tex">\lim_{t\to n}T</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clim_%7Bt%5Cto%20n%7DT" alt="\lim_{t\to n}T"></td></tr></tbody></table></div><h3 id="同余"><a href="#同余" class="headerlink" title="同余"></a>同余</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">\pmod {m}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cpmod%20%7Bm%7D" alt="\pmod {m}"></td><td><script type="math/tex">a \bmod b</script></td><td><img src="https://math.jianshu.com/math?formula=a%20%5Cbmod%20b" alt="a \bmod b"></td></tr></tbody></table></div><h3 id="微分"><a href="#微分" class="headerlink" title="微分"></a>微分</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">\nabla</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cnabla" alt="\nabla"></td><td><script type="math/tex">\partial x</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cpartial%20x" alt="\partial x"></td></tr><tr><td><script type="math/tex">\mathrm{d}x</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cmathrm%7Bd%7Dx" alt="\mathrm{d}x"></td><td><script type="math/tex">\dot x</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdot%20x" alt="\dot x"></td></tr><tr><td><script type="math/tex">\ddot y</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cddot%20y" alt="\ddot y"></td><td></td></tr></tbody></table></div><h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">\forall</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cforall" alt="\forall"></td><td><script type="math/tex">\exists</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cexists" alt="\exists"></td></tr><tr><td><script type="math/tex">\empty</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cempty" alt="\empty"></td><td><script type="math/tex">\emptyset</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cemptyset" alt="\emptyset"></td></tr><tr><td><script type="math/tex">\varnothing</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cvarnothing" alt="\varnothing"></td><td><script type="math/tex">\in</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cin" alt="\in"></td></tr><tr><td><script type="math/tex">\ni</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cni" alt="\ni"></td><td><script type="math/tex">\not\in</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cnot%5Cin" alt="\not\in"></td></tr><tr><td><script type="math/tex">\notin</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cnotin" alt="\notin"></td><td><script type="math/tex">\subset</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csubset" alt="\subset"></td></tr><tr><td><script type="math/tex">\subseteq</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csubseteq" alt="\subseteq"></td><td><script type="math/tex">\supset</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csupset" alt="\supset"></td></tr><tr><td><script type="math/tex">\supseteq</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csupseteq" alt="\supseteq"></td><td><script type="math/tex">\cap</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccap" alt="\cap"></td></tr><tr><td><script type="math/tex">\bigcap</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbigcap" alt="\bigcap"></td><td><script type="math/tex">\cup</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccup" alt="\cup"></td></tr><tr><td><script type="math/tex">\bigcup</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbigcup" alt="\bigcup"></td><td><script type="math/tex">\biguplus</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbiguplus" alt="\biguplus"></td></tr><tr><td><script type="math/tex">\sqsubset</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csqsubset" alt="\sqsubset"></td><td><script type="math/tex">\sqsubseteq</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csqsubseteq" alt="\sqsubseteq"></td></tr><tr><td><script type="math/tex">\sqsupset</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csqsupset" alt="\sqsupset"></td><td><script type="math/tex">\sqsupseteq</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csqsupseteq" alt="\sqsupseteq"></td></tr><tr><td><script type="math/tex">\sqcap</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csqcap" alt="\sqcap"></td><td><script type="math/tex">\sqcup</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csqcup" alt="\sqcup"></td></tr></tbody></table></div><h3 id="逻辑"><a href="#逻辑" class="headerlink" title="逻辑"></a>逻辑</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">p</script></td><td><img src="https://math.jianshu.com/math?formula=p" alt="p"></td><td><script type="math/tex">\land</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cland" alt="\land"></td></tr><tr><td><script type="math/tex">\wedge</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cwedge" alt="\wedge"></td><td><script type="math/tex">\bigwedge</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbigwedge" alt="\bigwedge"></td></tr><tr><td><script type="math/tex">\bar{q} \to p</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cpagecolor%7BWhite%7D%20%5Cbar%7Bq%7D%20%5Cto%20p" alt="\pagecolor{White} \bar{q} \to p"></td><td><script type="math/tex">\lor</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clor" alt="\lor"></td></tr><tr><td><script type="math/tex">\vee</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cvee" alt="\vee"></td><td><script type="math/tex">\bigvee</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbigvee" alt="\bigvee"></td></tr><tr><td><script type="math/tex">\lnot</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clnot" alt="\lnot"></td><td><script type="math/tex">\neg q</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cneg%20q" alt="\neg q"></td></tr><tr><td><script type="math/tex">\setminus</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csetminus" alt="\setminus"></td><td><script type="math/tex">\smallsetminus</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csmallsetminus" alt="\smallsetminus"></td></tr></tbody></table></div><h3 id="根号"><a href="#根号" class="headerlink" title="根号"></a>根号</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">\sqrt{2}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csqrt%7B2%7D" alt="\sqrt{2}"></td><td><script type="math/tex">\sqrt[2]{5}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csqrt%5B2%5D%7B5%7D" alt="\sqrt[2]{5}"></td></tr></tbody></table></div><h3 id="关系符号"><a href="#关系符号" class="headerlink" title="关系符号"></a>关系符号</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">\Delta ABC\sim\Delta XYZ</script></td><td><img src="https://math.jianshu.com/math?formula=%5CDelta%20ABC%5Csim%5CDelta%20XYZ%5C!" alt="\Delta ABC\sim\Delta XYZ\!"></td><td><script type="math/tex">\sqrt{3}\approx1.732050808\ldots</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csqrt%7B3%7D%5Capprox1.732050808%5Cldots" alt="\sqrt{3}\approx1.732050808\ldots"></td></tr><tr><td><script type="math/tex">\simeq</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csimeq" alt="\simeq"></td><td><script type="math/tex">\cong</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccong" alt="\cong"></td></tr><tr><td><script type="math/tex">\dot=</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdot%3D" alt="\dot="></td><td><script type="math/tex">\ggg</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cggg" alt="\ggg"></td></tr><tr><td><script type="math/tex">\gg</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cgg" alt="\gg"></td><td><script type="math/tex">></script></td><td><img src="https://math.jianshu.com/math?formula=%3E%5C%2C" alt="&gt;\,"></td></tr><tr><td><script type="math/tex">\ge</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cge" alt="\ge"></td><td><script type="math/tex">\geqq</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cgeqq" alt="\geqq"></td></tr><tr><td><script type="math/tex">=</script></td><td><img src="https://math.jianshu.com/math?formula=%3D%5C%2C" alt="=\,"></td><td><script type="math/tex">\leq</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cleq" alt="\leq"></td></tr><tr><td><script type="math/tex">\leqq</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cleqq" alt="\leqq"></td><td><script type="math/tex"><</script></td><td><img src="https://math.jianshu.com/math?formula=%3C%5C%2C" alt="&lt;\,"></td></tr><tr><td><script type="math/tex">\ll</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cll" alt="\ll"></td><td><script type="math/tex">\lll</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clll" alt="\lll"></td></tr><tr><td><script type="math/tex">(x-y)^2\equiv(-x+y)^2\equiv x^2-2xy+y^2</script></td><td><img src="https://math.jianshu.com/math?formula=(x-y" alt="(x-y)^2\equiv(-x+y)^2\equiv x^2-2xy+y^2">%5E2%5Cequiv(-x%2By)%5E2%5Cequiv%20x%5E2-2xy%2By%5E2)</td><td><script type="math/tex">x\not\equiv N</script></td><td><img src="https://math.jianshu.com/math?formula=x%5Cnot%5Cequiv%20N" alt="x\not\equiv N"></td></tr><tr><td><script type="math/tex">x\ne A</script></td><td><img src="https://math.jianshu.com/math?formula=x%5Cne%20A" alt="x\ne A"></td><td><script type="math/tex">x\neq C</script></td><td><img src="https://math.jianshu.com/math?formula=x%5Cneq%20C" alt="x\neq C"></td></tr><tr><td><script type="math/tex">t\propto v</script></td><td><img src="https://math.jianshu.com/math?formula=t%5Cpropto%20v" alt="t\propto v"></td><td><script type="math/tex">\pm</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cpm" alt="\pm"></td></tr></tbody></table></div><h3 id="几何符号"><a href="#几何符号" class="headerlink" title="几何符号"></a>几何符号</h3><div class="table-container"><table><thead><tr><th>特征</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td>菱形</td><td><script type="math/tex">\Diamond</script></td><td><img src="https://math.jianshu.com/math?formula=%5CDiamond" alt="\Diamond"></td></tr><tr><td>正方形</td><td><script type="math/tex">\Box</script></td><td><img src="https://math.jianshu.com/math?formula=%5CBox" alt="\Box"></td></tr><tr><td>Delta</td><td><script type="math/tex">\Delta</script></td><td><img src="https://math.jianshu.com/math?formula=%5CDelta" alt="\Delta"></td></tr><tr><td>三角图形</td><td><script type="math/tex">\triangle</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ctriangle" alt="\triangle"></td></tr><tr><td>角名</td><td><script type="math/tex">\angle\Alpha\Beta\Gamma</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cangle%5CAlpha%5CBeta%5CGamma" alt="\angle\Alpha\Beta\Gamma"></td></tr><tr><td>角度</td><td><script type="math/tex">\sin \frac{\pi}{3}=\sin60^\circ=\frac{\sqrt{3}}{2}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csin%20%5Cfrac%7B%5Cpi%7D%7B3%7D%3D%5Csin60%5E%5Ccirc%3D%5Cfrac%7B%5Csqrt%7B3%7D%7D%7B2%7D" alt="\sin \frac{\pi}{3}=\sin60^\circ=\frac{\sqrt{3}}{2}"></td></tr><tr><td>垂直</td><td><script type="math/tex">\perp</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cperp" alt="\perp"></td></tr></tbody></table></div><h3 id="箭头符号"><a href="#箭头符号" class="headerlink" title="箭头符号"></a>箭头符号</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">\leftarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cleftarrow" alt="\leftarrow"></td><td><script type="math/tex">\gets</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cgets" alt="\gets"></td></tr><tr><td><script type="math/tex">\rightarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Crightarrow" alt="\rightarrow"></td><td><script type="math/tex">\to</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cto" alt="\to"></td></tr><tr><td><script type="math/tex">\leftrightarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cleftrightarrow" alt="\leftrightarrow"></td><td><script type="math/tex">\longleftarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clongleftarrow" alt="\longleftarrow"></td></tr><tr><td><script type="math/tex">\longrightarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clongrightarrow" alt="\longrightarrow"></td><td><script type="math/tex">\mapsto</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cmapsto" alt="\mapsto"></td></tr><tr><td><script type="math/tex">\longmapsto</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clongmapsto" alt="\longmapsto"></td><td><script type="math/tex">\hookrightarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Chookrightarrow" alt="\hookrightarrow"></td></tr><tr><td><script type="math/tex">\hookleftarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Chookleftarrow" alt="\hookleftarrow"></td><td><script type="math/tex">\nearrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cnearrow" alt="\nearrow"></td></tr><tr><td><script type="math/tex">\searrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csearrow" alt="\searrow"></td><td><script type="math/tex">\swarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cswarrow" alt="\swarrow"></td></tr><tr><td><script type="math/tex">\nwarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cnwarrow" alt="\nwarrow"></td><td><script type="math/tex">\uparrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cuparrow" alt="\uparrow"></td></tr><tr><td><script type="math/tex">\downarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdownarrow" alt="\downarrow"></td><td><script type="math/tex">\updownarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cupdownarrow" alt="\updownarrow"></td></tr><tr><td><script type="math/tex">\rightharpoonup</script></td><td><img src="https://math.jianshu.com/math?formula=%5Crightharpoonup" alt="\rightharpoonup"></td><td><script type="math/tex">\rightharpoondown</script></td><td><img src="https://math.jianshu.com/math?formula=%5Crightharpoondown" alt="\rightharpoondown"></td></tr><tr><td><script type="math/tex">\leftharpoonup</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cleftharpoonup" alt="\leftharpoonup"></td><td><script type="math/tex">\leftharpoondown</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cleftharpoondown" alt="\leftharpoondown"></td></tr><tr><td><script type="math/tex">\upharpoonleft</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cupharpoonleft" alt="\upharpoonleft"></td><td><script type="math/tex">\upharpoonright</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cupharpoonright" alt="\upharpoonright"></td></tr><tr><td><script type="math/tex">\Leftarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5CLeftarrow" alt="\Leftarrow"></td><td><script type="math/tex">\Rightarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5CRightarrow" alt="\Rightarrow"></td></tr><tr><td><script type="math/tex">\Leftrightarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5CLeftrightarrow" alt="\Leftrightarrow"></td><td><script type="math/tex">\Longleftarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5CLongleftarrow" alt="\Longleftarrow"></td></tr><tr><td><script type="math/tex">\Longrightarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5CLongrightarrow" alt="\Longrightarrow"></td><td><script type="math/tex">\Longleftrightarrow (or \iff)</script></td><td><img src="https://math.jianshu.com/math?formula=%5CLongleftrightarrow" alt="\Longleftrightarrow"></td></tr><tr><td><script type="math/tex">\Uparrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5CUparrow" alt="\Uparrow"></td><td><script type="math/tex">\Downarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5CDownarrow" alt="\Downarrow"></td></tr><tr><td><script type="math/tex">\Updownarrow</script></td><td><img src="https://math.jianshu.com/math?formula=%5CUpdownarrow" alt="\Updownarrow"></td><td></td></tr></tbody></table></div><h3 id="特殊符号-1"><a href="#特殊符号-1" class="headerlink" title="特殊符号"></a>特殊符号</h3><div class="table-container"><table><thead><tr><th>语法</th><th>效果</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td><script type="math/tex">\eth</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ceth" alt="\eth"></td><td><script type="math/tex">\S</script></td><td><img src="https://math.jianshu.com/math?formula=%5CS" alt="\S"></td></tr><tr><td><script type="math/tex">\%</script></td><td><img src="https://math.jianshu.com/math?formula=%5C%25" alt="\%"></td><td></td><td></td></tr><tr><td><script type="math/tex">\dagger</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdagger" alt="\dagger"></td><td><script type="math/tex">\ddagger</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cddagger" alt="\ddagger"></td></tr><tr><td><script type="math/tex">\star</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cstar" alt="\star"></td><td><script type="math/tex">*</script></td><td><img src="https://math.jianshu.com/math?formula=*" alt="*"></td></tr><tr><td><script type="math/tex">\ldots</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cldots" alt="\ldots"></td><td><script type="math/tex">\smile</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csmile" alt="\smile"></td></tr><tr><td><script type="math/tex">\frown</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cfrown" alt="\frown"></td><td><script type="math/tex">\wr</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cwr" alt="\wr"></td></tr><tr><td><script type="math/tex">\oplus</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coplus" alt="\oplus"></td><td><script type="math/tex">\bigoplus</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbigoplus" alt="\bigoplus"></td></tr><tr><td><script type="math/tex">\otimes</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cotimes" alt="\otimes"></td><td><script type="math/tex">\bigotimes</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbigotimes" alt="\bigotimes"></td></tr><tr><td><script type="math/tex">\times</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ctimes" alt="\times"></td><td><script type="math/tex">\cdot</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccdot" alt="\cdot"></td></tr><tr><td><script type="math/tex">\div</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdiv" alt="\div"></td><td><script type="math/tex">\circ</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccirc" alt="\circ"></td></tr><tr><td><script type="math/tex">\bullet</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbullet" alt="\bullet"></td><td><script type="math/tex">\bigodot</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbigodot" alt="\bigodot"></td></tr><tr><td><script type="math/tex">\boxtimes</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cboxtimes" alt="\boxtimes"></td><td><script type="math/tex">\boxplus</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cboxplus" alt="\boxplus"></td></tr><tr><td><script type="math/tex">\triangleleft</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ctriangleleft" alt="\triangleleft"></td><td><script type="math/tex">\triangleright</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ctriangleright" alt="\triangleright"></td></tr><tr><td><script type="math/tex">\infty</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cinfty" alt="\infty"></td><td><script type="math/tex">\bot</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbot" alt="\bot"></td></tr><tr><td><script type="math/tex">\top</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ctop" alt="\top"></td><td><script type="math/tex">\vdash</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cvdash" alt="\vdash"></td></tr><tr><td><script type="math/tex">\vDash</script></td><td><img src="https://math.jianshu.com/math?formula=%5CvDash" alt="\vDash"></td><td><script type="math/tex">\Vdash</script></td><td><img src="https://math.jianshu.com/math?formula=%5CVdash" alt="\Vdash"></td></tr><tr><td><script type="math/tex">\models</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cmodels" alt="\models"></td><td><script type="math/tex">\lVert</script></td><td><img src="https://math.jianshu.com/math?formula=%5ClVert" alt="\lVert"></td></tr><tr><td><script type="math/tex">\rVert</script></td><td><img src="https://math.jianshu.com/math?formula=%5CrVert" alt="\rVert"></td><td></td><td></td></tr><tr><td><script type="math/tex">\imath</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cimath" alt="\imath"></td><td><script type="math/tex">\hbar</script></td><td><img src="https://math.jianshu.com/math?formula=%5Chbar" alt="\hbar"></td></tr><tr><td><script type="math/tex">\ell</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cell" alt="\ell"></td><td><script type="math/tex">\mho</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cmho" alt="\mho"></td></tr><tr><td><script type="math/tex">\Finv</script></td><td><img src="https://math.jianshu.com/math?formula=%5CFinv" alt="\Finv"></td><td><script type="math/tex">\Re</script></td><td><img src="https://math.jianshu.com/math?formula=%5CRe" alt="\Re"></td></tr><tr><td><script type="math/tex">\Im</script></td><td><img src="https://math.jianshu.com/math?formula=%5CIm" alt="\Im"></td><td><script type="math/tex">\wp</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cwp" alt="\wp"></td></tr><tr><td><script type="math/tex">\complement</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccomplement" alt="\complement"></td><td></td><td></td></tr><tr><td><script type="math/tex">\diamondsuit</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdiamondsuit" alt="\diamondsuit"></td><td><script type="math/tex">\heartsuit</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cheartsuit" alt="\heartsuit"></td></tr><tr><td><script type="math/tex">\clubsuit</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cclubsuit" alt="\clubsuit"></td><td><script type="math/tex">\spadesuit</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cspadesuit" alt="\spadesuit"></td></tr><tr><td><script type="math/tex">\Game</script></td><td><img src="https://math.jianshu.com/math?formula=%5CGame" alt="\Game"></td><td><script type="math/tex">\flat</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cflat" alt="\flat"></td></tr><tr><td><script type="math/tex">\natural</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cnatural" alt="\natural"></td><td><script type="math/tex">\sharp</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csharp" alt="\sharp"></td></tr></tbody></table></div><h3 id="上标、下标、积分等"><a href="#上标、下标、积分等" class="headerlink" title="上标、下标、积分等"></a>上标、下标、积分等</h3><div class="table-container"><table><thead><tr><th>功能</th><th>语法</th><th>效果</th></tr></thead><tbody><tr><td>上标</td><td><script type="math/tex">a^2</script></td><td><img src="https://math.jianshu.com/math?formula=a%5E2" alt="a^2"></td></tr><tr><td>下标</td><td><script type="math/tex">a_2</script></td><td><img src="https://math.jianshu.com/math?formula=a_2" alt="a_2"></td></tr><tr><td>组合</td><td><script type="math/tex">a^{2+2}</script></td><td><img src="https://math.jianshu.com/math?formula=a%5E%7B2%2B2%7D" alt="a^{2+2}"></td></tr><tr><td>组合</td><td><script type="math/tex">a_{i,j}</script></td><td><img src="https://math.jianshu.com/math?formula=a_%7Bi%2Cj%7D" alt="a_{i,j}"></td></tr><tr><td>结合上下标</td><td><script type="math/tex">x_2^3</script></td><td><img src="https://math.jianshu.com/math?formula=x_2%5E3" alt="x_2^3"></td></tr><tr><td>前置上下标</td><td><script type="math/tex">{}_1^2\!X_3^4</script></td><td><img src="https://math.jianshu.com/math?formula=%7B%7D_1%5E2%5C!X_3%5E4" alt="{}_1^2\!X_3^4"></td></tr><tr><td>导数</td><td><script type="math/tex">x'</script></td><td><img src="https://math.jianshu.com/math?formula=x%27" alt="x&#39;"></td></tr><tr><td>导数点1</td><td><script type="math/tex">\dot{x}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cdot%7Bx%7D" alt="\dot{x}"></td></tr><tr><td>导数点2</td><td><script type="math/tex">\ddot{y}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cddot%7By%7D" alt="\ddot{y}"></td></tr><tr><td>向量1</td><td><script type="math/tex">\vec{c}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cvec%7Bc%7D" alt="\vec{c}"></td></tr><tr><td>向量2</td><td><script type="math/tex">\overleftarrow{a b}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coverleftarrow%7Ba%20b%7D" alt="\overleftarrow{a b}"></td></tr><tr><td>向量3</td><td><script type="math/tex">\overrightarrow{c d}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coverrightarrow%7Bc%20d%7D" alt="\overrightarrow{c d}"></td></tr><tr><td>向量4</td><td><script type="math/tex">\widehat{e f g}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cwidehat%7Be%20f%20g%7D" alt="\widehat{e f g}"></td></tr><tr><td>上弧(注: 正确应该用 \overarc, 但在这里行不通。要用建议的语法作为解决办法)</td><td><script type="math/tex">\overset{\frown} {AB}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coverset%7B%5Cfrown%7D%20%7BAB%7D" alt="\overset{\frown} {AB}"></td></tr><tr><td>上划线1</td><td><script type="math/tex">\overline{h i j}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coverline%7Bh%20i%20j%7D" alt="\overline{h i j}"></td></tr><tr><td>下划线2</td><td><script type="math/tex">\underline{k l m}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cunderline%7Bk%20l%20m%7D" alt="\underline{k l m}"></td></tr><tr><td>上括号1</td><td><script type="math/tex">\overbrace{1+2+\cdots+100}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coverbrace%7B1%2B2%2B%5Ccdots%2B100%7D" alt="\overbrace{1+2+\cdots+100}"></td></tr><tr><td>上括号2</td><td><script type="math/tex">\begin{matrix} 5050 \\ \overbrace{ 1+2+\cdots+100 }\end{matrix}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbegin%7Bmatrix%7D%205050%20%5C%5C%20%5Coverbrace%7B%201%2B2%2B%5Ccdots%2B100%20%7D%5Cend%7Bmatrix%7D" alt="\begin{matrix} 5050 \\ \overbrace{ 1+2+\cdots+100 }\end{matrix}"></td></tr><tr><td>下括号1</td><td><script type="math/tex">\underbrace{a+b+\cdots+z}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cunderbrace%7Ba%2Bb%2B%5Ccdots%2Bz%7D" alt="\underbrace{a+b+\cdots+z}"></td></tr><tr><td>下括号2</td><td><script type="math/tex">\begin{matrix} \underbrace{ a+b+\cdots+z } \\ 26\end{matrix}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbegin%7Bmatrix%7D%20%5Cunderbrace%7B%20a%2Bb%2B%5Ccdots%2Bz%20%7D%20%5C%5C%2026%5Cend%7Bmatrix%7D" alt="\begin{matrix} \underbrace{ a+b+\cdots+z } \\ 26\end{matrix}"></td></tr><tr><td>求和 1</td><td><script type="math/tex">\sum_{k=1}^N k^2</script></td><td><img src="https://math.jianshu.com/math?formula=%5Csum_%7Bk%3D1%7D%5EN%20k%5E2" alt="\sum_{k=1}^N k^2"></td></tr><tr><td>求和 2</td><td><script type="math/tex">\begin{matrix} \sum_{k=1}^N k^2 \end{matrix}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbegin%7Bmatrix%7D%20%5Csum_%7Bk%3D1%7D%5EN%20k%5E2%20%5Cend%7Bmatrix%7D" alt="\begin{matrix} \sum_{k=1}^N k^2 \end{matrix}"></td></tr><tr><td>求积 1</td><td><script type="math/tex">\prod_{i=1}^N x_i</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cprod_%7Bi%3D1%7D%5EN%20x_i" alt="\prod_{i=1}^N x_i"></td></tr><tr><td>求积 2</td><td><script type="math/tex">\begin{matrix} \prod_{i=1}^N x_i \end{matrix}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbegin%7Bmatrix%7D%20%5Cprod_%7Bi%3D1%7D%5EN%20x_i%20%5Cend%7Bmatrix%7D" alt="\begin{matrix} \prod_{i=1}^N x_i \end{matrix}"></td></tr><tr><td>上积 1</td><td><script type="math/tex">\coprod_{i=1}^N x_i</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ccoprod_%7Bi%3D1%7D%5EN%20x_i" alt="\coprod_{i=1}^N x_i"></td></tr><tr><td>上积 2</td><td><script type="math/tex">\begin{matrix} \coprod_{i=1}^N x_i\end{matrix}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbegin%7Bmatrix%7D%20%5Ccoprod_%7Bi%3D1%7D%5EN%20x_i%5Cend%7Bmatrix%7D" alt="\begin{matrix} \coprod_{i=1}^N x_i\end{matrix}"></td></tr><tr><td>极限 1</td><td><script type="math/tex">\lim_{n \to \infty}x_n</script></td><td><img src="https://math.jianshu.com/math?formula=%5Clim_%7Bn%20%5Cto%20%5Cinfty%7Dx_n" alt="\lim_{n \to \infty}x_n"></td></tr><tr><td>极限 2</td><td><script type="math/tex">\begin{matrix} \lim_{n \to \infty}x_n\end{matrix}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbegin%7Bmatrix%7D%20%5Clim_%7Bn%20%5Cto%20%5Cinfty%7Dx_n%5Cend%7Bmatrix%7D" alt="\begin{matrix} \lim_{n \to \infty}x_n\end{matrix}"></td></tr><tr><td>积分 1</td><td><script type="math/tex">\int_{-N}^{N} e^x\, dx</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cint_%7B-N%7D%5E%7BN%7D%20e%5Ex%5C%2C%20dx" alt="\int_{-N}^{N} e^x\, dx"></td></tr><tr><td>积分 2</td><td><script type="math/tex">\begin{matrix} \int_{-N}^{N} e^x\, dx\end{matrix}</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbegin%7Bmatrix%7D%20%5Cint_%7B-N%7D%5E%7BN%7D%20e%5Ex%5C%2C%20dx%5Cend%7Bmatrix%7D" alt="\begin{matrix} \int_{-N}^{N} e^x\, dx\end{matrix}"></td></tr><tr><td>双重积分</td><td><script type="math/tex">\iint_{D}^{W} \, dx\,dy</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ciint_%7BD%7D%5E%7BW%7D%20%5C%2C%20dx%5C%2Cdy" alt="\iint_{D}^{W} \, dx\,dy"></td></tr><tr><td>三重积分</td><td><script type="math/tex">\iiint_{E}^{V} \, dx\,dy\,dz</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ciiint_%7BE%7D%5E%7BV%7D%20%5C%2C%20dx%5C%2Cdy%5C%2Cdz" alt="\iiint_{E}^{V} \, dx\,dy\,dz"></td></tr><tr><td>四重积分</td><td><script type="math/tex">\iiiint_{F}^{U} \, dx\,dy\,dz\,dt</script></td><td><img src="https://math.jianshu.com/math?formula=%5Ciiiint_%7BF%7D%5E%7BU%7D%20%5C%2C%20dx%5C%2Cdy%5C%2Cdz%5C%2Cdt" alt="\iiiint_{F}^{U} \, dx\,dy\,dz\,dt"></td></tr><tr><td>闭合的曲线、曲面积分</td><td><script type="math/tex">\oint_{C} x^3\, dx + 4y^2\, dy</script></td><td><img src="https://math.jianshu.com/math?formula=%5Coint_%7BC%7D%20x%5E3%5C%2C%20dx%20%2B%204y%5E2%5C%2C%20dy" alt="\oint_{C} x^3\, dx + 4y^2\, dy"></td></tr><tr><td>交集</td><td><script type="math/tex">\bigcap_1^{n} p</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbigcap_1%5E%7Bn%7D%20p" alt="\bigcap_1^{n} p"></td></tr><tr><td>并集</td><td><script type="math/tex">\bigcup_1^{k} p</script></td><td><img src="https://math.jianshu.com/math?formula=%5Cbigcup_1%5E%7Bk%7D%20p" alt="\bigcup_1^{k} p"></td></tr></tbody></table></div><h3 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h3><div class="table-container"><table><thead><tr><th>功能</th><th>语法</th><th>显示</th><th>宽度</th></tr></thead><tbody><tr><td>2个quad空格</td><td><script type="math/tex">\alpha\qquad\beta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Calpha%5Cqquad%5Cbeta" alt="\alpha\qquad\beta"></td><td>2m</td></tr><tr><td>quad空格</td><td><script type="math/tex">\alpha\quad\beta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Calpha%5Cquad%5Cbeta" alt="\alpha\quad\beta"></td><td>m</td></tr><tr><td>大空格</td><td><script type="math/tex">\alpha\ \beta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Calpha%5C%20%5Cbeta" alt="\alpha\ \beta"></td><td><img src="https://math.jianshu.com/math?formula=%5Cfrac%7Bm%7D%7B3%7D" alt="\frac{m}{3}"></td></tr><tr><td>中等空格</td><td><script type="math/tex">\alpha\;\beta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Calpha%5C%3B%5Cbeta" alt="\alpha\;\beta"></td><td><img src="https://math.jianshu.com/math?formula=%5Cfrac%7B2m%7D%7B7%7D" alt="\frac{2m}{7}"></td></tr><tr><td>小空格</td><td><script type="math/tex">\alpha\,\beta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Calpha%5C%2C%5Cbeta" alt="\alpha\,\beta"></td><td><img src="https://math.jianshu.com/math?formula=%5Cfrac%7Bm%7D%7B6%7D" alt="\frac{m}{6}"></td></tr><tr><td>没有空格</td><td><script type="math/tex">\alpha\beta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Calpha%5Cbeta" alt="\alpha\beta"></td><td>0</td></tr><tr><td>紧贴</td><td><script type="math/tex">\alpha\!\beta</script></td><td><img src="https://math.jianshu.com/math?formula=%5Calpha%5C!%5Cbeta" alt="\alpha\!\beta"></td><td><img src="https://math.jianshu.com/math?formula=-%5Cfrac%7Bm%7D%7B6%7D" alt="-\frac{m}{6}"></td></tr></tbody></table></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Markdown-数学符号&quot;&gt;&lt;a href=&quot;#Markdown-数学符号&quot; class=&quot;headerlink&quot; title=&quot;Markdown 数学符号&quot;&gt;&lt;/a&gt;Markdown 数学符号&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;行内公式直接用&lt;script type=
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>深入理解什么是LSM-Tree</title>
    <link href="http://www.toberoot.com/news/2020/12/19/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E4%BB%80%E4%B9%88%E6%98%AFLSM-Tree/"/>
    <id>http://www.toberoot.com/news/2020/12/19/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E4%BB%80%E4%B9%88%E6%98%AFLSM-Tree/</id>
    <published>2020-12-19T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.583Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>近期在学习TiDB，而TiDB中基于 RocksDB 的 TiKV ，使用 LSM-tree，因此再次学习相关知识。</p></blockquote><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>十多年前，谷歌发布了大名鼎鼎的”三驾马车”的论文，分别是GFS(2003年)，MapReduce（2004年），BigTable（2006年），为开源界在大数据领域带来了无数的灵感，其中在 “BigTable” 的论文中很多很酷的方面之一就是它所使用的文件组织方式，这个方法更一般的名字叫 Log Structured-Merge Tree。在面对亿级别之上的海量数据的存储和检索的场景下，我们选择的数据库通常都是各种强力的NoSQL，比如Hbase，Cassandra，Leveldb，RocksDB等等，这其中前两者是Apache下面的顶级开源项目数据库，后两者分别是Google和Facebook开源的数据库存储引擎。而这些强大的NoSQL数据库都有一个共性，就是其底层使用的数据结构，都是仿照“BigTable”中的文件组织方式来实现的，也就是我们今天要介绍的LSM-Tree。</p><h3 id="什么是LSM-Tree"><a href="#什么是LSM-Tree" class="headerlink" title="什么是LSM-Tree"></a>什么是LSM-Tree</h3><p>LSM-Tree全称是Log Structured Merge Tree，是一种分层，有序，面向磁盘的数据结构，其核心思想是充分了利用了，磁盘批量的顺序写要远比随机写性能高出很多，如下图示：</p><p><img src="2020-12-19-深入理解什么是LSM-Tree/01.jpeg" alt=""></p><p>围绕这一原理进行设计和优化，以此让写性能达到最优，正如我们普通的Log的写入方式，这种结构的写入，全部都是以Append的模式追加，不存在删除和修改。当然有得就有舍，这种结构虽然大大提升了数据的写入能力，却是以牺牲部分读取性能为代价，故此这种结构通常适合于写多读少的场景。故LSM被设计来提供比传统的B+树或者ISAM更好的写操作吞吐量，通过消去随机的本地更新操作来达到这个目标。这里面最典型的例子就属于Kakfa了，把磁盘顺序写发挥到了极致，故而在大数据领域成为了互联网公司标配的分布式消息中间件组件。</p><p>虽然这种结构的写非常简单高效，但其缺点是对读取特别是随机读很不友好，这也是为什么日志通常用在下面的两种简单的场景：</p><p>（1） 数据是被整体访问的，大多数数据库的WAL（write ahead log）也称预写log，包括mysql的Binlog等</p><p>（2） 数据是通过文件的偏移量offset访问的，比如Kafka。</p><p>想要支持更复杂和高效的读取，比如按key查询和按range查询，就得需要做一步的设计，这也是LSM-Tree结构，除了利用磁盘顺序写之外，还划分了内存+磁盘多层的合并结构的原因，正是基于这种结构再加上不同的优化实现，才造就了在这之上的各种独具特点的NoSQL数据库，如Hbase，Cassandra，Leveldb，RocksDB，<a href="https://cloud.tencent.com/product/mongodb?from=10680">MongoDB</a>，TiDB等。</p><h3 id="SSTable-和-LSM-Tree"><a href="#SSTable-和-LSM-Tree" class="headerlink" title="SSTable 和 LSM-Tree"></a>SSTable 和 LSM-Tree</h3><p>提到LSM-Tree这种结构，就得提一下LevelDB这个存储引擎，我们知道Bigtable是谷歌开源的一篇论文，很难接触到它的源代码实现。如果说Bigtable是分布式闭源的一个高性能的KV系统，那么LevelDB就是这个KV系统开源的单机版实现，最为重要的是LevelDB是由Bigtable的原作者 Jeff Dean 和 Sanjay Ghemawat 共同完成，可以说高度复刻了Bigtable 论文中对于其实现的描述。</p><p>在LSM-Tree里面，核心的数据结构就是SSTable，全称是Sorted String Table，SSTable的概念其实也是来自于 Google 的 Bigtable 论文，论文中对 SSTable 的描述如下：</p><p>An SSTable provides a persistent, ordered immutable map from keys to values, where both keys and values are arbitrary byte strings. Operations are provided to look up the value associated with a specified key, and to iterate over all key/value pairs in a specified key range. Internally, each SSTable contains a sequence of blocks (typically each block is 64KB in size, but this is configurable). A block index (stored at the end of the SSTable) is used to locate blocks; the index is loaded into memory when the SSTable is opened. A lookup can be performed with a single disk seek: we first find the appropriate block by performing a binary search in the in-memory index, and then reading the appropriate block from disk. Optionally, an SSTable can be completely mapped into memory, which allows us to perform lookups and scans without touching disk.</p><p>如上所述，SSTable是一种拥有持久化，有序且不可变的的键值存储结构，它的key和value都是任意的字节数组，并且了提供了按指定key查找和指定范围的key区间迭代遍历的功能。SSTable内部包含了一系列可配置大小的Block块，典型的大小是64KB，关于这些Block块的index存储在SSTable的尾部，用于帮助快速查找特定的Block。当一个SSTable被打开的时候，index会被加载到内存，然后根据key在内存index里面进行一个二分查找，查到该key对应的磁盘的offset之后，然后去磁盘把响应的块数据读取出来。当然如果内存足够大的话，可以直接把SSTable直接通过MMap的技术映射到内存中，从而提供更快的查找。 </p><p><img src="2020-12-19-深入理解什么是LSM-Tree/02.jpeg" alt=""></p><p>在LSM-Tree里，SSTable有一份在内存里面，其他的多级在磁盘上，如下图是一份完整的LSM-Tree图示：</p><p><img src="2020-12-19-深入理解什么是LSM-Tree/03.jpeg" alt=""></p><p>我们总结下在在LSM-Tree里面如何写数据的？</p><p>1，当收到一个写请求时，会先把该条数据记录在WAL Log里面，用作故障恢复。</p><p>2，当写完WAL Log后，会把该条数据写入内存的SSTable里面（删除是墓碑标记，更新是新记录一条的数据），也称Memtable。注意为了维持有序性在内存里面可以采用红黑树或者跳跃表相关的数据结构。</p><p>3，当Memtable超过一定的大小后，会在内存里面冻结，变成不可变的Memtable，同时为了不阻塞写操作需要新生成一个Memtable继续提供服务。</p><p>4，把内存里面不可变的Memtable给dump到到硬盘上的SSTable层中，此步骤也称为Minor Compaction，这里需要注意在L0层的SSTable是没有进行合并的，所以这里的key range在多个SSTable中可能会出现重叠，在层数大于0层之后的SSTable，不存在重叠key。</p><p>5，当每层的磁盘上的SSTable的体积超过一定的大小或者个数，也会周期的进行合并。此步骤也称为Major Compaction，这个阶段会真正 的清除掉被标记删除掉的数据以及多版本数据的合并，避免浪费空间，注意由于SSTable都是有序的，我们可以直接采用merge sort进行高效合并。</p><p>接着我们总结下在LSM-Tree里面如何读数据的？</p><p>1，当收到一个读请求的时候，会直接先在内存里面查询，如果查询到就返回。</p><p>2，如果没有查询到就会依次下沉，知道把所有的Level层查询一遍得到最终结果。</p><p>思考查询步骤，我们会发现如果SSTable的分层越多，那么最坏的情况下要把所有的分层扫描一遍，对于这种情况肯定是需要优化的，如何优化？在 Bigtable 论文中提出了几种方式：</p><p>1，压缩</p><p>SSTable 是可以启用压缩功能的，并且这种压缩不是将整个 SSTable 一起压缩，而是根据 locality 将数据分组，每个组分别压缩，这样的好处当读取数据的时候，我们不需要解压缩整个文件而是解压缩部分 Group 就可以读取。</p><p>2，缓存</p><p>因为SSTable在写入磁盘后，除了Compaction之外，是不会变化的，所以我可以将Scan的Block进行缓存，从而提高检索的效率</p><p>3，索引，Bloom filters</p><p>正常情况下，一个读操作是需要读取所有的 SSTable 将结果合并后返回的，但是对于某些 key 而言，有些 SSTable 是根本不包含对应数据的，因此，我们可以对每一个 SSTable 添加 Bloom Filter，因为布隆过滤器在判断一个SSTable不存在某个key的时候，那么就一定不会存在，利用这个特性可以减少不必要的磁盘扫描。</p><p>4，合并</p><p>这个在前面的写入流程中已经介绍过，通过定期合并瘦身， 可以有效的清除无效数据，缩短读取路径，提高磁盘利用空间。但Compaction操作是非常消耗CPU和磁盘IO的，尤其是在业务高峰期，如果发生了Major Compaction，则会降低整个系统的吞吐量，这也是一些NoSQL数据库，比如Hbase里面常常会禁用Major Compaction，并在凌晨业务低峰期进行合并的原因。</p><p>最后有的同学可能会问道，为什么LSM不直接顺序写入磁盘，而是需要在内存中缓冲一下？ 这个问题其实很容易解答，单条写的性能肯定没有批量写来的块，这个原理其实在Kafka里面也是一样的，虽然kafka给我们的感觉是写入后就落地，但其实并不是，本身是 可以根据条数或者时间比如200ms刷入磁盘一次，这样能大大提升写入效率。此外在LSM中，在磁盘缓冲的另一个好处是，针对新增的数据，可以直接查询返回，能够避免一定的IO操作。</p><h3 id="B-Tree-VS-LSM-Tree"><a href="#B-Tree-VS-LSM-Tree" class="headerlink" title="B+Tree VS LSM-Tree"></a>B+Tree VS LSM-Tree</h3><p>传统关系型数据采用的底层数据结构是B+树，那么同样是面向磁盘存储的数据结构LSM-Tree相比B+树有什么异同之处呢？</p><p>LSM-Tree的设计思路是，将数据拆分为几百M大小的Segments，并是顺序写入。</p><p>B+Tree则是将数据拆分为固定大小的Block或Page, 一般是4KB大小，和磁盘一个扇区的大小对应，Page是读写的最小单位。</p><p>在数据的更新和删除方面，B+Tree可以做到原地更新和删除，这种方式对数据库事务支持更加友好，因为一个key只会出现一个Page页里面，但由于LSM-Tree只能追加写，并且在L0层key的rang会重叠，所以对事务支持较弱，只能在Segment Compaction的时候进行真正地更新和删除。</p><p>因此LSM-Tree的优点是支持高吞吐的写（可认为是O（1）），这个特点在分布式系统上更为看重，当然针对读取普通的LSM-Tree结构，读取是O（N）的复杂度，在使用索引或者缓存优化后的也可以达到O（logN）的复杂度。</p><p>而B+tree的优点是支持高效的读（稳定的OlogN），但是在大规模的写请求下（复杂度O(LogN)），效率会变得比较低，因为随着insert的操作，为了维护B+树结构，节点会不断的分裂和合并。操作磁盘的随机读写概率会变大，故导致性能降低。</p><p>还有一点需要提到的是基于LSM-Tree分层存储能够做到写的高吞吐，带来的副作用是整个系统必须频繁的进行compaction，写入量越大，Compaction的过程越频繁。而compaction是一个compare &amp; merge的过程，非常消耗CPU和存储IO，在高吞吐的写入情形下，大量的compaction操作占用大量系统资源，必然带来整个系统性能断崖式下跌，对应用系统产生巨大影响，当然我们可以禁用自动Major Compaction，在每天系统低峰期定期触发合并，来避免这个问题。</p><p>阿里为了优化这个问题，在X-DB引入了异构硬件设备FPGA来代替CPU完成compaction操作，使系统整体性能维持在高水位并避免抖动，是存储引擎得以服务业务苛刻要求的关键。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>本文主要介绍了LSM-Tree的相关内容，简单的说，其牺牲了部分读取的性能，通过批量顺序写来换取了高吞吐的写性能，这种特性在大数据领域得到充分了体现，最直接的例子就各种NoSQL在大数据领域的应用，学习和了解LSM-Tree的结构将有助于我们更加深入的去理解相关NoSQL数据库的实现原理，掌握隐藏在这些框架下面的核心知识。</p><blockquote class="note info"><p>本文分享自微信公众号 - 我是攻城师（woshigcs），作者：攻城师在路上<br>原始发表时间：2019-05-21 </p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;近期在学习TiDB，而TiDB中基于 RocksDB 的 TiKV ，使用 LSM-tree，因此再次学习相关知识。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; ti
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>陆金所去Oracle转MySQL全过程</title>
    <link href="http://www.toberoot.com/news/2020/11/16/%E9%99%86%E9%87%91%E6%89%80%E5%8E%BBOracle%E8%BD%ACMySQL%E5%85%A8%E8%BF%87%E7%A8%8B/"/>
    <id>http://www.toberoot.com/news/2020/11/16/%E9%99%86%E9%87%91%E6%89%80%E5%8E%BBOracle%E8%BD%ACMySQL%E5%85%A8%E8%BF%87%E7%A8%8B/</id>
    <published>2020-11-16T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.572Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://v.zmengzhu.com/play/10164598?i=9042907">deeplus直播</a></p></blockquote><p>很多企业都会依赖于云厂商或者其它已经去 Oracle 成功企业的帮助，真正凭借自己力量去 Oracle 的企业并不多，而陆金所恰恰就是凭借自己力量去 Oracle 的一家企业。</p><p>陆金所去 Oracle 实践历时 18 个月，将全站 90% 的数据库、数千张表从 Oracle 无缝切换至 MySQL，并且将在 6 月底前下线最后一台 Oracle。InfoQ 记者为此独家采访陆金所去 Oracle 实践的负责人王英杰，试图还原全过程。</p><h1 id="陆金所的业务场景与去-Oracle-节奏"><a href="#陆金所的业务场景与去-Oracle-节奏" class="headerlink" title="陆金所的业务场景与去 Oracle 节奏"></a>陆金所的业务场景与去 Oracle 节奏</h1><p>陆金所的去 Oracle 从 2018 年年中开始启动，涉及大几百个子系统，总数据量超过 PB 级。据王英杰介绍，“陆金所全部的研发和技术运营部门都参与了全站去 Oracle，至少有 500 人以上的开发、测试和运维工程师参与其中。”</p><p>如果从整个实践过程来看，陆金所去 Oracle 实践有三个比较关键的阶段：</p><ul><li><p>一是通过边缘系统进行方案验证阶段；</p></li><li><p>二是去“O”自动化工具平台构建和优化阶段；</p></li><li><p>三是全自动化标准化去“O”落地阶段。</p></li></ul><h1 id="去-Oracle-方案的选择"><a href="#去-Oracle-方案的选择" class="headerlink" title="去 Oracle 方案的选择"></a>去 Oracle 方案的选择</h1><p>与大多数企业去 Oracle 的原因相同，陆金所选择去 Oracle 也是因为原有的 Oracle 数据库架构扩展性很差，并且 Oracle 软件授权费用太高，无法支撑陆金所从 2013 年到现在交易量井喷式暴增下的业务需求。</p><p>替代方案选定了 MySQL，同时因为 MySQL 无法支撑 Oracle 的所有场景，还引入了 Elasticsearch、Redis、TiDB、HBase 等多种存储引擎。陆金所现在的数据库架构图如下：</p><p><img src="https://static001.geekbang.org/resource/image/13/f3/137a9182592f1c4247ee4054118057f3.jpg" alt="img"></p><p>陆金所对于去 Oracle 的核心诉求是在外部用户不感知的情况下，更换掉核心数据库。因此，陆金所研发了一套数据同步工具，以表为粒度，把 MySQL 作为 Oracle 的备库，实时同步 Oracle 的 DDL 和 DML 变更。同时在应用层实现 Oracle 和 MySQL 两套访问数据库的 DAO 层，以及开关模式的动态数据源，便于流量在 Oracle 和 MySQL 之间快速切换，在确保流量切换到 MySQL 之后，数据还能够反向向 Oracle 同步，保证数据一致性。</p><h1 id="去-Oracle-的准备工作：按域拆分"><a href="#去-Oracle-的准备工作：按域拆分" class="headerlink" title="去 Oracle 的准备工作：按域拆分"></a>去 Oracle 的准备工作：按域拆分</h1><p>为了顺利完成去 Oracle 工作，陆金所在 2016 年到 2018 年期间进行了数据库的按域拆分。其主要目的有三个，分别是：</p><p>细粒度拆分数据库、分片化，实现数据库容量的水平扩展；</p><p>应用解耦、服务化，让应用访问数据库的调用更加清晰和规范；</p><p>严禁应用跨域访问数据库，严禁数据库之间产生数据交互，从业务角度呈现出一个更加完善的数据库架构。</p><p><img src="https://static001.geekbang.org/resource/image/b1/aa/b123183d18d913eea03ec337700834aa.jpg" alt="img"></p><p>整个按域拆分过程中比较大的难点是大事务拆分和多表关联复杂查询。王英杰表示：“单库上原有的大事务拆分后是通过应用层的分布式事务机制在多库上实现，而单库上原有的多表关联复杂查询在拆分之后，是在应用层实现或在特殊场景中通过分布式存储引擎来支持。”</p><p>据了解，陆金所的数据库按域拆分主要有四个关键阶段：</p><p>第一阶段，应用改造实现逻辑拆分。按表为粒度对大库的数据库对象进行梳理，把每张表归属于不同的应用域。在应用层根据梳理的结果对操作表的代码进行改造，包括：拆分复杂的大查询、拆分庞大的事务以及将操作表的代码全部封装在属主应用的代码中，非属主应用无法直接操作表，通过调用服务接口的方式实现非常规范的应用访问数据库的调用链。</p><p>第二阶段，逻辑拆分完成后，以数据库的角度对应用改造的结果进行验证。在同一个物理库，使用逻辑 schema 的方式对数据库对象的授权进行调整，验证应用改造符合预期。</p><p>第三阶段是数据库迁移和实时同步。逻辑层拆分验证完成后，通过实时同步把待拆分的数据库对象实时同步到另外一个物理库。上述所有改造步骤对应用层无感知。</p><p>第四阶段是物理拆分和切换流量。源端和目标端保持实时同步后，在某个时间点推送配置并切换流量。整个过程最好有一套完善的自动化运维确保各个细节工作的无缝落地。流量切换操作，必须确保可以随时前滚和回滚。</p><p>以上就是陆金所去 Oracle 实践过程中的方案选择与准备工作。</p><h1 id="去-Oracle-的准备工作：优化逻辑"><a href="#去-Oracle-的准备工作：优化逻辑" class="headerlink" title="去 Oracle 的准备工作：优化逻辑"></a>去 Oracle 的准备工作：优化逻辑</h1><p>在去 Oracle 之前，陆金所全站的金融 OLTP 业务场景都是由 Oracle 支撑的，而完成之后，全部的金融场景是由 MySQL 支撑，部分 Oracle 上的大事务也被优化成为了 MySQL 上的小事务。</p><p>值得注意的是，去 Oracle 完成之后，陆金所中 85% 的数据库查询请求都是简单的单表查询，15% 的关联查询都是比较简单的关联查询，而原先 Oracle 数据库中包含的复杂业务逻辑的多表关联也做了以下的优化：</p><ul><li><p>被拆解成简单查询，在代码层实现部分复杂的关联逻辑；</p></li><li><p>通过陆金所的数据总线平台，把数据实时同步到 Elasticsearch 里，再实现复杂且高效的关联搜索；</p></li><li><p>部分在 Oracle 读库上支撑的复杂业务逻辑查询，通过数据总线平台同步到 TiDB ，在 TiDB 里实现复杂的关联查询。</p></li></ul><h1 id="去-Oracle-的落地工作：实时同步"><a href="#去-Oracle-的落地工作：实时同步" class="headerlink" title="去 Oracle 的落地工作：实时同步"></a>去 Oracle 的落地工作：实时同步</h1><p>在真正去 Oracle 之前，陆金所先把 MySQL 作为对外提供服务的 Oracle 备库挂在了 Oracle 后面。从 Oracle 到 MySQL 的异构数据库备库，不需要实例级的数据同步，可以按表为粒度进行数据的实时同步。</p><p>陆金所整个去 Oracle 实践主要是依赖于其内部的去 Oracle 平台来落地的，在去 Oracle 平台上勾选需要同步的 Oracle 表，数据迁移工作就会自动完成。据介绍，陆金所智能化去 O 平台横跨代码改造到上线切换以及后期运维的全流程自动化保障和落地，其中主要包含的工具有：</p><ul><li><p>Oracle SQL 代码自动转 MySQL SQL 代码工具</p></li><li><p>O to M 数据字典转化和管理工具</p></li><li><p>O to M 数据自动迁移和双写工具</p></li><li><p>去 O 流量一键切换</p></li><li><p>跨机房一键切换去 O 自愈工具</p></li></ul><p>据王英杰介绍，在陆金所去 Oracle 平台中完成数据迁移的主要过程如下：</p><ul><li><p>首先去 Oracle 平台会解析 Oracle 表结构，并转化成 MySQL 表结构部署到 MySQL 上。之后，Oracle 有任何数据字典变更，去 Oracle 平台都会对 MySQL 进行同步；</p></li><li><p>将 Oracle 的数据全量同步至 MySQL，因为 Oracle 库还在对外提供服务，所以会记录同步开始时间点，发生过变更的 Oracle 数据；</p></li><li><p>在全量同步完成后，解析 Oracle 的 redo log，把同步期间发生过变更的数据进行增量追平；</p></li><li><p>增量追平后，比对 Oracle 和 MySQL 每一笔记录和每一个字段的数据一致性，因为 Oracle 还处在不断更新中，去 Oracle 平台会使用增量补偿重试的方式不断对记录进行一致性校验；</p></li><li><p>数据完全追平且校验一致后，去 Oracle 平台会开始尝试解析 MySQL binlog，建立从 MySQL 到 Oracle 的数据同步通道；</p></li><li><p>因为 Oracle to MySQL 和 MySQL to Oracle 的双向数据同步链路都会被自动建立起来，为了防止数据回流，必须区分好是应用层写入的数据还是同步框架写入的数据，确保一份数据无论在 Oracle 还是 MySQL 提交，都会同步到对端，且仅写入一次。</p></li></ul><p>据悉，陆金所核心业务去 Oracle 的时间大约是 6 个月，期间会出现应用中部分表读写流量在 Oracle、部分表读写在 MySQL 的中间状态，而这时陆金所的业务系统还会有大量的功能版本不断上线，如何平衡业务系统的版本上线和去 Oracle 的数据迁移呢？</p><p>王英杰表示：“为了降低业务功能改造和去 Oracle 架构改造之间高频交叉上线的风险，陆金所自研的 Bettle 系统实现了业务版本和去 Oracle 版本并行推进，且互相透明的重要功能。”</p><p><img src="https://static001.geekbang.org/resource/image/46/54/465612f5f2f1ffda150a02258c313c54.jpg" alt="img"></p><p>迁移完成之后，陆金所每 3 个月会通过数据库一键切换平台把全站数据库写库更换一次，一键切换平台在 180 秒完成全站数百套数据库的跨机房切换后，数千张表的 O 和 M 双写同步会自动重建，并确保数据一致性和完整性。</p><p><img src="https://static001.geekbang.org/resource/image/fa/94/faecc62862c37946b521badc67dde394.jpg" alt="img"></p><p>作为去 Oracle 的实践者，王英杰也分享了他在整个实践过程中获得的感悟和经验，希望能对之后想要去 Oracle 的企业有所帮助。</p><p>对于严苛的金融系统来说，去 Oracle 是个非常复杂的系统工程，涉及到开发、测试、架构和 DBA 等几乎全部技术部门的通力合作；</p><p>整个去 Oracle 改造过程需要在各个阶段都总结出一套完善的方法论，确保各个细节改造工作能稳妥落地；</p><p>需要有一套完善的去 Oracle 工具平台来落地整套方法论，让开发、测试和 DBA 在上面开展去 Oracle 工作，通过工具无缝衔接好这些团队在去 Oracle 改造中的协同工作，通过工具确保从代码改造、压测到数据迁移、流量切换等横跨多个团队、长周期的工作风险可控，效果如期。</p><p>以上就是今天的内容，希望对你有所帮助。</p><h1 id="我的笔记"><a href="#我的笔记" class="headerlink" title="我的笔记"></a>我的笔记</h1><h2 id="SQL装换工具测试"><a href="#SQL装换工具测试" class="headerlink" title="SQL装换工具测试"></a>SQL装换工具测试</h2><blockquote><p><a href="https://www.lufaxholding.com/zh-cn/solution/detail/solution/luDBGate/sqlmapo2m/index.html">SQL转换工具</a> ：SQL转换是陆金所去商业数据库的过程中，用于应用开发的异构数据库间的SQL转换的工具。</p></blockquote><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>在官网下载后，打开《O2M SQL智能转化工具插件使用说明_v1.3.pdf》帮助文档，根据帮助进行安装。</p><p>Mac 下插件安装</p><ol><li>打开 IDEA，选择 perferences – Plugins - Install Plugin from Disk</li><li>选择下载的文件 sqlreview.zip</li><li>安装完成后，重启 IDEA 即可</li><li>复制配置文件到项目更目录下</li></ol><p><img src="2020-11-16-陆金所去Oracle转MySQL全过程/01.png" alt=""></p><p><img src="2020-11-16-陆金所去Oracle转MySQL全过程/02.png" alt=""></p><p><img src="2020-11-16-陆金所去Oracle转MySQL全过程/03.png" alt=""></p><h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><ol><li>打开 IDEA，选择并打开具体某个 Mybatis 的 SQL Mapper 的配置文件 XML</li><li>在打开的 XML 内，点击右键，选择“OracleSqlMap to MysqlSqlMap”</li><li>等待数秒后，会获得转换后的 SQL Mapper 的 XML 文件</li></ol><h3 id="什么是-MyBatis？"><a href="#什么是-MyBatis？" class="headerlink" title="什么是 MyBatis？"></a>什么是 <a href="https://mybatis.org/mybatis-3/zh/index.html">MyBatis</a>？</h3><p>MyBatis 是一款优秀的持久层框架，它支持自定义 SQL、存储过程以及高级映射。MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://v.zmengzhu.com/play/10164598?i=9042907&quot;&gt;deeplus直播&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;很多企业都会依赖于云厂商或者其它已经去 Oracle 成功企业的
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>DAMS 中国数据智能管理峰会 2020 上海</title>
    <link href="http://www.toberoot.com/news/2020/10/30/dams/"/>
    <id>http://www.toberoot.com/news/2020/10/30/dams/</id>
    <published>2020-10-30T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.522Z</updated>
    
    <content type="html"><![CDATA[<p><img src="2020-10-30-dams/01.jpeg" alt=""></p><p><img src="2020-10-30-dams/02.jpeg" alt=""></p><h1 id="开源数据库-MySQL-在民生银行的应用实践"><a href="#开源数据库-MySQL-在民生银行的应用实践" class="headerlink" title="开源数据库 MySQL 在民生银行的应用实践"></a>开源数据库 MySQL 在民生银行的应用实践</h1><blockquote><p>明生银行 项目经理 徐春阳</p></blockquote><ol><li>为什么要用? 国家安全要求</li><li>怎么用？ 自主</li><li>经历总结 “平头哥”的精神、用于尝试、乐观时谨慎、”谨慎”时乐观、持续学习与研究</li><li>开源收获： 资源、自主、效率、经验、能力、也收获了沉甸甸的责任</li><li><p>使用与运维MySQL的模式</p><ul><li>利用及其有限的资源维护总行MySQL数据库系统；</li><li>抓大放小，抓主要重要放次要，协同管理</li><li>建设必要的运维工具/系统辅助运维</li><li>制定使用规范、指导手册、知识库</li></ul></li><li><p>“人工”智能</p><ul><li>标准监控频率漏掉间歇性/抖动性的现象</li><li>再智能的监控难以分辨。。</li><li>提高”人工”智能的方法就是持续学习与研究，透析数据库内部机制</li></ul></li></ol><h1 id="如何构建数据库容器化PaaS"><a href="#如何构建数据库容器化PaaS" class="headerlink" title="如何构建数据库容器化PaaS"></a>如何构建数据库容器化PaaS</h1><blockquote><p>爱可生 资深架构师 徐阳</p></blockquote><p>思考： 为何现在还有企业一点云数据库都不碰，选择使用这样PaaS平台去实现使用数据库的需求呢？</p><h1 id="腾讯游戏大数据资产管理实践"><a href="#腾讯游戏大数据资产管理实践" class="headerlink" title="腾讯游戏大数据资产管理实践"></a>腾讯游戏大数据资产管理实践</h1><blockquote><p>腾讯游戏 大数据管理负责人 陈林荣</p></blockquote><p>《数据资产管理实践白皮书4.0》</p><ul><li>数据资产管理 DAM，Data Asset Management</li><li>元数据管理成熟度（IBM）</li></ul><blockquote><p>目前接触到的项目中，深切体会到”治理”的难度和重要性。</p></blockquote><h1 id="一个万亿规模数据库核心存储引擎的实现与应用"><a href="#一个万亿规模数据库核心存储引擎的实现与应用" class="headerlink" title="一个万亿规模数据库核心存储引擎的实现与应用"></a>一个万亿规模数据库核心存储引擎的实现与应用</h1><blockquote><p>南京录信软件 CTO 母延年</p></blockquote><h1 id="从自研演进看分布式数据库"><a href="#从自研演进看分布式数据库" class="headerlink" title="从自研演进看分布式数据库"></a>从自研演进看分布式数据库</h1><blockquote><p>中国银联云计算中心 云组件总监 周家晶</p></blockquote><h1 id="字节跳动数据治理实践"><a href="#字节跳动数据治理实践" class="headerlink" title="字节跳动数据治理实践"></a>字节跳动数据治理实践</h1><blockquote><p>今日头条 数据BP/数据治理负责人 任长延</p></blockquote><p>给我比较大的触动是，字节跳动没有成立自己的大数据团队，而是将组件了一个虚拟的数据治理委员会，这种方式非常好。</p><p>之前参与到大数据团队的项目，更多的是做SQL工程师，如果完全去做其实就丢下自己原先的数据库管理技术了。他们的这种方式我喜欢，而且他们很高效率。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;2020-10-30-dams/01.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;2020-10-30-dams/02.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;开源数据库-MySQL-在民生银行的应用实践&quot;&gt;&lt;a href=
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>思考：聊一聊治病救人与系统运维</title>
    <link href="http://www.toberoot.com/news/2020/10/14/devops-thinking/"/>
    <id>http://www.toberoot.com/news/2020/10/14/devops-thinking/</id>
    <published>2020-10-14T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.521Z</updated>
    
    <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>治病救人，诊治对象：人类；价值：”生命“ 无价；诊治方法：医生和医疗设备<br>系统运维，诊治对象：系统；价值：”生命“ 无价；诊治方法：运维人员和运维系统</p><p>我将从 为什么要诊治？诊治的是谁？ 如何诊治？三个方面来对比思考。</p><h1 id="诊治的价值"><a href="#诊治的价值" class="headerlink" title="诊治的价值"></a>诊治的价值</h1><ul><li><p>人类是基因的科技产物</p></li><li><p>系统是人类的科技产物</p></li></ul><blockquote><p> 理解了生物体和基因的关系，我们会更好地理解科技和人的关系。推荐《自私的基因》，可以帮我们更深刻地理解生命的定义。生命的内核是基因，一组信息编码。基因自有其意志，生物的很多行为对其自身是痛苦的，但对基因有利，比如螳螂的自我牺牲，再比如节育措施发明前，多少穷人养不起孩子，根本不想生那么多孩子，却不断生出孩子。</p></blockquote><p>换个视角，生物体用紫色素获得视觉、用牙齿获得嚼碎食物功能，何尝不是科技？只不过，这种科技不是用书本记录，而是用基因记录。不是靠学术论文升级，而是靠物种竞争升级。科技，这样看，甚至并非源于人类，它和基因像是两种更古老和恒久的生命。</p><p>基因认为人类活着最重要，人类认为系统服务高可用和数据高可靠性最重要。</p><h1 id="诊治的对象"><a href="#诊治的对象" class="headerlink" title="诊治的对象"></a>诊治的对象</h1><blockquote><p>人若作为社会工具来看，工作种类的不同，社会地位也不同，产生的社会价值各不相同，比较价值没有意义；</p><p>系统同样也是一种工具，可能是服务于公益的，可能是服务于某个公司赚钱的，这个价值也是不能比较的。</p></blockquote><p>有人会说，我维护的是银行系统全世界的人都会用到，你维护的是个办公OA系统，银行系统的价值比OA系统的价值好多了。从服务的高可用和数据的高可靠性上去比较一下。银行系统中断1分钟将会带来很大的损失，而OA系统断个一天也没事。银行数据丢失和OA的数据丢失带来的影响也是不一样的。</p><p>系统和人从某种意义上来看都是工具。对于社会的价值也由各自的工具属性决定了价值的不同，注意是不同， 不是价值高低。</p><p>上面的小故事中，A都用现金银行系统挂了和他一点关系都没有，但是OA系统中有他刚刚申请的合同流程，等着审批，那你说这两个系统哪个价值对A来说更高。</p><p><strong>价值，是客体的对主体而言的价值。</strong></p><h1 id="诊治方法"><a href="#诊治方法" class="headerlink" title="诊治方法"></a>诊治方法</h1><blockquote><p> 治病救人的发展历史要比系统运维的历史长得多，我们一起看看是否有可借鉴的地方。</p></blockquote><h2 id="概念参考"><a href="#概念参考" class="headerlink" title="概念参考"></a>概念参考</h2><p><strong>医学</strong>是通过科学或技术的手段处理人体的各种疾病或病变的学科。它是生物学的应用学科，分基础医学、临床医学。从解剖层面和分子遗传层面来处理人体疾病的高级科学。它是一个从预防到治疗疾病的系统学科，研究领域大方向包括基础医学、临床医学、法医学、检验医学、预防医学、保健医学、康复医学等。</p><p>以下仅为个人参考医学思考而得的“运维学”概念。😄</p><p><strong>“运维学”</strong>是通过科学或技术的手段处理系统的各种故障或瓶颈的学科。它是计算机的应用学科，分基础计算机科学、生产运维学、架构优化学、自动化运维学、预防运维学、保健运维学、康复运维学。一个从预防到治疗的系统学科。</p><h2 id="学习渠道"><a href="#学习渠道" class="headerlink" title="学习渠道"></a>学习渠道</h2><p>运维，目前还没有能够发展到一个学科的地步，至少大学中还没有像医学那样有专业的运维院校，运维专业。目前大学中还是计算机基础学科和计算机软件占主流。感觉就像是大家只学习人体组成，造人技术，和让人做工的学问，却不研究人生病和成长的问题。<br>相信将来一定会有的！<br>目前学习运维主要是社会培训机构和公司实际生产积累。</p><h2 id="人与系统"><a href="#人与系统" class="headerlink" title="人与系统"></a>人与系统</h2><p>我尝试从<strong>医生</strong>与<strong>医疗设备</strong>来看<strong>运维人员</strong>与<strong>运维系统</strong>的关系。</p><blockquote><p>医生与现代医疗器械哪个方面更重要？<br>运维人员与运维系统哪个更重要？</p></blockquote><p>在目前的科技和人文条件下，短时间内二者无法相互取代。</p><p>医生和医疗设备的关系：医生负责通过自己的知识和经验来决定患者应该进行哪些仪器的检查，先进的医疗器械负责将传统查体发现不了的和无法准确进行性质区分的病变清晰的、准确的显示出来，再由医生对机器给出的结果进行判读和分析。<br>在目前的科技和人文条件下，短时间内二者无法相互取代。</p><p>我们再看看运维人员和运维系统</p><ol><li>运维人员负责通过自己的知识和经验来决定患者应该进行哪些系统的检查。由于软件系统的复杂度目前还没有能够像人类生命系统那么复杂，因此作出一个全面检查的系统还是可行的，将来这部分的工作交给系统去完成即可。</li><li>先进的运维系统负责将传统查体发现不了的和无法准确进行性质区分的病变清晰的、准确的显示出来，再由运维人员对机器给出的结果进行判读和分析。</li></ol><p>以上两个步骤我们简单划分为 诊断 和 治疗。</p><p>诊断是治疗的前提，但是单诊断出问题却无法治疗也是徒劳。所以二者相辅相成，没有价值的高低之分。</p><p>个人而言，我乐意提高运维工具的能力将诊断的事情交给效率更高的工具来做，且花更多的时间去钻研“治疗”提高解决疑难杂症的能力以及业务系统优化能力。</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>产品能拿下融资，是因为对于投资人来说他们认为运维系统对他们有价值。</p><p>但不能代表运维人员对于其他人都是没有价值的。人的价值观不同而已。运维人员与运维系统相辅相成。</p><h2 id="关于自己"><a href="#关于自己" class="headerlink" title="关于自己"></a>关于自己</h2><ol><li>大量工作放在如何自动化，如何自治系统这边，参与编码或设计并优化各个系统。</li><li>拥抱开源形成自身技术栈，标准化一些技术去解决问题。</li><li>将国外的SRE思想和国内的实际相结合，时刻保持学习和总结的心态，做好自己的定位。</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h1&gt;&lt;p&gt;治病救人，诊治对象：人类；价值：”生命“ 无价；诊治方法：医生和医疗设备&lt;br&gt;系统运维，诊治对象：系统；价值：”生命“ 无价；诊治方法：运
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>Percona Toolkit工具明细说明</title>
    <link href="http://www.toberoot.com/news/2020/09/26/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/09/26/tec-mysql/</id>
    <published>2020-09-26T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.521Z</updated>
    
    <content type="html"><![CDATA[<h1 id="数据库版本和工具版本要求"><a href="#数据库版本和工具版本要求" class="headerlink" title="数据库版本和工具版本要求"></a>数据库版本和工具版本要求</h1><div class="table-container"><table><thead><tr><th>数据库</th><th>版本</th><th><em>Percona Toolkit 版本（采用最新小版本）</em></th><th><em>Percona Toolkit 小版本</em>要求</th></tr></thead><tbody><tr><td>MySQL</td><td>5.5</td><td><em>Percona Toolkit 2.2</em></td><td><em>Percona Toolkit 2.2.1以上版本</em></td></tr><tr><td>MySQL</td><td>5.6</td><td><em>Percona Toolkit 2.2</em></td><td><em>Percona Toolkit 2.2.1以上版本</em></td></tr><tr><td>MySQL</td><td>5.7</td><td><em>Percona Toolkit 2.2</em></td><td><em>Percona Toolkit 2.2.17以上版本</em></td></tr><tr><td>MySQL</td><td>8.0</td><td><em>Percona Toolkit 3.0</em></td><td><em>Percona Toolkit 3.0.1</em></td></tr><tr><td>MariaDB</td><td>MariaDB 10.4</td><td><em>Percona Toolkit 3.0</em></td><td><em>Percona Toolkit 3.2.0</em></td></tr></tbody></table></div><ul><li><a href="https://www.percona.com/doc/percona-toolkit/LATEST/release_notes.html#v0-9-5-released-2011-08-04">Percona Toolkit迭代日志</a></li><li><a href="https://www.percona.com/services/policies/percona-software-platform-lifecycle">Percona Toolkit支持的平台和版本</a></li></ul><h1 id="Percona-Toolkit工具细节说明"><a href="#Percona-Toolkit工具细节说明" class="headerlink" title="Percona Toolkit工具细节说明"></a>Percona Toolkit工具细节说明</h1><p>Percona Toolkit 工具执行需要两个用户：</p><ol><li><p>数据库用户：授权如下</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;solardb&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;SolarDB@123&#x27;</span>;</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;solardb&#x27;</span>@<span class="string">&#x27;%&#x27;</span> <span class="keyword">with</span> <span class="keyword">grant</span> options;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></li><li><p>工具概览</p></li></ol><p><a href="https://www.percona.com/doc/percona-toolkit/LATEST/pt-online-schema-change.html">https://www.percona.com/doc/percona-toolkit/LATEST/pt-online-schema-change.html</a></p><div class="table-container"><table><thead><tr><th>工具命令</th><th>工具作用</th><th>备注</th></tr></thead><tbody><tr><td>开发类</td><td>pt-duplicate-key-checker</td><td>列出并删除重复的索引和外键</td></tr><tr><td></td><td>pt-online-schema-change</td><td>在线修改表结构</td></tr><tr><td></td><td>pt-query-advisor</td><td>分析查询语句，并给出建议，有bug 已废弃</td></tr><tr><td></td><td>pt-show-grants</td><td>规范化和打印权限</td></tr><tr><td></td><td>pt-upgrade</td><td>在多个服务器上执行查询，并比较不同</td></tr><tr><td>性能类</td><td>pt-index-usage</td><td>分析日志中索引使用情况，并出报告</td></tr><tr><td></td><td>pt-pmp</td><td>为查询结果跟踪，并汇总跟踪结果</td></tr><tr><td></td><td>pt-visual-explain</td><td>格式化执行计划</td></tr><tr><td></td><td>pt-table-usage</td><td>分析日志中查询并分析表使用情况 pt 2.2新增命令</td></tr><tr><td>配置类</td><td>pt-config-diff</td><td>比较配置文件和参数</td></tr><tr><td></td><td>pt-mysql-summary</td><td>对mysql配置和status进行汇总</td></tr><tr><td></td><td>pt-variable-advisor</td><td>分析参数，并提出建议</td></tr><tr><td>监控类</td><td>pt-deadlock-logger</td><td>提取和记录mysql死锁信息</td></tr><tr><td></td><td>pt-fk-error-logger</td><td>提取和记录外键信息</td></tr><tr><td></td><td>pt-mext</td><td>并行查看status样本信息</td></tr><tr><td></td><td>pt-query-digest</td><td>分析查询日志，并产生报告 常用命令</td></tr><tr><td></td><td>pt-trend</td><td>按照时间段读取slow日志信息 已废弃</td></tr><tr><td>复制类</td><td>pt-heartbeat</td><td>监控mysql复制延迟</td></tr><tr><td></td><td>pt-slave-delay</td><td>设定从落后主的时间</td></tr><tr><td></td><td>pt-slave-find</td><td>查找和打印所有mysql复制层级关系</td></tr><tr><td></td><td>pt-slave-restart</td><td>监控salve错误，并尝试重启salve</td></tr><tr><td></td><td>pt-table-checksum</td><td>校验主从复制一致性</td></tr><tr><td></td><td>pt-table-sync</td><td>高效同步表数据</td></tr><tr><td>系统类</td><td>pt-diskstats</td><td>查看系统磁盘状态</td></tr><tr><td></td><td>pt-fifo-split</td><td>拟切割文件并输出</td></tr><tr><td></td><td>pt-summary</td><td>收集和显示系统概况</td></tr><tr><td></td><td>pt-stalk</td><td>出现问题时，收集诊断数据</td></tr><tr><td></td><td>pt-sift</td><td>浏览由pt-stalk创建的文件 pt 2.2新增命令</td></tr><tr><td></td><td>pt-ioprofile</td><td>查询进程IO并打印一个IO活动表 pt 2.2新增命令</td></tr><tr><td>实用类</td><td>pt-archiver</td><td>将表数据归档到另一个表或文件中</td></tr><tr><td></td><td>pt-find</td><td>查找表并执行命令</td></tr><tr><td></td><td>pt-kill</td><td>Kill掉符合条件的sql 常用命令</td></tr><tr><td></td><td>pt-align</td><td>对齐其他工具的输出 pt 2.2新增命令</td></tr><tr><td></td><td>pt-fingerprint</td><td>将查询转成密文 pt 2.2新增命令</td></tr></tbody></table></div><h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><h2 id="在线DDL"><a href="#在线DDL" class="headerlink" title="在线DDL"></a>在线DDL</h2><p>注意:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1. &#123;&#123; &#125;&#125; 或者 xx代表要修改的位置</span><br><span class="line">2. --noversion-check 如果是非原生的MySQL，例如各大云产商的，必须要使用该参数</span><br><span class="line">3. --charset=utf8 根据数据库使用的字符集选择合适的，否则容易造成乱码</span><br><span class="line">4. --alter=<span class="string">&quot;xxx,xxx,xxx&quot;</span> 一张表多个变更使用逗号分割</span><br></pre></td></tr></table></figure><h3 id="场景一"><a href="#场景一" class="headerlink" title="场景一"></a>场景一</h3><blockquote class="note info"><p>一张表多个变更</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@build-center cloudcare_dba]<span class="comment"># cat qinxi/alter_table_hana_20191126.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">host=xx</span><br><span class="line">port=xx</span><br><span class="line">dbname=xx</span><br><span class="line">user=xx</span><br><span class="line">password=xx</span><br><span class="line">  </span><br><span class="line">table=xx</span><br><span class="line">pt-online-schema-change --user=<span class="variable">$&#123;user&#125;</span> --port=<span class="variable">$&#123;port&#125;</span> --host=<span class="variable">$&#123;host&#125;</span> --password=<span class="variable">$&#123;password&#125;</span> --alter=<span class="string">&quot;add column update_time timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,drop index IX_ST_ENTRY_DETAIL_SRCNO_DETAILID,drop index auto_shard_key_ORG_ID,drop index auto_shard_key_WAREHOUSE_ID,drop index IX_ST_ENTRY_DETAIL_ITEMCODE,drop index IX_ST_ENTRY_DETAIL_INOUT_TYPE,drop index IX_ST_ENTRY_DETAIL_TOP_ITEMTYPE_ID,drop index IX_SOURCE_RECEIPT_TYPE,drop index IX_ST_ENTRY_DETAIL_ET_OPER_TIME,drop index IX_ST_ENTRY_DETAIL_ET_CREATE_TIME,drop index IX_ST_ENTRY_DETAIL_CALCULATE_ID,add index index_item_code(ITEM_CODE),add index index_trunk_id(TRUNK_ID),add index index_receipt_id(SOURCE_RECEIPT_ID),add index index_oper_time(OPER_TIME),add index IX_st_entry_detail_et_SOURCE_RECEIPT_NO(SOURCE_RECEIPT_NO),add index IX_st_entry_detail_et_ORG_ID(ORG_ID),add index IX_st_entry_detail_et_WAREHOUSE_ID(WAREHOUSE_ID),add index index_update_time(update_time),add index IX_st_entry_detail_et_IS_BOX(IS_BOX),add index IX_st_entry_detail_et_SOURCE_RECEIPT_TYPE(SOURCE_RECEIPT_TYPE),add index IX_st_entry_detail_et_CREATE_TIME(CREATE_TIME)&quot;</span> D=<span class="variable">$&#123;dbname&#125;</span>,t=<span class="variable">$&#123;table&#125;</span> --no-version-check --execute</span><br></pre></td></tr></table></figure><h3 id="场景2"><a href="#场景2" class="headerlink" title="场景2"></a>场景2</h3><blockquote class="note info"><p>多张表变更</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment"># pt-osc scripts</span></span><br><span class="line"><span class="comment"># &#123;&#123; time_string &#125;&#125;</span></span><br><span class="line"><span class="comment"># Solar 混合云管理平台     </span></span><br><span class="line">host=&#123;&#123; host &#125;&#125;</span><br><span class="line">port=&#123;&#123; port &#125;&#125;</span><br><span class="line">dbname=&#123;&#123; dbname &#125;&#125;</span><br><span class="line">user=&#123;&#123; user &#125;&#125;</span><br><span class="line">password=&#123;&#123; password &#125;&#125;</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">table=&#123;&#123; sql.table_name1 &#125;&#125;</span><br><span class="line">pt-online-schema-change --user=<span class="variable">$&#123;user&#125;</span> --port=<span class="variable">$&#123;port&#125;</span> --host=<span class="variable">$&#123;host&#125;</span> --password=<span class="variable">$&#123;password&#125;</span> --alter=<span class="string">&quot;&#123;&#123; sql.alter_cmd &#125;&#125;&quot;</span> D=<span class="variable">$&#123;dbname&#125;</span>,t=<span class="variable">$&#123;table&#125;</span> --no-version-check --execute --charset=utf8</span><br><span class="line"></span><br><span class="line">table=&#123;&#123; sql.table_name2 &#125;&#125;</span><br><span class="line">pt-online-schema-change --user=<span class="variable">$&#123;user&#125;</span> --port=<span class="variable">$&#123;port&#125;</span> --host=<span class="variable">$&#123;host&#125;</span> --password=<span class="variable">$&#123;password&#125;</span> --alter=<span class="string">&quot;&#123;&#123; sql.alter_cmd &#125;&#125;&quot;</span> D=<span class="variable">$&#123;dbname&#125;</span>,t=<span class="variable">$&#123;table&#125;</span> --no-version-check --execute --charset=utf8</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="场景2-1"><a href="#场景2-1" class="headerlink" title="场景2"></a>场景2</h3><blockquote class="note info"><p>生产使用的自动生成PT脚本</p></blockquote><p>python自动转换脚本：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*-coding:utf8 -*-</span></span><br><span class="line"><span class="comment"># Build-in Modules</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 3rd-part Modules</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sqlparse</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SQLParseHelper</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    解析SQL</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, sql_str=<span class="literal">None</span>, split_str=<span class="string">&#x27;;&#x27;</span></span>):</span><br><span class="line">        self.sql_str = sql_str</span><br><span class="line">        self.split_str = split_str</span><br><span class="line">        self.sql_list = []</span><br><span class="line">        <span class="keyword">if</span> self.split_str == <span class="string">&#x27;;&#x27;</span>:</span><br><span class="line">            <span class="comment"># print(sqlparse.split(self.sql_str))</span></span><br><span class="line">            self.sql_list = <span class="built_in">list</span>(<span class="built_in">filter</span>(</span><br><span class="line">                <span class="keyword">lambda</span> y: y != <span class="string">&#x27;&#x27;</span>, sqlparse.split(self.sql_str)</span><br><span class="line">            ))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.sql_list = <span class="built_in">list</span>(</span><br><span class="line">                <span class="built_in">filter</span>(</span><br><span class="line">                    <span class="keyword">lambda</span> y: y != <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                    <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.strip(), self.sql_str.split(self.split_str))</span><br><span class="line">                ))</span><br><span class="line">        <span class="comment"># print(self.sql_list)</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_length</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        sql文件中的SQL数量</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.sql_list)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_format</span>(<span class="params">self, sql</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        根据选项格式化sql。</span></span><br><span class="line"><span class="string">        可用选项记录在“ SQL语句格式”中。</span></span><br><span class="line"><span class="string">        除格式化选项外，该函数还接受关键字“ encoding”，该关键字确定语句的编码。</span></span><br><span class="line"><span class="string">        返回值：    格式化的SQL语句为字符串。</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        format_sql = sqlparse.<span class="built_in">format</span>(sql, reindent=<span class="literal">True</span>, keyword_case=<span class="string">&#x27;upper&#x27;</span>, strip_comments=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># print(format_sql)</span></span><br><span class="line">        <span class="keyword">return</span> format_sql</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_init</span>(<span class="params">self, sql</span>):</span><br><span class="line">        tokens = []</span><br><span class="line">        parsed = sqlparse.parse(sql)</span><br><span class="line">        stmt = parsed[<span class="number">0</span>].tokens</span><br><span class="line">        <span class="keyword">for</span> token <span class="keyword">in</span> stmt:</span><br><span class="line">            tokens.append([token.ttype, token.value])</span><br><span class="line"> </span><br><span class="line">        sql = sqlparse.sql.Statement(stmt)</span><br><span class="line">        sql_type = sql.get_type()</span><br><span class="line">        <span class="keyword">return</span> sql_type, tokens</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_type</span>(<span class="params">self, tokens</span>):</span><br><span class="line">        <span class="comment"># print(tokens)</span></span><br><span class="line">        <span class="keyword">return</span> tokens[<span class="number">0</span>][<span class="number">0</span>][<span class="number">1</span>] <span class="keyword">if</span> <span class="built_in">len</span>(tokens[<span class="number">0</span>][<span class="number">0</span>]) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="string">&#x27;Others&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sql_statement</span>(<span class="params">self, tokens</span>):</span><br><span class="line">        <span class="keyword">return</span> tokens[<span class="number">0</span>][<span class="number">1</span>] <span class="keyword">if</span> <span class="built_in">len</span>(tokens[<span class="number">0</span>]) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="string">&#x27;Others&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_table</span>(<span class="params">self, tokens</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        如何从tokens中获取表名？</span></span><br><span class="line"><span class="string">        :param tokens:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        tables = []</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 找到 Keyword 为 TABLE的关键字的索引位 + 2</span></span><br><span class="line">            sql_words = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="number">1</span>], tokens))</span><br><span class="line">            index_num = sql_words.index(<span class="string">&#x27;TABLE&#x27;</span>)</span><br><span class="line">            table = sql_words[index_num + <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(e))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tables.append(table)</span><br><span class="line">        <span class="keyword">return</span> tables</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PTHelper</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, sql</span>):</span><br><span class="line">        self.sql = sql</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">alter_sql_parse</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        对同一张表按照原来的语句顺序用逗号连接,所有双引号替换为单引号</span></span><br><span class="line"><span class="string">        [</span></span><br><span class="line"><span class="string">                &#123;&quot;table_name&quot;: &quot;frm_user&quot;,</span></span><br><span class="line"><span class="string">                &quot;alter_cmd&quot;: &quot;DROP INDEX account_idx,ADD UNIQUE INDEX uniq_account(account)&quot;</span></span><br><span class="line"><span class="string">                &quot;sql_from&quot;:[&#123;</span></span><br><span class="line"><span class="string">                    &quot;original_sql&quot;: &quot;alter table frm_user drop index account_idx;&quot;,</span></span><br><span class="line"><span class="string">                    &quot;format_sql&quot;: &quot;ALTER TABLE frm_user\nDROP INDEX account_idx;&quot;,</span></span><br><span class="line"><span class="string">                    &quot;sql_type&quot;: &quot;DDL&quot;,</span></span><br><span class="line"><span class="string">                    &quot;sql_statement&quot;: &quot;ALTER&quot;</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                &#123;</span></span><br><span class="line"><span class="string">                    &quot;original_sql&quot;: &quot;alter table frm_user add unique index uniq_account(account);&quot;,</span></span><br><span class="line"><span class="string">                    &quot;format_sql&quot;: &quot;ALTER TABLE frm_user ADD UNIQUE INDEX uniq_account(account);&quot;,</span></span><br><span class="line"><span class="string">                    &quot;sql_type&quot;: &quot;DDL&quot;,</span></span><br><span class="line"><span class="string">                    &quot;sql_statement&quot;: &quot;ALTER&quot;</span></span><br><span class="line"><span class="string">                &#125;]</span></span><br><span class="line"><span class="string">        ]</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.result = []</span><br><span class="line">        <span class="keyword">for</span> _sql <span class="keyword">in</span> self.sql[<span class="string">&quot;data&quot;</span>]:</span><br><span class="line">            <span class="comment"># 正则匹配出 table_name 和 alter_cmd</span></span><br><span class="line">            sql_str = _sql[<span class="string">&quot;format_sql&quot;</span>].replace(<span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="comment"># print(sql_str)</span></span><br><span class="line">            match_obj = re.match(</span><br><span class="line">                <span class="string">r&#x27;ALTER TABLE(.*)[\n]?(ADD|ALTER|CHANGE|CHARACTER|CONVERT|DISABLE|ENABLE|DROP|FORCE|LOCK|MODIFY|ORDER|RENAME|WITHOUT|WITH)[\n]?(.*);&#x27;</span>,</span><br><span class="line">                sql_str)</span><br><span class="line">            <span class="keyword">if</span> match_obj:</span><br><span class="line">                table_name = match_obj.group(<span class="number">1</span>).strip()</span><br><span class="line">                alter_cmd_key = match_obj.group(<span class="number">2</span>).strip()</span><br><span class="line">                alter_cmd_option = match_obj.group(<span class="number">3</span>).strip()</span><br><span class="line">                <span class="comment"># print(table_name)</span></span><br><span class="line">                <span class="comment"># print(alter_cmd_key)</span></span><br><span class="line">                <span class="comment"># print(alter_cmd_option)</span></span><br><span class="line">                self.result.append(</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;table_name&quot;</span>: table_name.strip(),</span><br><span class="line">                        <span class="string">&quot;alter_cmd&quot;</span>: <span class="string">&quot;&#123;&#125; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(alter_cmd_key.strip(),</span><br><span class="line">                                                    alter_cmd_option.strip().replace(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&quot;&#x27;&quot;</span>)),</span><br><span class="line">                        <span class="string">&quot;sql_from&quot;</span>: _sql</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;不能正常匹配&quot;</span>)</span><br><span class="line">                self.result.append(</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">&quot;table_name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;alter_cmd&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;sql_from&quot;</span>: _sql</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># print(json.dumps(self.result, indent=2, ensure_ascii=False))</span></span><br><span class="line">        <span class="keyword">return</span> self.result</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sql_to_pt</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        组成pt脚本</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        table_names = <span class="built_in">set</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="string">&quot;table_name&quot;</span>], self.result))</span><br><span class="line">        <span class="comment"># print(table_names)</span></span><br><span class="line">        out = []</span><br><span class="line">        <span class="keyword">for</span> table <span class="keyword">in</span> table_names:</span><br><span class="line">            <span class="comment"># print(table)</span></span><br><span class="line">            info = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x: x[<span class="string">&quot;table_name&quot;</span>] == table, self.result))</span><br><span class="line">            <span class="comment"># print(json.dumps(info, indent=2))</span></span><br><span class="line">            out.append(</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;table_name&quot;</span>: table,</span><br><span class="line">                    <span class="string">&quot;alter_cmd&quot;</span>: <span class="string">&#x27;,&#x27;</span>.join(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x[<span class="string">&quot;alter_cmd&quot;</span>], info))),</span><br><span class="line">                    <span class="string">&quot;sql_from&quot;</span>: info</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># print(json.dumps(out, indent=2, ensure_ascii=False))</span></span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GetScripts</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, sql_list, **kwargs</span>):</span><br><span class="line">        self.render_data = &#123;<span class="string">&quot;sql_list&quot;</span>: sql_list,</span><br><span class="line">                            <span class="string">&quot;time_string&quot;</span>: time.strftime(<span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>, time.localtime(time.time())),</span><br><span class="line">                            <span class="string">&quot;host&quot;</span>: kwargs[<span class="string">&#x27;host&#x27;</span>],</span><br><span class="line">                            <span class="string">&quot;port&quot;</span>: kwargs[<span class="string">&#x27;port&#x27;</span>],</span><br><span class="line">                            <span class="string">&quot;dbname&quot;</span>: kwargs[<span class="string">&#x27;dbname&#x27;</span>],</span><br><span class="line">                            <span class="string">&quot;user&quot;</span>: kwargs[<span class="string">&#x27;user&#x27;</span>],</span><br><span class="line">                            <span class="string">&quot;password&quot;</span>: kwargs[<span class="string">&#x27;password&#x27;</span>],</span><br><span class="line">                            &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render_template</span>(<span class="params">self</span>):</span><br><span class="line">        template_data = <span class="string">&quot;&quot;&quot;#!/bin/bash</span></span><br><span class="line"><span class="string"># pt-osc scripts</span></span><br><span class="line"><span class="string"># &#123;&#123; time_string &#125;&#125;</span></span><br><span class="line"><span class="string"># Solar 混合云管理平台     </span></span><br><span class="line"><span class="string">host=&#123;&#123; host &#125;&#125;</span></span><br><span class="line"><span class="string">port=&#123;&#123; port &#125;&#125;</span></span><br><span class="line"><span class="string">dbname=&#123;&#123; dbname &#125;&#125;</span></span><br><span class="line"><span class="string">user=&#123;&#123; user &#125;&#125;</span></span><br><span class="line"><span class="string">password=&#123;&#123; password &#125;&#125;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">&#123;% for sql in sql_list %&#125;</span></span><br><span class="line"><span class="string">table=&#123;&#123; sql.table_name &#125;&#125;</span></span><br><span class="line"><span class="string">pt-online-schema-change --user=$&#123;user&#125; --port=$&#123;port&#125; --host=$&#123;host&#125; --password=$&#123;password&#125; --alter=&quot;&#123;&#123; sql.alter_cmd &#125;&#125;&quot; D=$&#123;dbname&#125;,t=$&#123;table&#125; --noversion-check --execute --charset=utf8</span></span><br><span class="line"><span class="string">&#123;% endfor %&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">        template = Template(template_data)</span><br><span class="line">        <span class="keyword">return</span> template.render(**self.render_data)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">maker</span>(<span class="params">self</span>):</span><br><span class="line">        data = self.render_template()</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SQLCheck</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    检测三个条件:</span></span><br><span class="line"><span class="string">    1. 检查语句中是否包含数据库名，如果包含则Fail;</span></span><br><span class="line"><span class="string">    2. 检查语句结尾是否为分号，如果是则True；</span></span><br><span class="line"><span class="string">    3. 判断SQL是否都为DDL Alter 语句，如果是则True；</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    [</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        &quot;original_sql&quot;: &quot;ALTER TABLE `aia_use_app_tag_log`   ADD  INDEX `idx_app_use_time` (`use_time`)&quot;,</span></span><br><span class="line"><span class="string">        &quot;format_sql&quot;: &quot;ALTER TABLE `aia_use_app_tag_log` ADD INDEX `idx_app_use_time` (`use_time`)&quot;,</span></span><br><span class="line"><span class="string">        &quot;sql_type&quot;: &quot;DDL&quot;,</span></span><br><span class="line"><span class="string">        &quot;sql_statement&quot;: &quot;ALTER&quot;,</span></span><br><span class="line"><span class="string">        &quot;check_alter&quot;: &quot;Pass&quot;,</span></span><br><span class="line"><span class="string">        &quot;check_database&quot;: &quot;Pass&quot;,</span></span><br><span class="line"><span class="string">        &quot;check_semicolon&quot;: &quot;Fail&quot;,</span></span><br><span class="line"><span class="string">        &quot;check_comma&quot;: &quot;Fail&quot;,</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    ]</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, in_data_list</span>):</span><br><span class="line">        self.in_data_list = in_data_list</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_database</span>(<span class="params">self, _data, pass_num, fail_num</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        检查语句中是否包含数据库名，如果包含则Fail</span></span><br><span class="line"><span class="string">        语句中不可以包含.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> _data[<span class="string">&quot;format_sql&quot;</span>].find(<span class="string">&#x27;.&#x27;</span>) &lt; <span class="number">0</span>:</span><br><span class="line">            _data[<span class="string">&quot;check_database&quot;</span>] = <span class="string">&quot;Pass&quot;</span></span><br><span class="line">            pass_num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            _data[<span class="string">&quot;check_database&quot;</span>] = <span class="string">&quot;Fail&quot;</span></span><br><span class="line">            fail_num += <span class="number">1</span></span><br><span class="line">        out_data = _data</span><br><span class="line">        <span class="keyword">return</span> pass_num, fail_num, out_data</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_semicolon</span>(<span class="params">self, _data, pass_num, fail_num</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        检查语句结尾是否为分号，如果是则True</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> _data[<span class="string">&quot;format_sql&quot;</span>].find(<span class="string">&#x27;;&#x27;</span>) &gt;= <span class="number">0</span>:</span><br><span class="line">            _data[<span class="string">&quot;check_semicolon&quot;</span>] = <span class="string">&quot;Pass&quot;</span></span><br><span class="line">            pass_num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            _data[<span class="string">&quot;check_semicolon&quot;</span>] = <span class="string">&quot;Fail&quot;</span></span><br><span class="line">            fail_num += <span class="number">1</span></span><br><span class="line">        out_data = _data</span><br><span class="line">        <span class="keyword">return</span> pass_num, fail_num, out_data</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check_alter</span>(<span class="params">self, _data, pass_num, fail_num</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        判断SQL是否都为DDL Alter 语句</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> _data[<span class="string">&quot;sql_type&quot;</span>] == <span class="string">&quot;DDL&quot;</span> <span class="keyword">and</span> _data[<span class="string">&quot;sql_statement&quot;</span>] == <span class="string">&quot;ALTER&quot;</span>:</span><br><span class="line">            _data[<span class="string">&quot;check_alter&quot;</span>] = <span class="string">&quot;Pass&quot;</span></span><br><span class="line">            pass_num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            _data[<span class="string">&quot;check_alter&quot;</span>] = <span class="string">&quot;Fail&quot;</span></span><br><span class="line">            fail_num += <span class="number">1</span></span><br><span class="line">        out_data = _data</span><br><span class="line">        <span class="keyword">return</span> pass_num, fail_num, out_data</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">self</span>):</span><br><span class="line">        out_data_list = []</span><br><span class="line">        pass_num = <span class="number">0</span></span><br><span class="line">        fail_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> _data <span class="keyword">in</span> self.in_data_list:</span><br><span class="line">            pass_num, fail_num, out_data = self.check_alter(_data, pass_num, fail_num)</span><br><span class="line">            pass_num, fail_num, out_data = self.check_database(_data, pass_num, fail_num)</span><br><span class="line">            pass_num, fail_num, out_data = self.check_semicolon(_data, pass_num, fail_num)</span><br><span class="line">            out_data_list.append(out_data)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;pass_num&quot;</span>: pass_num,</span><br><span class="line">            <span class="string">&quot;fail_num&quot;</span>: fail_num,</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: out_data_list</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start_up</span>(<span class="params">**kwargs</span>):</span><br><span class="line">    <span class="comment"># 1. 解析SQL SQLParseHelper()</span></span><br><span class="line">    api = SQLParseHelper(sql_str=kwargs[<span class="string">&quot;sql_str&quot;</span>], split_str=<span class="string">&quot;;&quot;</span>)</span><br><span class="line">    sql_num = api.get_length()</span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> sql <span class="keyword">in</span> api.sql_list:</span><br><span class="line">        format_sql = api.get_format(sql)</span><br><span class="line">        result = api.get_init(format_sql)</span><br><span class="line">        data.append(&#123;</span><br><span class="line">            <span class="string">&quot;original_sql&quot;</span>: sql,</span><br><span class="line">            <span class="string">&quot;format_sql&quot;</span>: format_sql.strip(),</span><br><span class="line">            <span class="string">&quot;sql_type&quot;</span>: api.get_type(tokens=result[<span class="number">1</span>]),</span><br><span class="line">            <span class="string">&quot;sql_statement&quot;</span>: api.sql_statement(tokens=result[<span class="number">1</span>]),</span><br><span class="line">        &#125;)</span><br><span class="line">    new_result = &#123;</span><br><span class="line">        <span class="string">&quot;num&quot;</span>: sql_num,</span><br><span class="line">        <span class="string">&quot;data&quot;</span>: data</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># print(json.dumps(new_result, indent=2, ensure_ascii=False))</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 2. 判断SQL是否都为DDL Alter 语句 check_alter()</span></span><br><span class="line">    check_api = SQLCheck(new_result[<span class="string">&quot;data&quot;</span>])</span><br><span class="line">    check_result = check_api.main()</span><br><span class="line">    <span class="comment"># print(json.dumps(check_result, indent=2, ensure_ascii=False))</span></span><br><span class="line">    <span class="keyword">if</span> check_result[<span class="string">&quot;fail_num&quot;</span>] &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;检测不通过&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(json.dumps(</span><br><span class="line">            <span class="built_in">list</span>(<span class="built_in">filter</span>(</span><br><span class="line">                <span class="keyword">lambda</span> x: x[<span class="string">&quot;check_alter&quot;</span>] == <span class="string">&#x27;Fail&#x27;</span> <span class="keyword">or</span> x[<span class="string">&quot;check_database&quot;</span>] == <span class="string">&#x27;Fail&#x27;</span> <span class="keyword">or</span> x[</span><br><span class="line">                    <span class="string">&quot;check_semicolon&quot;</span>] == <span class="string">&#x27;Fail&#x27;</span> <span class="keyword">or</span> x[<span class="string">&quot;check_comma&quot;</span>] == <span class="string">&quot;Fail&quot;</span>,</span><br><span class="line">                check_result[<span class="string">&quot;data&quot;</span>]</span><br><span class="line">            ))</span><br><span class="line">            , indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line">        <span class="comment"># print(json.dumps(check_result, indent=2, ensure_ascii=False))</span></span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        <span class="comment"># print(&quot;检测通过&quot;)</span></span><br><span class="line">        <span class="comment"># print(json.dumps(check_result, indent=2, ensure_ascii=False))</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 3. 转PT PTHelper()</span></span><br><span class="line">    pt_api = PTHelper(check_result)</span><br><span class="line">    pt_api.alter_sql_parse()</span><br><span class="line">    pt_sql_list = pt_api.sql_to_pt()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 4. 渲染脚本</span></span><br><span class="line">    scripts_api = GetScripts(pt_sql_list, **kwargs)</span><br><span class="line">    data = scripts_api.maker()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;&#x27;&#x27;MySQL Alter语句自动转 PT脚本 小工具</span></span><br><span class="line"><span class="string">    支持的Alter类型：ADD|ALTER|CHANGE|CHARACTER|CONVERT|DISABLE|ENABLE|DROP|FORCE|LOCK|MODIFY|ORDER|RENAME|WITHOUT|WITH ；</span></span><br><span class="line"><span class="string">    不支持带库名；</span></span><br><span class="line"><span class="string">    不支持一条sql多个变。</span></span><br><span class="line"><span class="string">    输出结果</span></span><br><span class="line"><span class="string">    #!/bin/bash</span></span><br><span class="line"><span class="string">    # pt-osc scripts</span></span><br><span class="line"><span class="string">    # 20200522190824</span></span><br><span class="line"><span class="string">    # Solar 混合云管理平台     </span></span><br><span class="line"><span class="string">    host=localhost</span></span><br><span class="line"><span class="string">    port=3306</span></span><br><span class="line"><span class="string">    dbname=test01</span></span><br><span class="line"><span class="string">    user=root</span></span><br><span class="line"><span class="string">    password=lsdkjkdjfkdf</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    table=frm_user</span></span><br><span class="line"><span class="string">    pt-online-schema-change --user=$&#123;user&#125; --port=$&#123;port&#125; --host=$&#123;host&#125; --password=$&#123;password&#125; --alter=&quot;DROP INDEX account_idx,ADD UNIQUE INDEX uniq_account(account)&quot; D=$&#123;dbname&#125;,t=$&#123;table&#125; --no-version-check --execute --charset=utf8</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    table=aia_present_point_exchange_user</span></span><br><span class="line"><span class="string">    pt-online-schema-change --user=$&#123;user&#125; --port=$&#123;port&#125; --host=$&#123;host&#125; --password=$&#123;password&#125; --alter=&quot;ADD COLUMN end_date DATETIME NULL COMMENT &#x27;有效期结束&#x27; AFTER start_date&quot; D=$&#123;dbname&#125;,t=$&#123;table&#125; --no-version-check --execute --charset=utf8</span></span><br><span class="line"><span class="string">    &quot;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">    Example：</span></span><br><span class="line"><span class="string">    python3 get_sql2pt.py --InFile demo/mysql_alter_demo.sql --OutFile demo/mysql_alter_pt.sh --Host localhost --Port 3306 --DBName test01 --User root --PassWord lsdkjkdjfkdf</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>, formatter_class=argparse.RawTextHelpFormatter)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--InFile&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;MySQL Alter SQL源文件 必要参数&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--OutFile&quot;</span>,</span><br><span class="line">                        default=<span class="string">&#x27;sql2pt-&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(time.strftime(<span class="string">&#x27;%Y%m%d%H%M%S&#x27;</span>, time.localtime(time.time()))),</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">&quot;转换后的脚本名 非参数&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--Host&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;MySQL服务器连接地址&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--Port&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;MySQL服务器监听端口&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--DBName&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;MySQL访问的数据库名&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--User&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;MySQL服务器登陆用户名&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;--PassWord&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;MySQL服务器登陆用户密码&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    <span class="keyword">if</span> args.InFile <span class="keyword">and</span> args.Host <span class="keyword">and</span> args.Port <span class="keyword">and</span> args.DBName <span class="keyword">and</span> args.User <span class="keyword">and</span> args.PassWord:</span><br><span class="line">        sql_str = <span class="built_in">open</span>(args.InFile, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>).read().replace(<span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&quot;sql_str&quot;</span>: sql_str,</span><br><span class="line">            <span class="string">&quot;out_file&quot;</span>: args.OutFile,</span><br><span class="line">            <span class="string">&quot;host&quot;</span>: args.Host,</span><br><span class="line">            <span class="string">&quot;port&quot;</span>: args.Port,</span><br><span class="line">            <span class="string">&quot;dbname&quot;</span>: args.DBName,</span><br><span class="line">            <span class="string">&quot;user&quot;</span>: args.User,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: args.PassWord</span><br><span class="line">        &#125;</span><br><span class="line">        result = start_up(**params)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(args.OutFile, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(result)</span><br></pre></td></tr></table></figure><h2 id="归档"><a href="#归档" class="headerlink" title="归档"></a>归档</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pt-archiver  --<span class="built_in">source</span> h=<span class="variable">$&#123;host&#125;</span>,P=3306,u=<span class="variable">$&#123;user&#125;</span>,p=<span class="variable">$&#123;password&#125;</span>,D=<span class="variable">$&#123;database&#125;</span>,t=<span class="variable">$&#123;table&#125;</span> --dest h=<span class="variable">$&#123;host&#125;</span>,P=3306,u=<span class="variable">$&#123;user&#125;</span>,p=<span class="variable">$&#123;password&#125;</span>,D=<span class="variable">$&#123;database&#125;</span>,t=<span class="variable">$&#123;table&#125;</span>  --no-check-charset --<span class="built_in">where</span> <span class="string">&quot;use_time &lt; &#x27;2020-01-01&#x27;&quot;</span> --progress 5000 --<span class="built_in">limit</span>=1000 --txn-size=1000 --statistics --bulk-insert --bulk-delete --charset <span class="string">&#x27;utf8&#x27;</span> --noversion-check</span><br></pre></td></tr></table></figure><p>参数说明：</p><p><code>--source</code>: 源端<br><code>--dest</code>: 目标端<br><code>--dry-run</code>: debug模式，尝试运行。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;数据库版本和工具版本要求&quot;&gt;&lt;a href=&quot;#数据库版本和工具版本要求&quot; class=&quot;headerlink&quot; title=&quot;数据库版本和工具版本要求&quot;&gt;&lt;/a&gt;数据库版本和工具版本要求&lt;/h1&gt;&lt;div class=&quot;table-container&quot;&gt;
&lt;ta
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>MySQL 8.0 Root 密码在线破解</title>
    <link href="http://www.toberoot.com/news/2020/09/24/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/09/24/tec-mysql/</id>
    <published>2020-09-24T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.521Z</updated>
    
    <content type="html"><![CDATA[<p>```bash</p><h1 id="测试用户booboo的账号密码情况"><a href="#测试用户booboo的账号密码情况" class="headerlink" title="测试用户booboo的账号密码情况"></a>测试用户booboo的账号密码情况</h1><p>mysql&gt; select user,host,authentication_string from mysql.user;<br>+—————————+—————-+————————————————————————————————————+<br>| user             | host      | authentication_string                                                  |<br>+—————————+—————-+————————————————————————————————————+<br>| booboo           | %         | $A$005$z1;I4T4DFutFGI2Bx8I44RVy7oa0lY6paOoRofbbNcnFKUVJ3ojJkDvCw8 |</p><h1 id="系统库mysql"><a href="#系统库mysql" class="headerlink" title="系统库mysql"></a>系统库mysql</h1><p>[root@foundation0 tmp]# ll /var/lib/mysql/mysql*<br>-rw-r——-. 1 mysql mysql 25165824 9月  24 17:44 /var/lib/mysql/mysql.ibd<br>srwxrwxrwx. 1 mysql mysql        0 6月   1 17:46 /var/lib/mysql/mysql.sock<br>-rw———-. 1 mysql mysql        6 6月   1 17:46 /var/lib/mysql/mysql.sock.lock</p><p>/var/lib/mysql/mysql:<br>总用量 28<br>-rw-r——-. 1 mysql mysql  5594 6月   1 17:46 general_log_202.sdi<br>-rw-r——-. 1 mysql mysql    35 6月   1 17:46 general_log.CSM<br>-rw-r——-. 1 mysql mysql     0 6月   1 17:46 general_log.CSV<br>-rw-r——-. 1 mysql mysql 11803 6月   1 17:46 slow_log_203.sdi<br>-rw-r——-. 1 mysql mysql    35 6月   1 17:46 slow_log.CSM<br>-rw-r——-. 1 mysql mysql     0 6月   1 17:46 slow_log.CSV</p><h1 id="复制一份-mysql-ibd"><a href="#复制一份-mysql-ibd" class="headerlink" title="复制一份 mysql.ibd"></a>复制一份 mysql.ibd</h1><p>cp /var/lib/mysql/mysql.ibd /tmp/mysql.ibd.bac</p><h1 id="hexdump-分析"><a href="#hexdump-分析" class="headerlink" title="hexdump 分析"></a>hexdump 分析</h1><p>hexdump -C mysql.ibd.bac  &gt; /tmp/mysql.ibd.hexdump.txt</p><p><em><br>006912f0  20 20 20 20 20 20 20 20  20 20 71 69 6e 78 69 20  |          qinxi |<br>00691300  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |<br>00691310  20 20 20 20 20 20 20 20  20 20 00 00 00 00 14 d7  |          ……|<br>00691320  02 00 00 01 1e 14 56 02  02 02 02 02 02 02 02 02  |……V………|<br>00691330  02 01 02 02 02 02 02 02  02 02 02 02 02 02 02 02  |…………….|<br>00691340  02 02 02 02 01 00 00 00  00 00 00 00 00 00 00 00  |…………….|<br>00691350  00 00 00 00 00 63 61 63  68 69 6e 67 5f 73 68 61  |…..caching_sha|<br>00691360  32 5f 70 61 73 73 77 6f  72 64 20 20 20 20 20 20  |2_password      |<br>00691370  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |</em><br>00691390  20 20 20 20 20 24 41 24  30 30 35 24 21 3e 13 58  |     $A$005$!&gt;.X|<br>006913a0  6c 74 5d 39 62 42 2d 25  10 75 06 57 68 46 79 52  |lt]9bB-%.u.WhFyR|<br>006913b0  53 4d 4e 38 39 54 42 68  4a 53 35 67 5a 6c 72 53  |SMN89TBhJS5gZlrS|<br>006913c0  32 4d 55 59 2f 4c 77 4c  38 4c 37 4f 4e 68 47 72  |2MUY/LwL8L7ONhGr|<br>006913d0  67 4a 68 65 36 37 65 39  4c 79 36 01 5f 6a b1 2c  |gJhe67e9Ly6._j.,|<br>006913e0  01 02 02 46 40 00 00 00  20 7c 00 00 60 fe 0c 25  |…F@… |..`..%|<br>006913f0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |<br><em><br>006914e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 62 6f  |              bo|<br>006914f0  6f 62 6f 6f 20 20 20 20  20 20 20 20 20 20 20 20  |oboo            |<br>00691500  20 20 20 20 20 20 20 20  20 20 20 20 20 20 00 00  |              ..|<br>00691510  00 00 14 e1 82 00 00 00  9f 01 10 01 01 01 01 01  |…………….|<br>00691520  01 01 01 01 01 01 01 01  01 01 01 01 01 01 01 01  |…………….|<br>00691530  01 01 01 01 01 01 01 01  01 00 00 00 00 00 00 00  |…………….|<br>00691540  00 00 00 00 00 00 00 00  00 63 61 63 68 69 6e 67  |………caching|<br>00691550  5f 73 68 61 32 5f 70 61  73 73 77 6f 72 64 20 20  |_sha2_password  |<br>00691560  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |</em><br>00691580  20 20 20 20 20 20 20 20  20 24 41 24 30 30 35 24  |         $A$005$|<br>00691590  7a 31 03 3b 1b 71 49 34  1f 54 0e 34 44 46 75 74  |z1.;.qI4.T.4DFut|<br>006915a0  46 47 49 32 42 78 38 49  34 34 52 56 79 37 6f 61  |FGI2Bx8I44RVy7oa|<br>006915b0  30 6c 59 36 70 61 4f 6f  52 6f 66 62 62 4e 63 6e  |0lY6paOoRofbbNcn|<br>006915c0  46 4b 55 56 4a 33 6f 6a  4a 6b 44 76 43 77 38 01  |FKUVJ3ojJkDvCw8.|<br>006915d0  5f 6c 6a 26 01 01 01 00  00 00 00 00 00 00 00 00  |_lj&amp;…………|<br>006915e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |…………….|<br>*</p><p>00691580  20 20 20 20 20 24 41 24  30 30 35 24 21 3e 13 58  |     $A$005$!&gt;.X|<br>00691590  6c 74 5d 39 62 42 2d 25  10 75 06 57 68 46 79 52  |lt]9bB-%.u.WhFyR|<br>006915a0  53 4d 4e 38 39 54 42 68  4a 53 35 67 5a 6c 72 53  |SMN89TBhJS5gZlrS|<br>006915b0  32 4d 55 59 2f 4c 77 4c  38 4c 37 4f 4e 68 47 72  |2MUY/LwL8L7ONhGr|<br>006915c0  67 4a 68 65 36 37 65 39  4c 79 36 01 5f 6a b1 2c  |gJhe67e9Ly6._j.,|<br>006915d0  01 02 02 46 40 00 00 00  20 7c 00 00 60 fe 0c 25  |…F@… |..`..%|<br>006915e0  20 20 20 20 20 20 20 20  20 20 20 20 20 20 20 20  |                |</p><p>测试发现失败，推测8.0的加密算法已不再是仅仅使用密码进行加密。</p><p>进一步尝试修改权限来实现。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;```bash&lt;/p&gt;
&lt;h1 id=&quot;测试用户booboo的账号密码情况&quot;&gt;&lt;a href=&quot;#测试用户booboo的账号密码情况&quot; class=&quot;headerlink&quot; title=&quot;测试用户booboo的账号密码情况&quot;&gt;&lt;/a&gt;测试用户booboo的账号密码情况&lt;/h
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>MySQL 使用性能模式进行查询分析</title>
    <link href="http://www.toberoot.com/news/2020/09/22/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/09/22/tec-mysql/</id>
    <published>2020-09-22T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.520Z</updated>
    
    <content type="html"><![CDATA[<h1 id="使用-Profiles-分析-SQL-语句执行时间和消耗资源"><a href="#使用-Profiles-分析-SQL-语句执行时间和消耗资源" class="headerlink" title="使用 Profiles 分析 SQL 语句执行时间和消耗资源"></a><a href="https://dev.mysql.com/doc/refman/8.0/en/show-profile.html">使用 Profiles 分析 SQL 语句执行时间和消耗资源</a></h1><blockquote><p>SHOW PROFILE 和 SHOW PROFILES 语句将在未来的MySQL版本中删除。</p></blockquote><ul><li>type可以指定 可选值以显示特定的其他信息类型：</li><li>ALL 显示所有信息</li><li>BLOCK IO 显示块输入和输出操作的计数</li><li>CONTEXT SWITCHES 显示自愿和非自愿上下文切换的计数</li><li>CPU 显示用户和系统的CPU使用时间</li><li>IPC 显示已发送和已接收邮件的计数</li><li>MEMORY 目前尚未实施</li><li>PAGE FAULTS 显示主要和次要页面错误的计数</li><li>SOURCE 显示源代码中的函数名称以及该函数所在文件的名称和行号</li><li>SWAPS 显示掉期计数</li></ul><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> @<span class="variable">@profiling</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@profiling</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="operator">|</span>           <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SET</span> profiling <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> t1;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected, <span class="number">1</span> warning (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> T1 (id <span class="type">INT</span>);</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> PROFILES;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+--------------------------+</span></span><br><span class="line"><span class="operator">|</span> Query_ID <span class="operator">|</span> Duration <span class="operator">|</span> Query                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+--------------------------+</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">0</span> <span class="operator">|</span> <span class="number">0.000088</span> <span class="operator">|</span> <span class="keyword">SET</span> PROFILING <span class="operator">=</span> <span class="number">1</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">1</span> <span class="operator">|</span> <span class="number">0.000136</span> <span class="operator">|</span> <span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> t1  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>        <span class="number">2</span> <span class="operator">|</span> <span class="number">0.011947</span> <span class="operator">|</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (id <span class="type">INT</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+--------------------------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> PROFILE;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Status               <span class="operator">|</span> Duration <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> checking permissions <span class="operator">|</span> <span class="number">0.000040</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> creating <span class="keyword">table</span>       <span class="operator">|</span> <span class="number">0.000056</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> After <span class="keyword">create</span>         <span class="operator">|</span> <span class="number">0.011363</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> query <span class="keyword">end</span>            <span class="operator">|</span> <span class="number">0.000375</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> freeing items        <span class="operator">|</span> <span class="number">0.000089</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> logging slow query   <span class="operator">|</span> <span class="number">0.000019</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> cleaning up          <span class="operator">|</span> <span class="number">0.000005</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> PROFILE <span class="keyword">FOR</span> QUERY <span class="number">1</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Status             <span class="operator">|</span> Duration <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> query <span class="keyword">end</span>          <span class="operator">|</span> <span class="number">0.000107</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> freeing items      <span class="operator">|</span> <span class="number">0.000008</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> logging slow query <span class="operator">|</span> <span class="number">0.000015</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> cleaning up        <span class="operator">|</span> <span class="number">0.000006</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+----------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> PROFILE CPU <span class="keyword">FOR</span> QUERY <span class="number">2</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+----------+------------+</span></span><br><span class="line"><span class="operator">|</span> Status               <span class="operator">|</span> Duration <span class="operator">|</span> CPU_user <span class="operator">|</span> CPU_system <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+----------+------------+</span></span><br><span class="line"><span class="operator">|</span> checking permissions <span class="operator">|</span> <span class="number">0.000040</span> <span class="operator">|</span> <span class="number">0.000038</span> <span class="operator">|</span>   <span class="number">0.000002</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> creating <span class="keyword">table</span>       <span class="operator">|</span> <span class="number">0.000056</span> <span class="operator">|</span> <span class="number">0.000028</span> <span class="operator">|</span>   <span class="number">0.000028</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> After <span class="keyword">create</span>         <span class="operator">|</span> <span class="number">0.011363</span> <span class="operator">|</span> <span class="number">0.000217</span> <span class="operator">|</span>   <span class="number">0.001571</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> query <span class="keyword">end</span>            <span class="operator">|</span> <span class="number">0.000375</span> <span class="operator">|</span> <span class="number">0.000013</span> <span class="operator">|</span>   <span class="number">0.000028</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> freeing items        <span class="operator">|</span> <span class="number">0.000089</span> <span class="operator">|</span> <span class="number">0.000010</span> <span class="operator">|</span>   <span class="number">0.000014</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> logging slow query   <span class="operator">|</span> <span class="number">0.000019</span> <span class="operator">|</span> <span class="number">0.000009</span> <span class="operator">|</span>   <span class="number">0.000010</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> cleaning up          <span class="operator">|</span> <span class="number">0.000005</span> <span class="operator">|</span> <span class="number">0.000003</span> <span class="operator">|</span>   <span class="number">0.000002</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+----------+------------+</span></span><br><span class="line"><span class="number">7</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="使用性能模式进行查询分析"><a href="#使用性能模式进行查询分析" class="headerlink" title="使用性能模式进行查询分析"></a><a href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-query-profiling.html">使用性能模式进行查询分析</a></h1><p>以下示例演示了如何使用Performance Schema语句事件和阶段事件来检索与SHOW PROFILES和SHOW PROFILE语句提供的概要分析信息相当的数据。<br>该setup_actors表可用于限制主机，用户或帐户对历史事件的收集，以减少运行时开销和历史表中收集的数据量。该示例的第一步显示了如何将历史事件的收集限制为特定用户。<br>性能架构以皮秒（万亿分之一秒）为单位显示事件计时器信息，以将计时数据标准化为标准单位。在下面的示例中，将 TIMER_WAIT值除以1000000000000，以秒为单位显示数据。值也将被截断为小数点后6位，以与SHOW PROFILESand SHOW PROFILE语句相同的格式显示数据。</p><p>使用Performance Schema语句事件和阶段事件来检索与 SHOW PROFILES 和 SHOW PROFILE 语句提供的概要分析信息相当的数据。</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.setup_actors;</span><br><span class="line"># 通过更新setup_instruments表确保已启用语句和阶段检测 。默认情况下，可能已启用。</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_instruments <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span>, TIMED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%statement/%&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_instruments <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span>, TIMED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%stage/%&#x27;</span>;   </span><br><span class="line"># 确保已启用events_statements_<span class="operator">*</span>和 events_stages_<span class="operator">*</span>使用者。</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_consumers <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%events_statements_%&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_consumers <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%events_stages_%&#x27;</span>;</span><br><span class="line"># 运行要分析的语句</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> x2_user;</span><br><span class="line"># EVENT_ID通过查询events_statements_history_long 表来 标识语句 。此步骤类似于运行 <span class="keyword">SHOW</span> PROFILES以标识 Query_ID。以下查询产生类似于以下内容的输出<span class="keyword">SHOW</span> PROFILES：</span><br><span class="line"><span class="keyword">SELECT</span> EVENT_ID, <span class="keyword">TRUNCATE</span>(TIMER_WAIT<span class="operator">/</span><span class="number">1000000000000</span>,<span class="number">6</span>) <span class="keyword">as</span> Duration, SQL_TEXT <span class="keyword">FROM</span> performance_schema.events_statements_history_long <span class="keyword">WHERE</span> SQL_TEXT <span class="keyword">like</span> <span class="string">&#x27;%user%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span> EVENT_ID <span class="operator">|</span> Duration <span class="operator">|</span> SQL_TEXT              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+-----------------------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">84</span> <span class="operator">|</span> <span class="number">0.020524</span> <span class="operator">|</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> x2_user <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+-----------------------+   </span></span><br><span class="line"># 查询 events_stages_history_long 表以检索语句的阶段事件。阶段使用事件嵌套链接到语句。每个阶段事件记录都有一个NESTING_EVENT_ID包含EVENT_ID父语句的的列。 </span><br><span class="line"><span class="keyword">SELECT</span> event_name <span class="keyword">AS</span> Stage, <span class="keyword">TRUNCATE</span>(TIMER_WAIT<span class="operator">/</span><span class="number">1000000000000</span>,<span class="number">6</span>) <span class="keyword">AS</span> Duration <span class="keyword">FROM</span> performance_schema.events_stages_history_long <span class="keyword">WHERE</span> NESTING_EVENT_ID<span class="operator">=</span><span class="number">84</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Stage                          <span class="operator">|</span> Duration <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>starting             <span class="operator">|</span> <span class="number">0.000031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>checking permissions <span class="operator">|</span> <span class="number">0.000003</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>Opening tables       <span class="operator">|</span> <span class="number">0.000769</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>init                 <span class="operator">|</span> <span class="number">0.000065</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span><span class="keyword">System</span> lock          <span class="operator">|</span> <span class="number">0.000011</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>optimizing           <span class="operator">|</span> <span class="number">0.000001</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>statistics           <span class="operator">|</span> <span class="number">0.000007</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>preparing            <span class="operator">|</span> <span class="number">0.000006</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>executing            <span class="operator">|</span> <span class="number">0.000212</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>Sending data         <span class="operator">|</span> <span class="number">0.019388</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span><span class="keyword">end</span>                  <span class="operator">|</span> <span class="number">0.000001</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>query <span class="keyword">end</span>            <span class="operator">|</span> <span class="number">0.000003</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>closing tables       <span class="operator">|</span> <span class="number">0.000006</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>freeing items        <span class="operator">|</span> <span class="number">0.000014</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>cleaning up          <span class="operator">|</span> <span class="number">0.000001</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+----------+</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;使用-Profiles-分析-SQL-语句执行时间和消耗资源&quot;&gt;&lt;a href=&quot;#使用-Profiles-分析-SQL-语句执行时间和消耗资源&quot; class=&quot;headerlink&quot; title=&quot;使用 Profiles 分析 SQL 语句执行时间和消耗资源&quot;&gt;
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>CodeSample 全民赛码</title>
    <link href="http://www.toberoot.com/news/2020/09/05/aliyun-game/"/>
    <id>http://www.toberoot.com/news/2020/09/05/aliyun-game/</id>
    <published>2020-09-05T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.519Z</updated>
    
    <content type="html"><![CDATA[<p>本次大赛由阿里云开放平台&amp;阿里云开发者社区&amp;阿里云内容设计部联合举办。</p><h2 id="大赛简介"><a href="#大赛简介" class="headerlink" title="大赛简介"></a>大赛简介</h2><p>阿里云开放平台携手开发者社区、内容设计部，联合举办“OpenAPI 开发者挑战赛第三期—— CodeSample 全民赛码 ”，面向数万开发者，招募阿里云 OpenAPI 示例代码（CodeSample）。无论您是入门开发，或是运维大神，无论是利用 OpenAPI 解决一个轻量场景，或是满足一个小功能，通通到碗里来！现报名通道火热开启，欢迎抢先报名！</p><h3 id="大赛详情"><a href="#大赛详情" class="headerlink" title="大赛详情"></a><a href="https://developer.aliyun.com/topic/codesample/active1">大赛详情</a></h3><h2 id="赛事安排"><a href="#赛事安排" class="headerlink" title="赛事安排"></a>赛事安排</h2><p>大赛报名： 2020.08.12—2020.09.11<br>作品提交截止日：2020.09.13<br>作品评审：2020.09.17<br>获奖公布：2020.09.18</p><h2 id="奖项设置"><a href="#奖项设置" class="headerlink" title="奖项设置"></a>奖项设置</h2><p><strong>一等奖：</strong>1 名，樱桃机械键盘 + 内推资格 + 开放平台天使用户资格 + 参赛奖牌；<br><strong>二等奖：</strong>3 名，大疆特洛（Tello）航拍无人机 + 内推资格 + 参赛奖牌；<br><strong>三等奖：</strong>5 名，Alibaba双肩背包 + 参赛奖牌；<br><strong>参与奖：</strong>20 名，大赛专属奖牌。</p><h2 id="参赛规则"><a href="#参赛规则" class="headerlink" title="参赛规则"></a>参赛规则</h2><p>1、大赛报名：提交参赛作品前，请先进行 <strong><a href="https://survey.aliyun.com/apps/zhiliao/YScU_6Lty?spm=a2c6h.17640777.J_1935739830.1.7b0b54e1ceHGoF">大赛报名</a></strong>，未完成大赛报名的选手，提交的参赛作品视为无效；</p><p>2、作品提交：<strong><a href="https://api.aliyun.com/?spm=a2c6h.17640777.J_6252052100.1.7b0b54e1CI5grf#/codesample">进入作品提交页面</a></strong>，点击“开始编辑”即可编辑和预览 CodeSample，同时可直接提交作品（本次活动唯一作品提交入口），请按照页面上的指南操作。</p><h2 id="作品选题参考"><a href="#作品选题参考" class="headerlink" title="作品选题参考"></a>作品选题参考</h2><p><img src="https://tianchi-public.oss-cn-hangzhou.aliyuncs.com/public/files/forum/159887018616816301598870183654.jpeg" alt="enter image description here"></p><h2 id="实例-demo-参考"><a href="#实例-demo-参考" class="headerlink" title="实例 demo 参考"></a>实例 demo 参考</h2><ul><li><strong><a href="https://developer.aliyun.com/codesample/9?spm=a2c6h.17640777.J_7225173660.1.7b0b54e1wmvdkP">获取 ECS 实例配置</a></strong></li><li><strong><a href="https://developer.aliyun.com/codesample/6?spm=a2c6h.17640777.J_7225173660.2.7b0b54e1wmvdkP">创建 HTTP 监听</a></strong></li><li><strong><a href="https://developer.aliyun.com/codesample/111?spm=a2c6h.17640777.J_7225173660.3.7b0b54e1wmvdkP">创建 NAT 网关</a></strong></li></ul><h2 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h2><p>本次大赛面向所有的开发者，招募阿里云 OpenAPI 示例代码（CodeSample），无论您是入门开发，或是运维大神，只要您对阿里云OpenAPI 感兴趣，就可报名参赛并且提交作品。</p><p>1、报名方式：登录比赛官网，点击报名链接，完成个人信息登记后报名成功；</p><p>2、选手以个人形式参与，并确保报名信息准确有效；</p><p>3、选手交流官方钉钉群：</p><p><img src="https://tianchi-public.oss-cn-hangzhou.aliyuncs.com/public/files/forum/159886906170617151598869059092.jpeg" alt="enter image description here"></p><h2 id="大赛组织"><a href="#大赛组织" class="headerlink" title="大赛组织"></a>大赛组织</h2><p>主办方：阿里云开放平台 | 阿里云开发者社区 | 阿里云内容设计部</p><hr><h1 id="大宝报名"><a href="#大宝报名" class="headerlink" title="大宝报名"></a>大宝报名</h1><p><img src="2020-09-05-aliyun-game/001.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本次大赛由阿里云开放平台&amp;amp;阿里云开发者社区&amp;amp;阿里云内容设计部联合举办。&lt;/p&gt;
&lt;h2 id=&quot;大赛简介&quot;&gt;&lt;a href=&quot;#大赛简介&quot; class=&quot;headerlink&quot; title=&quot;大赛简介&quot;&gt;&lt;/a&gt;大赛简介&lt;/h2&gt;&lt;p&gt;阿里云开放平台携手开发
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>MySQL参数-sql_auto_is_null</title>
    <link href="http://www.toberoot.com/news/2020/07/14/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/07/14/tec-mysql/</id>
    <published>2020-07-14T00:00:00.000Z</published>
    <updated>2022-03-22T03:27:46.519Z</updated>
    
    <content type="html"><![CDATA[<h1 id="sql-auto-is-null"><a href="#sql-auto-is-null" class="headerlink" title="sql_auto_is_null"></a>sql_auto_is_null</h1><p><a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_sql_auto_is_null">sql_auto_is_null</a></p><ul><li><p>| 属性                                                         | 值                 |<br>| —————————————————————————————— | ————————— |<br>| 系统变量                                                     | <code>sql_auto_is_null</code> |<br>| 范围                                                         | 全球会议           |<br>| 动态                                                         | 是                 |<br>| <a href="https://dev.mysql.com/doc/refman/8.0/en/optimizer-hints.html#optimizer-hints-set-var"><code>SET_VAR</code></a> 提示适用 | 是                 |<br>| 类型                                                         | 布尔型             |<br>| 默认值                                                       | <code>OFF</code>              |</p><p>如果启用了此变量，则在成功插入自动生成的<code>AUTO_INCREMENT</code>值的语句之后 ，可以通过发出以下形式的语句来找到该值：</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> tbl_name <span class="keyword">WHERE</span> auto_col <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure><p>如果该语句返回一行，则返回的值与调用该<a href="https://dev.mysql.com/doc/refman/8.0/en/information-functions.html#function_last-insert-id"><code>LAST_INSERT_ID()</code></a>函数的值相同。<br>有关详细信息，包括在多行插入之后的返回值，请参见<a href="https://dev.mysql.com/doc/refman/8.0/en/information-functions.html">第12.15节“信息函数”</a>。如果没有<code>AUTO_INCREMENT</code>成功插入任何<br>值，则该<a href="https://dev.mysql.com/doc/refman/8.0/en/select.html"><code>SELECT</code></a>语句不返回任何行。</p><p>某些ODBC程序（例如Access）使用通过比较来 检索<code>AUTO_INCREMENT</code>值<br>的行为 <a href="https://dev.mysql.com/doc/refman/8.0/en/comparison-operators.html#operator_is-null"><code>IS NULL</code></a>。请参阅 <a href="https://dev.mysql.com/doc/connector-odbc/en/connector-odbc-usagenotes-functionality-last-insert-id.html">获取自动增量值</a>。可以通过设置<a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_sql_auto_is_null"><code>sql_auto_is_null</code></a>为 禁用此行为 <code>OFF</code>。</p><p>在此之前的MySQL 8.0.16，改造，以 执行该语句时，才被执行，这样的值<br>执行期间确定查询是否转化。在MySQL 8.0.16及更高版本中，转换是在语句准备期间执行的。 <code>WHERE *</code>auto_col<code>* IS NULL``WHERE *</code>auto_col<code>* = LAST_INSERT_ID()``sql_auto_is_null</code></p><p>默认值 <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_sql_auto_is_null"><code>sql_auto_is_null</code></a>是 <code>OFF</code>。</p></li></ul><h1 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h1><ol><li>查看当前参数值<code>select @@sql_auto_is_null;</code></li><li>设置参数为开启<code>set @@sql_auto_is_null=1;</code><br> 2.1 创建带自增长主键的表test1 <code>create table test1 (id int primary key auto_increment, name varchar(255));</code><br> 2.2 插入数据 <code>insert into test1 set name=&#39;booboo&#39;;</code><br> 2.3 查看id不为null的列 <code>SELECT * FROM fms.test1 WHERE id IS NULL;</code></li><li>设置参数为关闭<code>set @@sql_auto_is_null=0;</code><br> 3.1 插入数据 <code>insert into test1 set name=&#39;tom&#39;;</code><br> 3.2 查看id不为null的列 <code>SELECT * FROM fms.test1 WHERE id IS NULL;</code></li></ol><blockquote class="note warn"><strong class="note-title">总结</strong><p>sql_auto_is_null 参数默认值为OFF 关闭 0<br>某些ODBC程序（例如Access）使用通过比较来 检索<code>AUTO_INCREMENT</code>值 的行为 [<code>IS NULL</code>]<br>在参数值为ON的情况下，可执行<code>select * from table where id is null;</code><br>不建议开启。</p></blockquote>    <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mysql&gt;select @@sql_auto_is_null;</span><br><span class="line">+------------------------------+</span><br><span class="line">| @@sql_auto_is_null           |</span><br><span class="line">+------------------------------+</span><br><span class="line">| 0                            |</span><br><span class="line">+------------------------------+</span><br><span class="line">返回行数：[1]，耗时：5 ms.</span><br><span class="line">mysql&gt;<span class="built_in">set</span> @@sql_auto_is_null=1;</span><br><span class="line">执行成功，耗时：7 ms.</span><br><span class="line">mysql&gt;create table test1 (<span class="built_in">id</span> int primary key auto_increment, name varchar(255));</span><br><span class="line">执行成功，耗时：113 ms.</span><br><span class="line">mysql&gt;insert into test1 <span class="built_in">set</span> name=<span class="string">&#x27;booboo&#x27;</span></span><br><span class="line">影响行数：[1]，耗时：86 ms.</span><br><span class="line">mysql&gt;select * from test1;</span><br><span class="line">+--------------+----------------+</span><br><span class="line">| <span class="built_in">id</span>           | name           |</span><br><span class="line">+--------------+----------------+</span><br><span class="line">|            1 | booboo         |</span><br><span class="line">+--------------+----------------+</span><br><span class="line">返回行数：[1]，耗时：6 ms.</span><br><span class="line">mysql&gt;select @@sql_auto_is_null;</span><br><span class="line">+------------------------------+</span><br><span class="line">| @@sql_auto_is_null           |</span><br><span class="line">+------------------------------+</span><br><span class="line">| 1                            |</span><br><span class="line">+------------------------------+</span><br><span class="line">返回行数：[1]，耗时：4 ms.</span><br><span class="line">mysql&gt;SELECT * FROM fms.test1 WHERE <span class="built_in">id</span> IS NULL</span><br><span class="line">+--------------+----------------+</span><br><span class="line">| <span class="built_in">id</span>           | name           |</span><br><span class="line">+--------------+----------------+</span><br><span class="line">|            1 | booboo         |</span><br><span class="line">+--------------+----------------+</span><br><span class="line">返回行数：[1]，耗时：16 ms.</span><br><span class="line">mysql&gt;<span class="built_in">set</span> @@sql_auto_is_null=0;</span><br><span class="line">执行成功，耗时：5 ms.</span><br><span class="line">mysql&gt;insert into test1 <span class="built_in">set</span> name=<span class="string">&#x27;tom&#x27;</span></span><br><span class="line">影响行数：[1]，耗时：11 ms.</span><br><span class="line">mysql&gt;SELECT * FROM fms.test1 WHERE <span class="built_in">id</span> IS NULL</span><br><span class="line">+--------------+----------------+</span><br><span class="line">| <span class="built_in">id</span>           | name           |</span><br><span class="line">+--------------+----------------+</span><br><span class="line">返回行数：[0]，耗时：4 ms.</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;sql-auto-is-null&quot;&gt;&lt;a href=&quot;#sql-auto-is-null&quot; class=&quot;headerlink&quot; title=&quot;sql_auto_is_null&quot;&gt;&lt;/a&gt;sql_auto_is_null&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="MySQL" scheme="http://www.toberoot.com/tags/MySQL/"/>
    
      <category term="参数" scheme="http://www.toberoot.com/tags/%E5%8F%82%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>MySQL慢查询使用Table方式记录</title>
    <link href="http://www.toberoot.com/news/2020/06/03/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/06/03/tec-mysql/</id>
    <published>2020-06-03T10:47:33.000Z</published>
    <updated>2022-03-22T03:27:46.519Z</updated>
    
    <content type="html"><![CDATA[<p>默认MySQL慢查询使用FILE记录，为方便数据分析，改为使用Table的方式保存，方便拉取后过滤分析。</p><blockquote class="note info"><strong class="note-title">MySQL慢查询使用Table方式记录</strong><ol><li>开启慢查询</li><li>设置必要参数</li><li>设置采集器</li><li>设置轮询</li></ol></blockquote><h2 id="查看慢查询相关参数"><a href="#查看慢查询相关参数" class="headerlink" title="查看慢查询相关参数"></a>查看慢查询相关参数</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  </span><br><span class="line">  <span class="string">&#x27;slow_query_log&#x27;</span> <span class="keyword">as</span>  <span class="keyword">parameter</span>, </span><br><span class="line">  @<span class="variable">@slow</span>_query_log  <span class="keyword">as</span>  <span class="keyword">value</span>, <span class="string">&#x27;慢查询日志开启状态&#x27;</span> <span class="keyword">as</span>  info</span><br><span class="line"><span class="keyword">UNION</span>  </span><br><span class="line"><span class="keyword">SELECT</span>  </span><br><span class="line">  <span class="string">&#x27;long_query_time&#x27;</span>, </span><br><span class="line">  @<span class="variable">@long</span>_query_time, <span class="string">&#x27;慢查询阈值&#x27;</span> </span><br><span class="line"><span class="keyword">UNION</span>  </span><br><span class="line"><span class="keyword">SELECT</span>  </span><br><span class="line">  <span class="string">&#x27;log_output&#x27;</span>, </span><br><span class="line">  @<span class="variable">@log</span>_output, </span><br><span class="line">  <span class="string">&#x27;慢查询保存方式&#x27;</span> </span><br><span class="line"><span class="keyword">UNION</span>  </span><br><span class="line"><span class="keyword">SELECT</span>  </span><br><span class="line">  <span class="string">&#x27;slow_query_log_file&#x27;</span>, </span><br><span class="line">  @<span class="variable">@slow</span>_query_log_file, <span class="string">&#x27;慢查询日志文件&#x27;</span> </span><br><span class="line"><span class="keyword">UNION</span>  </span><br><span class="line"><span class="keyword">SELECT</span>  </span><br><span class="line">  <span class="string">&#x27;log_queries_not_using_indexes&#x27;</span>, </span><br><span class="line">  @<span class="variable">@log</span>_queries_not_using_indexes, </span><br><span class="line">  <span class="string">&#x27;未使用索引查询是否记录&#x27;</span> </span><br><span class="line"><span class="keyword">UNION</span>  </span><br><span class="line"><span class="keyword">SELECT</span>  </span><br><span class="line">  <span class="string">&#x27;log_slow_admin_statements&#x27;</span>, </span><br><span class="line">  @<span class="variable">@log</span>_slow_admin_statements, </span><br><span class="line">  <span class="string">&#x27;是否将慢管理语句包含例如analyze&#x27;</span>;</span><br></pre></td></tr></table></figure><p>执行结果</p><div class="table-container"><table><thead><tr><th>parameter</th><th>value</th><th>info</th></tr></thead><tbody><tr><td>slow_query_log</td><td>1</td><td>慢查询日志开启状态</td></tr><tr><td>long_query_time</td><td>0.1</td><td>慢查询阈值</td></tr><tr><td>log_output</td><td>TABLE</td><td>慢查询保存方式</td></tr><tr><td>slow_query_log_file</td><td>dataslow.log</td><td>慢查询日志文件</td></tr><tr><td>log_queries_not_using_indexes</td><td>1</td><td>未使用索引查询是否记录</td></tr><tr><td>log_slow_admin_statements</td><td>1</td><td>是否将慢管理语句包含例如analyze</td></tr></tbody></table></div><h2 id="开启慢查询Table方式"><a href="#开启慢查询Table方式" class="headerlink" title="开启慢查询Table方式"></a>开启慢查询Table方式</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%log%&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> log_output<span class="operator">=</span><span class="string">&#x27;TABLE&#x27;</span>;</span><br><span class="line"><span class="keyword">desc</span> slow_log;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@MySQL-01 11:43:  [(none)]&gt; show variables like <span class="string">&#x27;log_output&#x27;</span>;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| log_output    | FILE  |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:43:  [(none)]&gt; <span class="built_in">set</span> global log_output=<span class="string">&#x27;TABLE&#x27;</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:44:  [(none)]&gt; show variables like <span class="string">&#x27;log_output&#x27;</span>;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| log_output    | TABLE |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:44:  [(none)]&gt; use mysql;</span><br><span class="line">Database changed</span><br><span class="line">root@MySQL-01 11:44:  [mysql]&gt; show tables;</span><br><span class="line">+---------------------------+</span><br><span class="line">| Tables_in_mysql           |</span><br><span class="line">+---------------------------+</span><br><span class="line">| columns_priv              |</span><br><span class="line">| db                        |</span><br><span class="line">| engine_cost               |</span><br><span class="line">| event                     |</span><br><span class="line">| func                      |</span><br><span class="line">| general_log               |</span><br><span class="line">| gtid_executed             |</span><br><span class="line">| help_category             |</span><br><span class="line">| help_keyword              |</span><br><span class="line">| help_relation             |</span><br><span class="line">| help_topic                |</span><br><span class="line">| innodb_index_stats        |</span><br><span class="line">| innodb_table_stats        |</span><br><span class="line">| ndb_binlog_index          |</span><br><span class="line">| plugin                    |</span><br><span class="line">| proc                      |</span><br><span class="line">| procs_priv                |</span><br><span class="line">| proxies_priv              |</span><br><span class="line">| server_cost               |</span><br><span class="line">| servers                   |</span><br><span class="line">| slave_master_info         |</span><br><span class="line">| slave_relay_log_info      |</span><br><span class="line">| slave_worker_info         |</span><br><span class="line">| slow_log                  |</span><br><span class="line">| tables_priv               |</span><br><span class="line">| time_zone                 |</span><br><span class="line">| time_zone_leap_second     |</span><br><span class="line">| time_zone_name            |</span><br><span class="line">| time_zone_transition      |</span><br><span class="line">| time_zone_transition_type |</span><br><span class="line">| user                      |</span><br><span class="line">+---------------------------+</span><br><span class="line">31 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:44:  [mysql]&gt; seledct * from slow_log <span class="built_in">limit</span> 1\G;</span><br><span class="line">ERROR 1064 (42000): You have an error <span class="keyword">in</span> your SQL syntax; check the manual that corresponds to your MySQL server version <span class="keyword">for</span> the right syntax to use near <span class="string">&#x27;seledct * from slow_log limit 1&#x27;</span> at line 1</span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:44:  [mysql]&gt; select * from slow_log <span class="built_in">limit</span> 1\G;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line"></span><br><span class="line">root@MySQL-01 11:44:  [mysql]&gt; desc slow_log</span><br><span class="line">    -&gt; ;</span><br><span class="line">+----------------+---------------------+------+-----+----------------------+--------------------------------+</span><br><span class="line">| Field          | Type                | Null | Key | Default              | Extra                          |</span><br><span class="line">+----------------+---------------------+------+-----+----------------------+--------------------------------+</span><br><span class="line">| start_time     | timestamp(6)        | NO   |     | CURRENT_TIMESTAMP(6) | on update CURRENT_TIMESTAMP(6) |</span><br><span class="line">| user_host      | mediumtext          | NO   |     | NULL                 |                                |</span><br><span class="line">| query_time     | time(6)             | NO   |     | NULL                 |                                |</span><br><span class="line">| lock_time      | time(6)             | NO   |     | NULL                 |                                |</span><br><span class="line">| rows_sent      | int(11)             | NO   |     | NULL                 |                                |</span><br><span class="line">| rows_examined  | int(11)             | NO   |     | NULL                 |                                |</span><br><span class="line">| db             | varchar(512)        | NO   |     | NULL                 |                                |</span><br><span class="line">| last_insert_id | int(11)             | NO   |     | NULL                 |                                |</span><br><span class="line">| insert_id      | int(11)             | NO   |     | NULL                 |                                |</span><br><span class="line">| server_id      | int(10) unsigned    | NO   |     | NULL                 |                                |</span><br><span class="line">| sql_text       | mediumblob          | NO   |     | NULL                 |                                |</span><br><span class="line">| thread_id      | bigint(21) unsigned | NO   |     | NULL                 |                                |</span><br><span class="line">+----------------+---------------------+------+-----+----------------------+--------------------------------+</span><br><span class="line">12 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="设置轮询"><a href="#设置轮询" class="headerlink" title="设置轮询"></a>设置轮询</h2><p>因<code>mysql.slow_log</code>使用的是CSV 存储引擎，不利于查询分析，因此我们每日创建innodb引擎的表并将数据导入新表，并清空日志表。</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> database booboo;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> booboo.`slow_log` (</span><br><span class="line">  `start_time` <span class="type">timestamp</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">6</span>) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>(<span class="number">6</span>),</span><br><span class="line">  `user_host` mediumtext <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `query_time` <span class="type">time</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `lock_time` <span class="type">time</span>(<span class="number">6</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rows_sent` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rows_examined` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `db` <span class="type">varchar</span>(<span class="number">512</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `last_insert_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `insert_id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `server_id` <span class="type">int</span>(<span class="number">10</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `sql_text` mediumblob <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `thread_id` <span class="type">bigint</span>(<span class="number">21</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>innodb <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;Slow log&#x27;</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> booboo.slow_log  <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.slow_log;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> booboo.slow_log <span class="keyword">add</span> index idx_dba(start_time,db,query_time);</span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> mysql.slow_log;</span><br></pre></td></tr></table></figure><p>常用的查询</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> slow_log <span class="keyword">where</span> start_time <span class="operator">&gt;</span> &quot;2020-06-01&quot; <span class="keyword">and</span> db<span class="operator">=</span><span class="string">&#x27;test&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> query_time <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure><h2 id="生产案例"><a href="#生产案例" class="headerlink" title="生产案例"></a>生产案例</h2><blockquote class="note warn"><strong class="note-title">RDS For MySQL 慢查询日志清理</strong><ol><li>目前mysql.slow_log保存了从2017-4月开始到现在的所有慢日志，数据量大</li><li>该表目前无索引</li><li>按照 <code>query_time</code> 查询慢查询非常慢，直接报错</li></ol><p>解决建议：</p><ol><li>阿里工单询问RDS5.7是否有参数控制该表的定期删除，例如只保留7天的慢查询(<code>truncate mysql.slow_log;</code>)</li><li>阿里产品没有现成的配置，则自己写一个定时任务定期清理即可</li></ol></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;默认MySQL慢查询使用FILE记录，为方便数据分析，改为使用Table的方式保存，方便拉取后过滤分析。&lt;/p&gt;
&lt;blockquote class=&quot;note info&quot;&gt;&lt;strong class=&quot;note-title&quot;&gt;MySQL慢查询使用Table方式记录&lt;/st
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="MySQL" scheme="http://www.toberoot.com/tags/MySQL/"/>
    
      <category term="慢查询" scheme="http://www.toberoot.com/tags/%E6%85%A2%E6%9F%A5%E8%AF%A2/"/>
    
  </entry>
  
  <entry>
    <title>MySQL慢查询使用FILE方式记录</title>
    <link href="http://www.toberoot.com/news/2020/06/03/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/06/03/tec-mysql/</id>
    <published>2020-06-02T17:47:33.000Z</published>
    <updated>2022-03-22T03:27:46.518Z</updated>
    
    <content type="html"><![CDATA[<p>mysql 数据库慢查询日志分析是优化数据库性能的重要方式之一，随着时间积累，慢查询日志会变得越来越大，作一个每天自动切割的任务，将脚本放在/etc/logrotate.d/下，步骤如下：</p><blockquote class="note info"><strong class="note-title">刷新慢查询日志的一般步骤</strong><ol><li>查看慢查询日志路径<code>select @@datadir;</code>；</li><li>重命名慢查询日志<code>mv a b</code>；</li><li>登陆数据库<code>flush slow logs;</code></li></ol></blockquote><h2 id="logrotate实现"><a href="#logrotate实现" class="headerlink" title="logrotate实现"></a>logrotate实现</h2><p>修改<code>my.cnf</code>,方便自动轮询日志时候自动加载用户名密码</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">[client]</span><br><span class="line"><span class="keyword">user</span><span class="operator">=</span>root</span><br><span class="line">password<span class="operator">=</span><span class="number">123456</span></span><br><span class="line">socket<span class="operator">=</span><span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span>mysql.sock</span><br></pre></td></tr></table></figure><p>在/etc/logrotate.d/下新建任务</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># vim /etc/logrotate.d/mysql</span></span><br></pre></td></tr></table></figure><p>输入以下内容：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/var/log/mysql/*<span class="built_in">log</span> &#123;</span><br><span class="line">    daily</span><br><span class="line">    rotate 7</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    delaycompress</span><br><span class="line">    create 644 mysql mysql</span><br><span class="line">    postrotate</span><br><span class="line">        MYCNF_FILE=/root/.my.cnf</span><br><span class="line">        MYSQLADMIN=/usr/bin/mysqladmin</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">test</span> -x <span class="variable">$MYSQLADMIN</span> &amp;&amp; <span class="variable">$MYSQLADMIN</span> --defaults-file=<span class="string">&quot;<span class="variable">$MYCNF_FILE</span>&quot;</span> ping &gt;/dev/null</span><br><span class="line">        <span class="keyword">then</span></span><br><span class="line">            <span class="variable">$MYSQLADMIN</span> --defaults-file=<span class="string">&quot;<span class="variable">$MYCNF_FILE</span>&quot;</span> flush-logs</span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重新加载cron配置</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># service crond reload</span></span><br></pre></td></tr></table></figure><p>这样子就新建好了慢查询日志每天分割，保留7天</p><h2 id="crontab实现"><a href="#crontab实现" class="headerlink" title="crontab实现"></a>crontab实现</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">mysql=<span class="string">&#x27;&#x27;</span></span><br><span class="line">user=<span class="string">&#x27;&#x27;</span></span><br><span class="line">password=<span class="string">&#x27;&#x27;</span></span><br><span class="line">ip=<span class="string">&#x27;&#x27;</span></span><br><span class="line">archived_log=slow.`<span class="built_in">date</span> +%Y%m%d%H`.<span class="built_in">log</span></span><br><span class="line">slowlog=`<span class="variable">$mysql</span> -u<span class="variable">$user</span> -p<span class="variable">$password</span> -h<span class="variable">$ip</span> -e<span class="string">&quot;show global variables like &#x27;slow%&#x27;;&quot;</span> 2&gt; /dev/null | grep <span class="string">&#x27;slow_query_log_file&#x27;</span> | awk -F <span class="string">&#x27; &#x27;</span> &#123;<span class="string">&#x27;print $2&#x27;</span>&#125;`</span><br><span class="line">datadir=`mysql -u<span class="variable">$user</span> -p<span class="variable">$password</span>  -e<span class="string">&quot;show global variables like &#x27;data%&#x27;;&quot;</span> 2&gt; /dev/null | grep datadir |  awk -F <span class="string">&#x27; &#x27;</span> &#123;<span class="string">&#x27;print $2&#x27;</span>&#125;`</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$slowlog</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$datadir</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;datadir&#125;</span>/<span class="variable">$&#123;slowlog&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;datadir&#125;</span>/<span class="variable">$&#123;archived_log&#125;</span></span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$&#123;datadir&#125;</span>/<span class="variable">$&#123;slowlog&#125;</span> <span class="variable">$&#123;datadir&#125;</span>/<span class="variable">$&#123;archived_log&#125;</span></span><br><span class="line"><span class="variable">$mysql</span> -u<span class="variable">$user</span> -p<span class="variable">$password</span> -h<span class="variable">$ip</span> -e<span class="string">&quot;flush slow logs&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;归档成功，路径为&quot;</span>&#123;archived_log&#125;</span><br></pre></td></tr></table></figure><p><strong>测试</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@NB-flexgw1:/root]<span class="comment"># bash -x auto_cut_mysqlslowlog.sh</span></span><br><span class="line">+ mysql=mysql</span><br><span class="line">+ user=root</span><br><span class="line">+ password=root</span><br><span class="line">+ ip=localhost</span><br><span class="line">++ <span class="built_in">date</span> +%Y%m%d%H</span><br><span class="line">+ archived_log=slow.2020060211.log</span><br><span class="line">++ mysql -uroot -proot -hlocalhost <span class="string">&#x27;-eshow global variables like &#x27;</span>\<span class="string">&#x27;&#x27;</span>slow%<span class="string">&#x27;\&#x27;</span><span class="string">&#x27;;&#x27;</span></span><br><span class="line">++ grep slow_query_log_file</span><br><span class="line">++ awk -F <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line">+ slowlog=dataslow.log</span><br><span class="line">++ mysql -uroot -proot <span class="string">&#x27;-eshow global variables like &#x27;</span>\<span class="string">&#x27;&#x27;</span>data%<span class="string">&#x27;\&#x27;</span><span class="string">&#x27;;&#x27;</span></span><br><span class="line">++ grep datadir</span><br><span class="line">++ awk -F <span class="string">&#x27; &#x27;</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span></span><br><span class="line">+ datadir=/alidata/mysql/data/</span><br><span class="line">+ <span class="built_in">echo</span> dataslow.log</span><br><span class="line">dataslow.log</span><br><span class="line">+ <span class="built_in">echo</span> /alidata/mysql/data/</span><br><span class="line">/alidata/mysql/data/</span><br><span class="line">+ <span class="built_in">echo</span> /alidata/mysql/data//dataslow.log</span><br><span class="line">/alidata/mysql/data//dataslow.log</span><br><span class="line">+ <span class="built_in">echo</span> /alidata/mysql/data//slow.2020060211.<span class="built_in">log</span></span><br><span class="line">/alidata/mysql/data//slow.2020060211.<span class="built_in">log</span></span><br><span class="line">+ <span class="built_in">mv</span> /alidata/mysql/data//dataslow.log /alidata/mysql/data//slow.2020060211.<span class="built_in">log</span></span><br><span class="line">+ mysql -uroot -proot -hlocalhost <span class="string">&#x27;-eflush slow logs&#x27;</span></span><br><span class="line">mysql: [Warning] Using a password on the <span class="built_in">command</span> line interface can be insecure.</span><br><span class="line">+ <span class="built_in">echo</span> <span class="string">&#x27;归档成功，路径为&#123;archived_log&#125;&#x27;</span></span><br><span class="line">归档成功，路径为&#123;archived_log&#125;</span><br></pre></td></tr></table></figure><p>新的慢日志产生，对系统不会造成影响,查看归档后的日志</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@NB-flexgw1:/root]<span class="comment"># ll /alidata/mysql/data/slow*</span></span><br><span class="line">-rw-r----- 1 mysql mysql 162702214 6月   2 11:40 /alidata/mysql/data/slow.2020060211.<span class="built_in">log</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;mysql 数据库慢查询日志分析是优化数据库性能的重要方式之一，随着时间积累，慢查询日志会变得越来越大，作一个每天自动切割的任务，将脚本放在/etc/logrotate.d/下，步骤如下：&lt;/p&gt;
&lt;blockquote class=&quot;note info&quot;&gt;&lt;strong 
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="MySQL" scheme="http://www.toberoot.com/tags/MySQL/"/>
    
      <category term="慢查询" scheme="http://www.toberoot.com/tags/%E6%85%A2%E6%9F%A5%E8%AF%A2/"/>
    
  </entry>
  
  <entry>
    <title>Oracle11g常用视图</title>
    <link href="http://www.toberoot.com/news/2020/05/29/tec-oracle/"/>
    <id>http://www.toberoot.com/news/2020/05/29/tec-oracle/</id>
    <published>2020-05-28T16:11:33.000Z</published>
    <updated>2022-03-22T03:27:46.518Z</updated>
    
    <content type="html"><![CDATA[<div class="table-container"><table><thead><tr><th>Oracle常用视图</th><th>说明</th></tr></thead><tbody><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_4045.htm#REFRN23442">dba_hist_snapshot</a></td><td>在工作负载存储库中显示有关快照的信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2085.htm">v$osstat</a></td><td>显示来自操作系统的系统利用率统计信息。每个系统统计信息返回一行          <em> PHYSICAL_MEMORY_BYTES:Total number of bytes of physical memory     </em> NUM_CPUS:Number of CPUs or processors available</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1097.htm#REFRN30047">v$database</a></td><td>显示控制文件中有关数据库的信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2002.htm">v$instance</a></td><td>显示当前实例的状态。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_4212.htm">DBA_REGISTRY_HISTORY</a></td><td>提供有关在数据库上执行的升级，降级和重要补丁更新的信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2087.htm#REFRN30176">v$parameter</a>      <a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/initparams017.htm#REFRN10006">AUDIT_TRAIL</a>     <a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/initparams234.htm">SESSIONS</a>      <a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/initparams202.htm#REFRN10175">PROCESSES</a></td><td>显示有关该会话当前有效的初始化参数的信息。         <br/> <em> audit_trail:启用或禁用数据库审核     <br/></em> sessions:指定系统中可以创建的最大会话数。     <br/>* processes:指定可以同时连接到Oracle的最大操作系统用户进程数。它的值应允许所有后台进程，例如锁，作业队列进程和并行执行进程。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1016.htm#REFRN30011">V$ARCHIVED_LOG</a></td><td><code>V$ARCHIVED_LOG</code>显示控制文件中的存档日志信息，包括存档日志名称。成功归档或清除联机重做日志后，将插入归档日志记录（<code>NULL</code>如果清除了日志，则名称列）。如果日志被归档两次，就会出现带有两个相同的归档日志记录<code>THREAD#</code>，<code>SEQUENCE#</code>和<code>FIRST_CHANGE#</code>，但使用不同的名称。从备份集或副本还原存档日志时，以及使用RMAN  <code>COPY</code>命令创建日志副本时，也会插入存档日志记录。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2096.htm#REFRN30180">V$PGASTAT</a></td><td></td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_5081.htm#REFRN23302">dba_users</a></td><td><code>DBA_USERS</code> 描述数据库的所有用户。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_1158.htm#i1583352">DBA_OBJECTS</a></td><td><code>DBA_OBJECTS</code>描述数据库中的所有对象。          <code>V$LOCKED_OBJECT</code>列出系统上每个事务获取的所有锁。它显示哪些会话在什么对象和什么模式下持有DML锁（即TM类型的队列）。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_3016.htm">v$session</a></td><td>显示每个当前会话的会话信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2030.htm#REFRN30125">v$locked_object</a></td><td></td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_3118.htm#REFRN30295">v$undostat</a></td><td>显示统计数据的直方图以显示系统的运行状况。可用的统计信息包括撤消空间消耗，事务并发以及在实例中执行的查询的长度。您可以使用此视图来估计当前工作负载所需的撤消空间量。Oracle使用此视图来调整系统中的撤消使用情况。如果系统处于手动撤消管理模式，则该视图返回NULL值。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2031.htm">v$log</a></td><td>显示控制文件中的日志文件信息。          <strong>STATUS</strong>日志状态：          - <code>UNUSED</code>-在线重做日志从未写入过。这是刚刚添加的重做日志的状态，或者<code>RESETLOGS</code>不是当前重做日志时在之后的状态。     - <code>CURRENT</code>-当前重做日志。这意味着重做日志处于活动状态。重做日志可以打开或关闭。     - <code>ACTIVE</code>-日志处于活动状态，但不是当前日志。崩溃恢复需要它。它可能正在用于块恢复。它可能已存档，也可能未存档。     - <code>CLEARING</code>- <code>ALTER DATABASE CLEAR LOGFILE</code>语句后，日志将重新创建为空日志。清除日志后，状态变为<code>UNUSED</code>。     - <code>CLEARING_CURRENT</code>-当前日志正在清除关闭的线程。如果交换机出现故障，例如I / O错误写入新的日志头，则日志可以保持此状态。     - <code>INACTIVE</code>-实例恢复不再需要日志。它可能正在用于介质恢复。它可能已存档，也可能未存档。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1105.htm">v$dataguard_status</a></td><td>显示最近写入警报日志或服务器进程跟踪文件的消息，这些消息与物理备用数据库或所有备用数据库类型的重做传输服务有关。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2050.htm">V$MANAGED_STANDBY</a></td><td>显示与Data Guard环境中的物理备用数据库有关的某些Oracle Database进程的当前状态信息。实例关闭后，该视图不会继续存在。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1027.htm#REFRN30171">V$ASM_DISKGROUP</a></td><td>V$ASM_DISKGROUP 为节点上的ASM实例发现的每个ASM磁盘组显示一行。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_2125.htm">v$recovery_file_dest</a></td><td>在快速恢复区域中显示有关磁盘配额和当前磁盘使用情况的信息。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_3194.htm#REFRN23076">DBA_FREE_SPACE</a></td><td>描述数据库中所有表空间的使用情况。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_5061.htm">dba_temp_files</a></td><td>DBA_TEMP_FILES 描述数据库中的所有临时文件（临时文件）。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/statviews_5060.htm#REFRN23287">dba_tablespaces</a></td><td>DBA_TABLESPACES 描述数据库中的所有表空间。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_3041.htm">gv$sort_segment</a></td><td>V$SORT_SEGMENT显示有关给定实例中每个排序段的信息。仅在表空间是TEMPORARY类型时更新视图。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_3114.htm">v$transaction</a></td><td>V$TRANSACTION 列出系统中的活动事务。</td></tr><tr><td><a href="https://docs.oracle.com/cd/E11882_01/server.112/e40402/dynviews_1062.htm#REFRN30371">v$backup_set_details</a></td><td>备份信息10g 11g 12c</td></tr></tbody></table></div>]]></content>
    
    <summary type="html">
    
      
      
        &lt;div class=&quot;table-container&quot;&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Oracle常用视图&lt;/th&gt;
&lt;th&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;a href=&quot;https://docs.ora
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Oracle" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Oracle/"/>
    
    
      <category term="oracle11g" scheme="http://www.toberoot.com/tags/oracle11g/"/>
    
  </entry>
  
  <entry>
    <title>如何将数据库技术短视频化？</title>
    <link href="http://www.toberoot.com/news/2020/05/24/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/05/24/tec-mysql/</id>
    <published>2020-05-23T17:47:33.000Z</published>
    <updated>2022-03-22T03:27:46.518Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="技术思考" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/%E6%8A%80%E6%9C%AF%E6%80%9D%E8%80%83/"/>
    
    
      <category term="紧急救援" scheme="http://www.toberoot.com/tags/%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4/"/>
    
      <category term="mysqlbinlog" scheme="http://www.toberoot.com/tags/mysqlbinlog/"/>
    
  </entry>
  
  <entry>
    <title>mysqlbinlog远程拉日志</title>
    <link href="http://www.toberoot.com/news/2020/05/22/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/05/22/tec-mysql/</id>
    <published>2020-05-21T17:47:33.000Z</published>
    <updated>2022-03-22T03:27:46.517Z</updated>
    
    <content type="html"><![CDATA[<h2 id="获取远程MySQL服务器的binlog日志"><a href="#获取远程MySQL服务器的binlog日志" class="headerlink" title="获取远程MySQL服务器的binlog日志"></a>获取远程MySQL服务器的binlog日志</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">--row格式的日志</span><br><span class="line">mysqlbinlog -vv -P 3306 -uxxxx -pxxxx -hxxxx.mysql.rds.aliyuncs.com --read-from-remote-server --start-datetime=&#x27;2020-05-20 09:00:00&#x27; --stop-datetime=&#x27;2020-05-20 11:00:00&#x27; --base64-output=DECODE-ROWS mysql-bin.000xxx &gt; xxxlog.sql</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;获取远程MySQL服务器的binlog日志&quot;&gt;&lt;a href=&quot;#获取远程MySQL服务器的binlog日志&quot; class=&quot;headerlink&quot; title=&quot;获取远程MySQL服务器的binlog日志&quot;&gt;&lt;/a&gt;获取远程MySQL服务器的binlog日志&lt;/
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="紧急救援" scheme="http://www.toberoot.com/tags/%E7%B4%A7%E6%80%A5%E6%95%91%E6%8F%B4/"/>
    
      <category term="mysqlbinlog" scheme="http://www.toberoot.com/tags/mysqlbinlog/"/>
    
  </entry>
  
  <entry>
    <title>rsync + inotify 实现实时同步</title>
    <link href="http://www.toberoot.com/news/2020/05/20/tec-linux/"/>
    <id>http://www.toberoot.com/news/2020/05/20/tec-linux/</id>
    <published>2020-05-20T11:03:00.000Z</published>
    <updated>2022-03-22T03:27:46.498Z</updated>
    
    <content type="html"><![CDATA[<!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --><ul><li><a href="#rsync介绍">rsync介绍</a>   <ul><li><a href="#rsync六种命令格式">RSYNC六种命令格式</a>   </li><li><a href="#rsync安装">RSYNC安装</a>   </li><li><a href="#rsync案例">RSYNC案例</a>   </li><li><a href="#rsync参数">RSYNC参数</a>   </li></ul></li><li><a href="#应用场景-linux系统下实现文件实时同步">应用场景-Linux系统下实现文件实时同步</a>   <ul><li><a href="#server端配置">Server端配置</a>   <ul><li><a href="#环境介绍">环境介绍</a>   </li><li><a href="#安装方式">安装方式</a>   </li><li><a href="#配置">配置</a>   </li><li><a href="#编写主配置文件-rsyncdconf">编写主配置文件 rsyncd.conf</a>   </li><li><a href="#编写用户认证文件">编写用户认证文件</a>   </li><li><a href="#启动服务">启动服务</a>   </li></ul></li><li><a href="#rsync客户端">rsync客户端</a>   <ul><li><a href="#安装方式">安装方式</a>   </li><li><a href="#验证">验证</a>   </li></ul></li><li><a href="#使用">使用</a>   <ul><li><a href="#检测创建事件">检测创建事件</a>   </li><li><a href="#检测删除事件">检测删除事件</a>   </li><li><a href="#编写实时同步脚本">编写实时同步脚本</a>   </li></ul></li><li><a href="#验证">验证</a>   </li></ul></li></ul><!-- /MDTOC --><h2 id="rsync介绍"><a href="#rsync介绍" class="headerlink" title="rsync介绍"></a>rsync介绍</h2><p>rsync，remote synchronize顾名思意就知道它是一款实现远程同步功能的软件，它在同步文件的同时，可以保持原来文件的权限、时间、软硬链接等附加信息。 rsync是用 “rsync 算法”提供了一个客户机和远程文件服务器的文件同步的快速方法，而且可以通过ssh方式来传输文件，这样其保密性也非常好，另外它还是免费的软件。</p><h3 id="RSYNC六种命令格式"><a href="#RSYNC六种命令格式" class="headerlink" title="RSYNC六种命令格式"></a>RSYNC六种命令格式</h3><p>Rsync的命令格式可以为以下六种：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync [OPTION]... SRC DEST</span><br><span class="line">　　rsync [OPTION]... SRC [USER@]HOST:DEST</span><br><span class="line">　　rsync [OPTION]... [USER@]HOST:SRC DEST</span><br><span class="line">　　rsync [OPTION]... [USER@]HOST::SRC DEST</span><br><span class="line">　　rsync [OPTION]... SRC [USER@]HOST::DEST</span><br><span class="line">　　rsync [OPTION]... rsync://[USER@]HOST[:PORT]/SRC [DEST]</span><br></pre></td></tr></table></figure><p>对应于以上六种命令格式，rsync有六种不同的工作模式：</p><ul><li>拷贝本地文件。当SRC和DES路径信息都不包含有单个冒号”:”分隔符时就启动这种工作模式。如：rsync -a /data /backup</li><li>使用一个远程shell程序(如rsh、ssh)来实现将本地机器的内容拷贝到远程机器。当DST路径地址包含单个冒号”:”分隔符时启动该模式。如：rsync -avz *.c foo:src</li><li>使用一个远程shell程序(如rsh、ssh)来实现将远程机器的内容拷贝到本地机器。当SRC地址路径包含单个冒号”:”分隔符时启动该模式。如：rsync -avz foo:src/bar /data</li><li>从远程rsync服务器中拷贝文件到本地机。当SRC路径信息包含”::”分隔符时启动该模式。如：rsync -av root@172.16.78.192::www /databack</li><li>从本地机器拷贝文件到远程rsync服务器中。当DST路径信息包含”::”分隔符时启动该模式。如：rsync -av /databack root@172.16.78.192::www</li><li>列远程机的文件列表。这类似于rsync传输，不过只要在命令中省略掉本地机信息即可。如：rsync -v rsync://172.16.78.192/www</li></ul><h3 id="RSYNC安装"><a href="#RSYNC安装" class="headerlink" title="RSYNC安装"></a>RSYNC安装</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#注：在debian、ubuntu 等在线安装方法；</span></span><br><span class="line">sudo apt-get install rsync</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#注：Fedora、Redhat 等在线安装方法；</span></span><br><span class="line">yum install rsync</span><br><span class="line"></span><br><span class="line"><span class="comment">#注：Fedora、Redhat 等rpm包安装方法；</span></span><br><span class="line">rpm -ivh rsync</span><br></pre></td></tr></table></figure><h3 id="RSYNC案例"><a href="#RSYNC案例" class="headerlink" title="RSYNC案例"></a>RSYNC案例</h3><p>在我们内部跳板机1：杭州节点（主）中，对应在“/etc/ssh/ssh_config.d”中配置了每个项目的ssh快捷登陆，所以后续我们只需要“ssh &lt;主机名&gt;”便能登陆到对应的目标服务器中。<br>但这里有个问题，我们在杭州节点（主）中，对应变更了“/etc/ssh/ssh_config.d”的配置，那其他跳板机怎么样同步更新呢？其实这里我们采用了rsync的方式来同步配置文件。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># rsync server配置</span></span><br><span class="line"><span class="comment"># 1.在内部跳板机1：杭州节点（主：srv-zy-ssh1）上，编辑配置文件/etc/rsyncd.conf</span></span><br><span class="line">uid=root</span><br><span class="line">git=root</span><br><span class="line">use <span class="built_in">chroot</span>=no</span><br><span class="line">max connection=0</span><br><span class="line">port=873</span><br><span class="line">pid file=/var/log/rsync/rsyncd.pid</span><br><span class="line">lock file=/var/log/rsync/rsync.lock</span><br><span class="line"><span class="built_in">log</span> file=/var/log/rsync/rsyncd.log</span><br><span class="line">motd file=/var/log/rsync/rsyncd.motd</span><br><span class="line">strict modes=<span class="built_in">yes</span></span><br><span class="line">[sshconfig]</span><br><span class="line">uid=root</span><br><span class="line">git=root</span><br><span class="line">path=/etc/ssh/ssh_config.d/</span><br><span class="line">comment=rsync ssh_config</span><br><span class="line"><span class="built_in">read</span> only=<span class="literal">false</span></span><br><span class="line">list=<span class="literal">false</span></span><br><span class="line">host allow=ip1 ip2 ip3</span><br><span class="line"><span class="comment">#hosts deny=172.25.0.0/24</span></span><br><span class="line">auth <span class="built_in">users</span>=sshconfig</span><br><span class="line">secrets file=/etc/rsyncd.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.编辑/etc/rsyncd.passwd 文件加入以下内容</span></span><br><span class="line">sshconfig:rsync20150128</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.赋权（必须600权限，否则报错）</span></span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/rsyncd.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.启动rsync</span></span><br><span class="line">rsync --daemon /etc/rsyncd.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># rsync cilent配置</span></span><br><span class="line">分别在其他跳板机上面：</span><br><span class="line">内部跳板机2：青岛节点（备：srv-zy-ssh2）</span><br><span class="line">客户跳板机1：杭州节点（主：srv-zy-ssh3）</span><br><span class="line">客户跳板机2：青岛节点（备：srv-zy-ssh4）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编辑/etc/rsyncd.passwd 文件加入以下内容：</span></span><br><span class="line">sshconfig:rsync20150128</span><br><span class="line"></span><br><span class="line"><span class="comment"># 赋权（必须600权限，否则报错）:</span></span><br><span class="line"><span class="built_in">chmod</span> 600 /etc/rsyncd.passwd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行同步命令：</span></span><br><span class="line">rsync -vzrtopg --delete --progress sshconfig@115.29.244.224::sshconfig /etc/ssh/ssh_config.d/ --password-file=/etc/rsyncd.passwd</span><br><span class="line">或者：</span><br><span class="line">rsync -avz --delete --progress sshconfig@115.29.244.224::sshconfig /etc/ssh/ssh_config.d/ --password-file=/etc/rsyncd.passwd</span><br></pre></td></tr></table></figure><h3 id="RSYNC参数"><a href="#RSYNC参数" class="headerlink" title="RSYNC参数"></a>RSYNC参数</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync参数的具体解释如下：</span><br><span class="line">-v, --verbose 详细模式输出</span><br><span class="line">-q, --quiet 精简输出模式</span><br><span class="line">-c, --checksum 打开校验开关，强制对文件传输进行校验</span><br><span class="line">-a, --archive 归档模式，表示以递归方式传输文件，并保持所有文件属性，等于-rlptgoD</span><br><span class="line">-r, --recursive 对子目录以递归模式处理</span><br><span class="line">-R, --relative 使用相对路径信息</span><br><span class="line">-b, --backup 创建备份，也就是对于目的已经存在有同样的文件名时，将老的文件重新命名为~filename。可以使用--suffix选项来指定不同的备份文件前缀。</span><br><span class="line">--backup-dir 将备份文件(如~filename)存放在在目录下。</span><br><span class="line">-suffix=SUFFIX 定义备份文件前缀</span><br><span class="line">-u, --update 仅仅进行更新，也就是跳过所有已经存在于DST，并且文件时间晚于要备份的文件。(不覆盖更新的文件)</span><br><span class="line">-l, --links 保留软链结</span><br><span class="line">-L, --copy-links 想对待常规文件一样处理软链结</span><br><span class="line">--copy-unsafe-links 仅仅拷贝指向SRC路径目录树以外的链结</span><br><span class="line">--safe-links 忽略指向SRC路径目录树以外的链结</span><br><span class="line">-H, --hard-links 保留硬链结 -p, --perms 保持文件权限</span><br><span class="line">-o, --owner 保持文件属主信息 -g, --group 保持文件属组信息</span><br><span class="line">-D, --devices 保持设备文件信息 -t, --<span class="built_in">times</span> 保持文件时间信息</span><br><span class="line">-S, --sparse 对稀疏文件进行特殊处理以节省DST的空间</span><br><span class="line">-n, --dry-run现实哪些文件将被传输</span><br><span class="line">-W, --whole-file 拷贝文件，不进行增量检测</span><br><span class="line">-x, --one-file-system 不要跨越文件系统边界</span><br><span class="line">-B, --block-size=SIZE 检验算法使用的块尺寸，默认是700字节</span><br><span class="line">-e, --rsh=COMMAND 指定使用rsh、ssh方式进行数据同步</span><br><span class="line">--rsync-path=PATH 指定远程服务器上的rsync命令所在路径信息</span><br><span class="line">-C, --cvs-exclude 使用和CVS一样的方法自动忽略文件，用来排除那些不希望传输的文件</span><br><span class="line">--existing 仅仅更新那些已经存在于DST的文件，而不备份那些新创建的文件</span><br><span class="line">--delete 删除那些DST中SRC没有的文件</span><br><span class="line">--delete-excluded 同样删除接收端那些被该选项指定排除的文件</span><br><span class="line">--delete-after 传输结束以后再删除</span><br><span class="line">--ignore-errors 及时出现IO错误也进行删除</span><br><span class="line">--max-delete=NUM 最多删除NUM个文件</span><br><span class="line">--partial 保留那些因故没有完全传输的文件，以是加快随后的再次传输</span><br><span class="line">--force 强制删除目录，即使不为空</span><br><span class="line">--numeric-ids 不将数字的用户和组ID匹配为用户名和组名</span><br><span class="line">--<span class="built_in">timeout</span>=TIME IP超时时间，单位为秒</span><br><span class="line">-I, --ignore-times 不跳过那些有同样的时间和长度的文件</span><br><span class="line">--size-only 当决定是否要备份文件时，仅仅察看文件大小而不考虑文件时间</span><br><span class="line">--modify-window=NUM 决定文件是否时间相同时使用的时间戳窗口，默认为0</span><br><span class="line">-T --temp-dir=DIR 在DIR中创建临时文件</span><br><span class="line">--compare-dest=DIR 同样比较DIR中的文件来决定是否需要备份</span><br><span class="line">-P 等同于 --partial</span><br><span class="line">--progress 显示备份过程</span><br><span class="line">-z, --compress 对备份的文件在传输时进行压缩处理</span><br><span class="line">--exclude=PATTERN 指定排除不需要传输的文件模式</span><br><span class="line">--include=PATTERN 指定不排除而需要传输的文件模式</span><br><span class="line">--exclude-from=FILE 排除FILE中指定模式的文件</span><br><span class="line">--include-from=FILE 不排除FILE指定模式匹配的文件</span><br><span class="line">--version 打印版本信息</span><br><span class="line">--address 绑定到特定的地址</span><br><span class="line">--config=FILE 指定其他的配置文件，不使用默认的rsyncd.conf文件</span><br><span class="line">--port=PORT 指定其他的rsync服务端口</span><br><span class="line">--blocking-io 对远程shell使用阻塞IO</span><br><span class="line">-stats 给出某些文件的传输状态</span><br><span class="line">--progress 在传输时现实传输过程</span><br><span class="line">--log-format=formAT 指定日志文件格式</span><br><span class="line">--password-file=FILE 从FILE中得到密码</span><br><span class="line">--bwlimit=KBPS 限制I/O带宽，KBytes per second</span><br><span class="line">-h, --<span class="built_in">help</span> 显示帮助信息</span><br></pre></td></tr></table></figure><h2 id="应用场景-Linux系统下实现文件实时同步"><a href="#应用场景-Linux系统下实现文件实时同步" class="headerlink" title="应用场景-Linux系统下实现文件实时同步"></a>应用场景-Linux系统下实现文件实时同步</h2><p>在我们的日常场景中经常会经常碰到文件共享同步的问题，比如：</p><ul><li>集群，提供高可用服务（需要网站代码或者目录实时同步，保证数据的一致性）</li><li>迁移数据 (实时增量传输)</li><li>文件备份（实时将数据备份到其他设备，防止数据丢失）</li></ul><p>我们针对以上场景在 Linux 系统下实现文件实时同步</p><h3 id="Server端配置"><a href="#Server端配置" class="headerlink" title="Server端配置"></a>Server端配置</h3><h4 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h4><p>修改：调整了目录顺序</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">操作系统：CentOS 6.8 rsync: rsync-3.0.6 (yum 源默认安装)</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/01.png" alt=""></p><h4 id="安装方式"><a href="#安装方式" class="headerlink" title="安装方式"></a>安装方式</h4><p>安装方式</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudoapt-get ``installrsync#debian、ubuntu 等在线安装方法；``yum ``installrsync#Fedora、Redhat 等在线安装方法；``rpm -ivh ``rsync# Fedora、Redhat 等rpm包安装方法；``rpm -qa | ``greprsync# 查看安装的版本</span><br></pre></td></tr></table></figure><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>修改： 文件名缺少“d” 字符</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">chmod 600 /etc/rsync.d/rsyncd.conf</span><br><span class="line">chmod 600 /etc/rsync.d/rsyncd.pass</span><br></pre></td></tr></table></figure><p>创建相关配置目录和文件</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir-p ``/etc/rsync``.d  ``# rsync 配置文件目录，默认没有touch/etc/rsync``.d``/rsyncd``.conf ``# rsync服务端配置文件touch/etc/rsync``.d``/rsyncd``.pass ``# 客户端拉取文件时使用的用户密码chmod600 ``/etc/rsync``.d``/rsyncd``.confchmod600 ``/etc/rsync``.d``/rsyncd``.pass</span><br></pre></td></tr></table></figure><h4 id="编写主配置文件-rsyncd-conf"><a href="#编写主配置文件-rsyncd-conf" class="headerlink" title="编写主配置文件 rsyncd.conf"></a>编写主配置文件 rsyncd.conf</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim ``/etc/rsync``.d``/rsyncd``.conf</span><br></pre></td></tr></table></figure><p>（以下是配置文件）</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">log</span> file=/var/log/rsyncd.log</span><br><span class="line"></span><br><span class="line">pid file=/var/run/rsyncd.pid</span><br><span class="line"></span><br><span class="line">lock file=/var/run/rsyncd.lock</span><br><span class="line"></span><br><span class="line">motd file = /etc/rsyncd/rsyncd.motd</span><br><span class="line"></span><br><span class="line">uid=root</span><br><span class="line"></span><br><span class="line">gid=root</span><br><span class="line"></span><br><span class="line">max connections=5</span><br><span class="line"></span><br><span class="line">hosts allow=192.168.1.167 <span class="comment"># 允许访问的IP地址，我这里填写的是测试的客户端地址</span></span><br><span class="line"></span><br><span class="line">hosts deny=*</span><br><span class="line"></span><br><span class="line">secrets file = /etc/rsync.d/rsyncd.pass</span><br><span class="line"></span><br><span class="line"><span class="built_in">log</span> = /var/log/rsyncd.log l</span><br><span class="line"></span><br><span class="line">og format = %t %a %m %f %b</span><br><span class="line"></span><br><span class="line">syslog facility = local3 <span class="built_in">timeout</span> = 300</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[handbook]</span><br><span class="line"></span><br><span class="line">path=/handbook/</span><br><span class="line"></span><br><span class="line">comment= handbook</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> auth <span class="built_in">users</span>=rsync</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/02.png" alt=""></p><p>详细参数可参考官网 <a href="https://download.samba.org/pub/rsync/rsyncd.conf.html">rsyncd.conf 介绍 </a></p><h4 id="编写用户认证文件"><a href="#编写用户认证文件" class="headerlink" title="编写用户认证文件"></a>编写用户认证文件</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/rsync.d/rsyncd.pass</span><br></pre></td></tr></table></figure><p>修改：将代码模式去除，并添加文字描述</p><p>输入以下内容：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync:cloudcare</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/03.png" alt=""></p><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync --daemon --config=/etc/rsync.d/rsyncd.conf</span><br></pre></td></tr></table></figure><p>修改： 添加了“确认服务启动” 标题，以及相关命令; 将 “注：rsync 服务默认端口是 873” 前移  确认服务启动</p><p>注：rsync 服务默认端口是 873</p><p>确认服务启动</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef | greprsyncnetstat-nltp | grep7589</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/04.png" alt=""></p><h3 id="rsync客户端"><a href="#rsync客户端" class="headerlink" title="rsync客户端"></a>rsync客户端</h3><p>客户端配置很简单，只需要安装 <code>rsync</code> 工具即可</p><h4 id="安装方式-1"><a href="#安装方式-1" class="headerlink" title="安装方式"></a>安装方式</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># debian、ubuntu 等在线安装方法；</span></span><br><span class="line">sudo apt-get install rsync</span><br><span class="line"><span class="comment"># Fedora、Redhat 等在线安装方法；</span></span><br><span class="line">yum install rsync</span><br><span class="line"><span class="comment"># Fedora、Redhat 等rpm包安装方法；</span></span><br><span class="line">rpm -ivh rsync</span><br><span class="line"><span class="comment"># 查看安装的版本</span></span><br><span class="line">rpm -qa | greprsync</span><br></pre></td></tr></table></figure><h4 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h4><p>修改：添加了“示例内容”</p><p>示例： 将192.168.1.176 服务器上的 handbook （这里是定义的项目名称，可以参考rsync server 端的配置）项目同步到 192.168.1.167 的 /tmp 下</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rsync -avzP ``rsync``@192.168.1.176::handbook ``/tmp</span><br></pre></td></tr></table></figure><p>说明：<br>-a 参数，相当于-rlptgoD，<br>-r 是递归 -l 是链接文件，意思是拷贝链接文件；<br>-p 表示保持文件原有权限；<br>-t 保持文件原有时间；<br>-g 保持文件原有用户组；<br>-o 保持文件原有属主；<br>-D 相当于块设备文件；<br>-z 传输时压缩；<br>-P 传输进度；<br>-v 传输时的进度等信息<br><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![](2020-05-20-tec-linux/05.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">详细参数可以参考: [RSYNC 参数 ](https://confluence.jiagouyun.com/pages/viewpage.action?pageId=15503070)</span><br><span class="line"></span><br><span class="line">如果想每隔一段时间同步一次，可以配合 crontab 来实现；但是如果想实时同步，那就需要用到inotify 工具了</span><br><span class="line"></span><br><span class="line">## inotify</span><br><span class="line"></span><br><span class="line">&gt; inotify是Linux核心子系统之一，做为文件系统的附加功能，它可监控文件系统并将异动通知应用程序。摘自[维基百科](https://zh.wikipedia.org/wiki/Inotify) 可以配合rsync做实时同步，inotify 通过监控文件的变化，然后触发同步脚本，实现实时同步。</span><br><span class="line"></span><br><span class="line">### 修改添加了“实验目地” 和“拓扑环境” 两个项目</span><br><span class="line"></span><br><span class="line">### 实验目的</span><br><span class="line"></span><br><span class="line">将 192.168.1.167 的 /handbook 目录下的内容实时同步到 192.168.1.176 定义的 “handbook” 目录下（实验环境依旧采用上面的老环境）</span><br><span class="line"></span><br><span class="line">### 拓扑环境</span><br><span class="line"></span><br><span class="line">![](2020-05-20-tec-linux/06.png)</span><br><span class="line"></span><br><span class="line">### 安装</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">yum install-y inotify-tools</span><br></pre></td></tr></table></figure></p><p>注：inotify 其实不需要任何的配置，安装好之后默认有两个命令;</p><blockquote><p>inotifywait : 在被监控的文件或目录上等待特定文件系统事件（open close delete等）发生</p><p>inotifywatch :收集被监控的文件系统使用的统计数据,指文件系统事件发生的次数统计</p></blockquote><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><h4 id="检测创建事件"><a href="#检测创建事件" class="headerlink" title="检测创建事件"></a>检测创建事件</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">inotifywait -mrq ``/handbook/cd/handbook/touch1</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/07.png" alt=""></p><h4 id="检测删除事件"><a href="#检测删除事件" class="headerlink" title="检测删除事件"></a>检测删除事件</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">inotifywait -mrq /handbook --timefmt &quot;%d-%m-%y %H:%M&quot; --format &quot;%T %w%f 事 件 息: %e&quot; -e delete cd /handbook/ rm -rf 1 4</span><br></pre></td></tr></table></figure><p><img src="2020-05-20-tec-linux/08.png" alt=""></p><h4 id="编写实时同步脚本"><a href="#编写实时同步脚本" class="headerlink" title="编写实时同步脚本"></a>编写实时同步脚本</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">more rsync-handbook.sh</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">inotifywait -mrq /handbook/ --format &quot;%w%f&quot; -e create,delete,moved_to,close_write | while read line do rsync -az /handbook/ rsync@192.168.1.176::handbook --password-file=/root/handbook.pw done</span><br></pre></td></tr></table></figure><p><em>注： 其中—password-file 是指定 <code>handbook</code>模块认用户认证的密码文件</em></p><h3 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h3><p><img src="2020-05-20-tec-linux/09.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#rsync介绍&quot;&gt;rsync介绍&lt;/a&gt;   &lt;ul&gt;
&lt;li&gt;&lt;a hre
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Linux" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.toberoot.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>记一次grep命令常用方法带文件名和行数</title>
    <link href="http://www.toberoot.com/news/2020/05/19/tec-linux/"/>
    <id>http://www.toberoot.com/news/2020/05/19/tec-linux/</id>
    <published>2020-05-19T10:24:00.000Z</published>
    <updated>2022-03-22T03:27:46.498Z</updated>
    
    <content type="html"><![CDATA[<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>找到指定目录中的所有文件中包含字符<code>nav-item dropdown</code>的文件和行数。</p><h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for i in $(find `pwd` -type f); do grep -H -n &quot;2020-05-19&quot; $i; done 2&gt; /dev/null</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;需求&quot;&gt;&lt;a href=&quot;#需求&quot; class=&quot;headerlink&quot; title=&quot;需求&quot;&gt;&lt;/a&gt;需求&lt;/h2&gt;&lt;p&gt;找到指定目录中的所有文件中包含字符&lt;code&gt;nav-item dropdown&lt;/code&gt;的文件和行数。&lt;/p&gt;
&lt;h2 id=&quot;命令&quot;
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Linux" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.toberoot.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux系统一次性同步时间</title>
    <link href="http://www.toberoot.com/news/2020/05/14/tec-linux/"/>
    <id>http://www.toberoot.com/news/2020/05/14/tec-linux/</id>
    <published>2020-05-13T16:30:00.000Z</published>
    <updated>2022-03-22T03:27:46.497Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>测试服务器物理时间和系统时间都不正确，需要调整</p></blockquote><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装 ntp </span></span><br><span class="line">yum install -y ntp</span><br><span class="line"><span class="comment"># 同步阿里云时间同步服务器</span></span><br><span class="line">ntpdate ntp1.aliyun.com</span><br><span class="line"><span class="comment"># 物理时间同步系统时间</span></span><br><span class="line">hwclock -w</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;测试服务器物理时间和系统时间都不正确，需要调整&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;步骤&quot;&gt;&lt;a href=&quot;#步骤&quot; class=&quot;headerlink&quot; title=&quot;步骤&quot;&gt;&lt;/a&gt;步骤&lt;/h2&gt;&lt;figure class=&quot;
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="Linux" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/Linux/"/>
    
    
      <category term="CentOS" scheme="http://www.toberoot.com/tags/CentOS/"/>
    
      <category term="ntp" scheme="http://www.toberoot.com/tags/ntp/"/>
    
  </entry>
  
  <entry>
    <title>制作RedHat教学系统装机U盘</title>
    <link href="http://www.toberoot.com/news/2020/05/13/tec-redhat/"/>
    <id>http://www.toberoot.com/news/2020/05/13/tec-redhat/</id>
    <published>2020-05-13T15:33:00.000Z</published>
    <updated>2022-03-22T03:27:46.497Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>红帽官方教学系统</p></blockquote><h2 id="格式化u盘"><a href="#格式化u盘" class="headerlink" title="格式化u盘"></a>格式化u盘</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@foundation0 ~]# mount |tail -n 1</span><br><span class="line">/dev/sdb1 on /run/media/kiosk/U type vfat (rw,nosuid,nodev,relatime,uid=1000,gid=1000,fmask=0022,dmask=0077,codepage=437,iocharset=ascii,shortname=mixed,showexec,utf8,flush,errors=remount-ro,uhelper=udisks2)</span><br><span class="line">[root@foundation0 ~]# umount /dev/sdb1</span><br><span class="line">[root@foundation0 ~]# partprobe /dev/sdb1</span><br><span class="line">[root@foundation0 ~]# mkfs.ext4 /dev/sdb1</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS type: Linux</span><br><span class="line">Block size=4096 (log=2)</span><br><span class="line">Fragment size=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">932064 inodes, 3722784 blocks</span><br><span class="line">186139 blocks (5.00%) reserved for the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=2151677952</span><br><span class="line">114 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8176 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208</span><br><span class="line"></span><br><span class="line">Allocating group tables: done                            </span><br><span class="line">Writing inode tables: done                            </span><br><span class="line">Creating journal (32768 blocks): done</span><br><span class="line">Writing superblocks and filesystem accounting information: done</span><br></pre></td></tr></table></figure><h2 id="制作u盘启动"><a href="#制作u盘启动" class="headerlink" title="制作u盘启动"></a>制作u盘启动</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@foundation0 ~]# rht-usb usbformat /dev/sdb1</span><br><span class="line">INFO     Configuration file: /root/.icrm/config.yml</span><br><span class="line">INFO     Formatting USB Device: /dev/sdb1</span><br><span class="line">Confirm reformatting /dev/sdb1 (y/N) y</span><br><span class="line">INFO     mkfs.ext4 64-bit support</span><br><span class="line">INFO     /dev/sdb1: format OK</span><br><span class="line">INFO     Appear to have properly formatted USB device.</span><br><span class="line"></span><br><span class="line">[root@foundation0 ~]# cd /home/kiosk/booboo/cache</span><br><span class="line">[root@foundation0 cache]# ll</span><br><span class="line">total 4038772</span><br><span class="line">-rw------- 1 kiosk kiosk      27967 Mar  3  2016 ClassPrep-7.x-4.r35344.txt</span><br><span class="line">-rw------- 1 kiosk kiosk      16186 Mar  3  2016 ClassroomReset-7.x-4.r35344.txt</span><br><span class="line">-rw------- 1 kiosk kiosk      38605 Mar  3  2016 ClassroomSetup-7.x-4.r35344.txt</span><br><span class="line">-rw------- 1 kiosk kiosk      27054 Mar  3  2016 ClassroomTroubleshooting-7.x-4.r35344.txt</span><br><span class="line">-rw------- 1 kiosk kiosk      75892 Mar  3  2016 foundation0-config-7.x-4.r35344.noarch.rpm</span><br><span class="line">-rw------- 1 kiosk kiosk      27568 Mar  3  2016 foundation-config-7.x-4.r35344.noarch.rpm</span><br><span class="line">-rw------- 1 kiosk kiosk     189984 Mar  3  2016 redhat-survey-7.x-55.1.noarch.rpm</span><br><span class="line">-rw------- 1 kiosk kiosk   91254784 Mar  4  2016 rhci-foundation-7.2-4.r35344.iso</span><br><span class="line">-rw------- 1 kiosk kiosk       2775 May  9 11:02 RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">-rw------- 1 kiosk kiosk     621805 Oct 20  2014 RHEL7和CentOS7打开屏幕VNC.pdf</span><br><span class="line">-rw------- 1 kiosk kiosk 4043309056 Mar  4  2016 rhel-server-7.2-x86_64-dvd.iso</span><br><span class="line">-rw------- 1 kiosk kiosk      96050 Mar  3  2016 rht-usb-7.x-4.r35344</span><br><span class="line"></span><br><span class="line">[root@foundation0 cache]# vim /root/.icrm/config.yml</span><br><span class="line">---</span><br><span class="line">repository: /root/.icrm/repository</span><br><span class="line">repository: /home/kiosk/booboo/cache</span><br><span class="line"></span><br><span class="line">[root@foundation0 cache]# rht-usb verify *.icmf</span><br><span class="line">INFO     Configuration file: /root/.icrm/config.yml</span><br><span class="line">INFO     Verifying Cache Directory: /home/kiosk/booboo/cache</span><br><span class="line"></span><br><span class="line">Verifying manifest file RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">  Publish date: 2016-02-24 20:43:25</span><br><span class="line">  type        md5sum  artifact-name</span><br><span class="line">  ----------- ------- -----------------------------------------------</span><br><span class="line">  content     CORRUPT rhel-server-7.2-x86_64-dvd.iso</span><br><span class="line">  content     GOODSUM foundation-config-7.x-4.r35344.noarch.rpm</span><br><span class="line">  content     GOODSUM foundation0-config-7.x-4.r35344.noarch.rpm</span><br><span class="line">  content     GOODSUM redhat-survey-7.x-55.1.noarch.rpm</span><br><span class="line">  content     GOODSUM rhci-foundation-7.2-4.r35344.iso</span><br><span class="line">  content     GOODSUM rht-usb-7.x-4.r35344</span><br><span class="line">  content     GOODSUM ClassroomSetup-7.x-4.r35344.txt</span><br><span class="line">  content     GOODSUM ClassroomReset-7.x-4.r35344.txt</span><br><span class="line">  content     GOODSUM ClassroomTroubleshooting-7.x-4.r35344.txt</span><br><span class="line">  content     GOODSUM ClassPrep-7.x-4.r35344.txt</span><br><span class="line">  content     GOODSUM RHEL7和CentOS7打开屏幕VNC.pdf</span><br><span class="line">=====================================================================</span><br><span class="line">WARNING  Manifest RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf failed.</span><br><span class="line"></span><br><span class="line">WARNING  Verification FAILED - look above for problem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@foundation0 cache]# rht-usb usbadd RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">INFO     Configuration file: /root/.icrm/config.yml</span><br><span class="line">INFO     Adding to USB: RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">INFO     New files needed space is 3.9G out of 3.9G</span><br><span class="line">INFO     Calculation finds we need: 4135687726 bytes (3.9G)</span><br><span class="line">INFO     USB space Total: 14.2G  Used: 35.5M  Free: 13.4G</span><br><span class="line">INFO     Starting copy of RHCIfoundation-RHEL72-4.r35344.1-ILT-7-en_US.icmf</span><br><span class="line">INFO     Copying artifact: rhel-server-7.2-x86_64-dvd.iso</span><br><span class="line">INFO     Copying /home/kiosk/booboo/cache/rhel-server-7.2-x86_64-dvd.iso (3.8G) to /tmp/tmpKRYNm9/rhel7.2/x86_64/isos/rhel-server-7.2-x86_64-dvd.iso</span><br><span class="line"></span><br><span class="line">rht-usb usbmkboot</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;红帽官方教学系统&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;格式化u盘&quot;&gt;&lt;a href=&quot;#格式化u盘&quot; class=&quot;headerlink&quot; title=&quot;格式化u盘&quot;&gt;&lt;/a&gt;格式化u盘&lt;/h2&gt;&lt;figure class=&quot;hig
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="RedHat" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/RedHat/"/>
    
    
      <category term="RedHat" scheme="http://www.toberoot.com/tags/RedHat/"/>
    
  </entry>
  
  <entry>
    <title>MySQL8.0.16使用pt-online-schema-change在线添加索引报错处理</title>
    <link href="http://www.toberoot.com/news/2020/05/12/tec-mysql/"/>
    <id>http://www.toberoot.com/news/2020/05/12/tec-mysql/</id>
    <published>2020-05-12T12:59:00.000Z</published>
    <updated>2022-03-22T03:27:46.497Z</updated>
    
    <content type="html"><![CDATA[<!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --><ul><li><a href="#在线mysql80结构变更问题排查">在线MySQL8.0结构变更问题排查</a>   <ul><li><a href="#报错明细">报错明细</a>   </li><li><a href="#解决方法">解决方法</a>   </li><li><a href="#测试环境">测试环境</a>   <ul><li><a href="#mysql测试数据">MySQL测试数据</a>   </li><li><a href="#pt-online-ddl">pt-online-ddl</a>   </li><li><a href="#执行结果">执行结果</a>   </li></ul></li><li><a href="#总结">总结</a>   </li></ul></li></ul><!-- /MDTOC --><h1 id="在线MySQL8-0结构变更问题排查"><a href="#在线MySQL8-0结构变更问题排查" class="headerlink" title="在线MySQL8.0结构变更问题排查"></a>在线MySQL8.0结构变更问题排查</h1><div class="table-container"><table><thead><tr><th style="text-align:left">软件</th><th style="text-align:left">版本</th></tr></thead><tbody><tr><td style="text-align:left">mysql-server</td><td style="text-align:left">8.0.16</td></tr><tr><td style="text-align:left">pt-tools</td><td style="text-align:left">3.2.0</td></tr></tbody></table></div><h2 id="报错明细"><a href="#报错明细" class="headerlink" title="报错明细"></a>报错明细</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@node2 install]<span class="comment"># pt-online-schema-change --port=3306 --host=localhost --user=root --password=xxx --alter=&quot;add index TMS_LEG_IDS (ID,CHANGE_ORG_ID,FROM_RECEIVER_ID,TO_RECEIVER_ID,TO_REGIONZONE_ID)&quot; D=wlyotwb,t=tms_leg_test --no-version-check --execute --charset=utf8</span></span><br><span class="line">No slaves found.  See --recursion-method <span class="keyword">if</span> host node2 has slaves.</span><br><span class="line">Not checking slave lag because no slaves were found and --check-slave-lag was not specified.</span><br><span class="line">Operation, tries, <span class="built_in">wait</span>:</span><br><span class="line">  analyze_table, 10, 1</span><br><span class="line">  copy_rows, 10, 0.25</span><br><span class="line">  create_triggers, 10, 1</span><br><span class="line">  drop_triggers, 10, 1</span><br><span class="line">  swap_tables, 10, 1</span><br><span class="line">  update_foreign_keys, 10, 1</span><br><span class="line">There is an error <span class="keyword">in</span> MySQL that makes the server to die when trying to rename a table with FKs. See https://bugs.mysql.com/bug.php?<span class="built_in">id</span>=96145</span><br><span class="line">Since pt-online-schema change needs to rename the old &lt;-&gt; new tables as the final step, and the requested table has FKs, it cannot be executed under the current MySQL version</span><br></pre></td></tr></table></figure><p><a href="https://jira.percona.com/browse/PT-1782">https://jira.percona.com/browse/PT-1782</a></p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><ul><li>pt-tools软件版本使用 <code>3.0.13</code></li></ul><p>或者</p><ul><li><code>mysql-server</code>版本升级到 <code>8.0.20</code></li></ul><h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><h3 id="MySQL测试数据"><a href="#MySQL测试数据" class="headerlink" title="MySQL测试数据"></a>MySQL测试数据</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> root@<span class="string">&#x27;localhost&#x27;</span> identified <span class="keyword">WITH</span> mysql_native_password <span class="keyword">by</span> <span class="string">&#x27;Zyadmin123&#x27;</span>;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> database booboo;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> booboo.t1 (id <span class="type">int</span> <span class="keyword">primary</span> key);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> booboo.t1 <span class="keyword">values</span> (<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h3 id="pt-online-ddl"><a href="#pt-online-ddl" class="headerlink" title="pt-online-ddl"></a>pt-online-ddl</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yum localinstall -y percona-toolkit-3.2.0-1.el7.x86_64.rpm</span><br><span class="line">pt-online-schema-change --port=3306 --host=localhost --user=root --password=Zyadmin123 --alter=<span class="string">&quot;add column name varchar(22)&quot;</span> D=booboo,t=t1 --no-version-check --execute --charset=utf8</span><br></pre></td></tr></table></figure><h3 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@node2 install]<span class="comment"># pt-online-schema-change --port=3306 --host=localhost --user=root --password=Zyadmin123 --alter=&quot;add column name varchar(22)&quot; D=booboo,t=t1 --no-version-check --execute --charset=utf8</span></span><br><span class="line">No slaves found.  See --recursion-method <span class="keyword">if</span> host node2 has slaves.</span><br><span class="line">Not checking slave lag because no slaves were found and --check-slave-lag was not specified.</span><br><span class="line">Operation, tries, <span class="built_in">wait</span>:</span><br><span class="line">  analyze_table, 10, 1</span><br><span class="line">  copy_rows, 10, 0.25</span><br><span class="line">  create_triggers, 10, 1</span><br><span class="line">  drop_triggers, 10, 1</span><br><span class="line">  swap_tables, 10, 1</span><br><span class="line">  update_foreign_keys, 10, 1</span><br><span class="line">Altering `booboo`.`t1`...</span><br><span class="line">Creating new table...</span><br><span class="line">Created new table booboo._t1_new OK.</span><br><span class="line">Altering new table...</span><br><span class="line">Altered `booboo`.`_t1_new` OK.</span><br><span class="line">2020-05-12T21:26:08 Creating triggers...</span><br><span class="line">2020-05-12T21:26:08 Created triggers OK.</span><br><span class="line">2020-05-12T21:26:08 Copying approximately 1 rows...</span><br><span class="line">2020-05-12T21:26:08 Copied rows OK.</span><br><span class="line">2020-05-12T21:26:08 Analyzing new table...</span><br><span class="line">2020-05-12T21:26:09 Swapping tables...</span><br><span class="line">2020-05-12T21:26:09 Swapped original and new tables OK.</span><br><span class="line">2020-05-12T21:26:09 Dropping old table...</span><br><span class="line">2020-05-12T21:26:09 Dropped old table `booboo`.`_t1_old` OK.</span><br><span class="line">2020-05-12T21:26:09 Dropping triggers...</span><br><span class="line">2020-05-12T21:26:09 Dropped triggers OK.</span><br><span class="line">Successfully altered `booboo`.`t1`.</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>不同的数据库版本对应的pt工具版本会有区别，具体可以访问<a href="https://www.percona.com/doc/percona-toolkit/LATEST/index.html">percona-toolkit</a></p><h3 id="v3-2-0-released-2019-04-20"><a href="#v3-2-0-released-2019-04-20" class="headerlink" title="v3.2.0 released 2019-04-20"></a>v3.2.0 released 2019-04-20</h3><p>Improvements:</p><ul><li><a href="https://jira.percona.com/browse/PT-1773">PT-1773</a>: Don’t make the foreign key check in <code>pt-online-schema-change</code> if not needed.</li><li><a href="https://jira.percona.com/browse/PT-1757">PT-1757</a>: <code>pt-table-checksum</code> can now handle small tables as a single chunk.</li><li><a href="https://jira.percona.com/browse/PT-1813">PT-1813</a>: MariaDB 10.4 is now supported.</li></ul><p>Bug fixes:</p><ul><li><a href="https://jira.percona.com/browse/PT-1782">PT-1782</a>: <code>pt-online-schema-change</code> declined to handle tables because of foreign keys even when there were no foreign keys with some MariaDB 10.2 and MySQL 8 versions.</li><li><a href="https://jira.percona.com/browse/PT-1759">PT-1759</a>: <code>pt-stalk</code> with <code>--mysql-only</code> option didn’t collect MySQL Status variables.</li><li><a href="https://jira.percona.com/browse/PT-1802">PT-1802</a>: <code>pt-online-schema-change</code> didn’t handle self-referencing foreign keys properly which caused an unnecessarily high resource consumption.</li><li><a href="https://jira.percona.com/browse/PT-1766">PT-1766</a>: <code>pt-table-checksum</code> <code>DIFF_ROWS</code> was not computed correctly.</li><li><a href="https://jira.percona.com/browse/PT-1760">PT-1760</a>: <code>pt-online-schema-change</code> regression caused it to hang for a stopped replica when using replication channels on the slave.</li><li><a href="https://jira.percona.com/browse/PT-1707">PT-1707</a>: A number of the Percona Toolkit tools failed to operate in the IPv6 environment if the host address specified as a parameter was not enclosed in square brackets.</li><li><a href="https://jira.percona.com/browse/PT-1502">PT-1502</a>: <code>pt-online-schema-change</code> was not recognizing the slave with multi-source replication active.</li><li><a href="https://jira.percona.com/browse/PT-1824">PT-1824</a>: <code>pt-online-schema-change</code> allowed the name of a constraint to exceed 64 characters when <code>--alter-foreign-keys-method=rebuild_constraints</code> was used. (Thank you, Iwo Panowicz.)</li><li><a href="https://jira.percona.com/browse/PT-1765">PT-1765</a>: Documentation for <code>DIFF_ROWS</code> doesn’t exist.</li><li><a href="https://jira.percona.com/browse/PT-297">PT-297</a>: <code>pt-online-schema-change</code> could break replication.</li><li><a href="https://jira.percona.com/browse/PT-1768">PT-1768</a>: Source code for <code>src/go/pt-mongodb-query-digest/pt-mongodb-query-digest</code> was missing in the official source tar ball.</li><li><a href="https://jira.percona.com/browse/PT-1576">PT-1576</a>: <code>pt-stalk</code> with <code>`--mysql-only</code> option was not adding MySQL <code>processlist</code> information to the output file.</li><li><a href="https://jira.percona.com/browse/PT-1793">PT-1793</a>: <code>pt-query-digest</code> was unable to handle the year 2020 because of wrong <code>tcpdump</code> parsing. (Thank you, Kei Tsuchiya.)</li></ul><h3 id="v3-0-13-released-2019-01-03"><a href="#v3-0-13-released-2019-01-03" class="headerlink" title="v3.0.13 released 2019-01-03"></a>v3.0.13 released 2019-01-03</h3><p>Improvements</p><ul><li><a href="https://jira.percona.com/browse/PT-1340">PT-1340</a>: <code>pt-stalk</code> now doesn’t call <code>mysqladmin debug</code> command by default to avoid flooding in the error log when not needed. <code>CMD_MYSQLADMIN=&quot;mysqladmin debug&quot;</code> environment variable reverts <code>pt-stalk</code> to the previous way of operation.</li><li><a href="https://jira.percona.com/browse/PT-1637">PT-1637</a>: A new <code>--fail-on-stopped-replication</code> option allows <code>pt-table-checksum</code> to detect failing slave nodes.</li></ul><p>Fixed bugs</p><ul><li><a href="https://jira.percona.com/browse/PT-1673">PT-1673</a>: <code>pt-show-grants</code> was incompatible with MariaDB 10+ (thanks <a href="https://github.com/pysysops">Tim Birkett</a>)</li><li><a href="https://jira.percona.com/browse/PT-1638">PT-1638</a>: <code>pt-online-schema-change</code> was erroneously taking MariaDB 10.x for MySQL 8.0 and rejecting to work with it to avoid the upstream bug <a href="https://bugs.mysql.com/bug.php?id=89441">#89441</a> scope.</li><li><a href="https://jira.percona.com/browse/PT-1616">PT-1616</a>: <code>pt-table-checksum</code> failed to resume on large tables with binary strings containing invalid UTF-8 characters.</li><li><a href="https://jira.percona.com/browse/PT-1573">PT-1573</a>: <code>pt-query-digest</code> didn’t work in case of <code>log_timestamps = SYSTEM</code> my.cnf option.</li><li><a href="https://jira.percona.com/browse/PT-1114">PT-1114</a>: <code>pt-table-checksum</code> failed when the table was empty.</li><li><a href="https://jira.percona.com/browse/PT-157">PT-157</a>: Specifying a non-primary key index with the <code>i</code> part of the <code>--source</code> argument made <code>pt-archiver</code> to ignore the <code>--primary-key-only</code> option presence.</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;!-- MDTOC maxdepth:6 firsth1:1 numbering:0 flatten:0 bullets:1 updateOnSave:1 --&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#在线mysql80结构变更问题排查&quot;&gt;在线MySQL8.0结构变更问题排查&lt;
      
    
    </summary>
    
    
      <category term="技术广角" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/"/>
    
      <category term="MySQL" scheme="http://www.toberoot.com/categories/%E6%8A%80%E6%9C%AF%E5%B9%BF%E8%A7%92/MySQL/"/>
    
    
      <category term="阿里云" scheme="http://www.toberoot.com/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
      <category term="在线DDL" scheme="http://www.toberoot.com/tags/%E5%9C%A8%E7%BA%BFDDL/"/>
    
      <category term="pt-online-schema-change" scheme="http://www.toberoot.com/tags/pt-online-schema-change/"/>
    
      <category term="Percona" scheme="http://www.toberoot.com/tags/Percona/"/>
    
  </entry>
  
</feed>
